<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The J*, a blog about Java, JVM, JavaScript and Gentoo Linux">
    <meta name="author" content="Víctor Orozco">
    <meta name="keywords" content="java,jvm,javascript,gentoo,linux">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <!--link href="../css/bootstrap.min.css" rel="stylesheet"-->
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/default.min.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">

    <meta property="og:title" content="Blog">
    <meta property="og:type" content="blog">
    <meta property="og:url" content="https://www.vorozco.com/blog/index.html">
    <meta property="og:site_name" content="The J*">
    <meta property="og:locale" content="en-US">
    <meta property="article:published_time" content="08 August 2015">
    <meta property="article:author" content="https://www.facebook.com/tuxtor">
    <meta property="fb:app_id" content="753735224749731">
    <meta property="og:image" content="http://vorozco.com/images/global/playground.png">

  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41004409-2', 'auto');
      ga('send', 'pageview');

    </script>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=290416645177";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
        <div id="wrap">
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">The J*</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../blog">Blog</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../archive.html">Archive</a></li>
            <li><a href="../contact.html">Contact</a></li>
            <li><a href="https://feeds.feedburner.com/the-j">Subscribe</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">The J*</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../blog">Blog</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../archive.html">Archive</a></li>
            <li><a href="../contact.html">Contact</a></li>
            <li><a href="https://feeds.feedburner.com/the-j">Subscribe</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
  <div class="page-header">
    <h1>Blog</h1>
  </div>
        <a href="../blog/2025/2025-12-11-Book-review-Kotlin-Java-Developers.html"><h1>Book Review: Kotlin for Java Developers</h1></a>
        <p>11 December 2025</p>
        <p><p><img src="/images/posts/kotlin/kotlin-book-cover.png" alt="Kotlin for Java Developers" title="Kotlin for Java Developers" /></p>
<h2>General information</h2>
<ul>
<li>Pages: 414</li>
<li>Published by: Packt</li>
<li>Release date: October 2025</li>
</ul>
<blockquote>
<p>Disclaimer: I received this book as part of a collaboration with Packt</p>
</blockquote>
<h2>TL;DR</h2>
<p>Essentially, this is a book that uses a &quot;problem-reasoning-solution&quot; approach to present the building blocks that make Kotlin interesting and different from Java. Hence, it isn't:</p>
<ul>
<li>A Kotlin reference book (i.e., it does not provide deep technical documentation)</li>
<li>A book for learning how to program from scratch</li>
</ul>
<p><strong>In my opinion, it delivers what it promises.</strong></p>
<h2>About the book and how I read it</h2>
<p>I work with both Java and Kotlin professionally. However, as a technical trainer I'm always looking for educational resources that can boost students' knowledge, either as a main reference or as a complementary resource. I think this book fits the latter category.</p>
<p>Right from the cover, the book states its value proposition:</p>
<blockquote>
<p>Confidently transition from Java to Kotlin through hands-on examples and idiomatic Kotlin practices</p>
</blockquote>
<p>I believe it achieves that, although at least in the first two chapters the writing style can make the book somewhat hard to read.</p>
<h2>A rocket that takes time to launch but can reach Mars</h2>
<p>The book is divided into four sections:</p>
<ol>
<li>Getting started with Kotlin</li>
<li>Object-Oriented Programming</li>
<li>Functional Programming</li>
<li>Coroutines, Testing and DSLs</li>
</ol>
<p>My least favorite section was the first, especially the first two chapters. The first chapter tries to give an overview of Kotlin versus Java, but it is too superficial and perhaps even unnecessary. I imagine the goal of this chapter is to spark interest in Kotlin, but it also anticipates that everything will be covered in more detail later. Personally, I almost skipped this chapter because I knew I would see the topics in more depth later. I suppose that's a matter of taste.</p>
<p>Then, the second chapter sketches out Maven and Gradle without going in depth, which felt redundant since the book is targeted at Java developers. I expected more detail in this section about which plugins are used in the build process, how they interact with Maven lifecycles, and other specific topics. But the book delegates this responsibility to the IDE wizard and that's it.</p>
<p>From chapter three onward something magical happens. The book finally launches and its value proposition starts to materialize. Starting in chapter three the writing style changes and consistently presents concept by concept. Almost every chapter is structured like this:</p>
<ul>
<li>A common problem is discussed, often respectfully from a Java perspective</li>
<li>The Kotlin design decision is presented and how it aims to improve the problem</li>
<li>A concise, self-contained Kotlin snippet explains the programming concept</li>
</ul>
<p>This last part is what gives the book its value. Studying a programming language — especially when you already know how to program — is a different process than learning to program for the first time. This book recognizes that and discusses Kotlin's value propositions in technical terms, presenting self-contained snippets that readers can try in their IDE or download from the book's official repository.</p>
<p>If I were to use a rocket analogy, imagine that the following chapters are like Apollo 11 in full ascent from Cape Canaveral.</p>
<p>Part I<br />
* Null and non-nullable types<br />
* Extension Functions and the apply function</p>
<p>Part II<br />
* Object-Oriented programming basics<br />
* Generics and variance<br />
* Data and sealed classes</p>
<p>Because this is not a reference book or official documentation, up to this point the book presents each concept well without diving into corner cases — which is fine. With practice, the book can be completed in about a week and provides a solid foundation for moving to the next level, whether that's Android development or Kotlin backend programming.</p>
<p>From Part III there is a noticeable shift: we leave the Java-centric atmosphere and enter idiomatic Kotlin territory. Java-only developers will likely notice this change, as we move into structures that are often too abstract to have direct equivalents in Java, including:</p>
<p>Part III - All this in the &quot;Kotlin way&quot;<br />
* Basics of functional programming<br />
* Lambdas<br />
* Collections and sequences</p>
<p>Part IV<br />
* Coroutines<br />
* Synchronous and asynchronous programming</p>
<p>Finally, once we're in orbit the book presents two topics that are useful for day-to-day development but are not strictly part of the language:</p>
<ul>
<li>Kotlin testing</li>
<li>Domain-specific languages (DSLs)</li>
</ul>
<h2>Things that could be improved</h2>
<p>As with any review, this is the most difficult section to write. Besides the first two chapters, I noticed a few things that could cause confusion:</p>
<ul>
<li>The null safety chapter omits any mention of Java's <code>Optional</code></li>
<li>The coroutines section briefly mentions Virtual Threads but then presents Loom as a separate effort and likens it to Quasar (a library ecosystem). In reality, Virtual Threads are part of Project Loom</li>
<li>The book inconsistently presents different JDK recommendations across chapters; sometimes it suggests Corretto while other times it simply suggests OpenJDK</li>
<li>Also on the JVM side, most of the time it suggests Java 17. I imagine this was related to the time of writing. I can say that all samples worked just fine on Java 25 (the latest LTS at the time of writing), so you should be fine using that or Java 21.</li>
</ul>
<h2>Who should read this book?</h2>
<ul>
<li>Java developers exploring the Kotlin ecosystem, those interested in Android development, or developers considering switching to Kotlin as their primary language</li>
</ul>
</p>
        <a href="../blog/2025/2025-03-23-Fedora-Secure-Boot-VirtualBox.html"><h1>Install VirtualBox over Fedora with SecureBoot enabled</h1></a>
        <p>24 March 2025</p>
        <p><p>Not too long ago, I upgraded my computer and got a new <strong>Lenovo ThinkPad X1 Carbon</strong> (a great machine so far!).</p>
<p><img src="/images/posts/virtualboxsecureboot/00-lenovo.jpg" alt="Lenovo" title="Lenovo" /></p>
<p>Since I was accustomed to working on a gaming rig (Ryzen 7, 64GB RAM, 4TB) that I had set up about five years ago, <strong>I completely missed the Secure Boot and TPM trends</strong>—these weren’t relevant for my fixed workstation.</p>
<p>However, my goal with this new laptop is to work with both <strong>Linux and Windows on the go</strong>, making encryption mandatory. As a non-expert Windows user, <strong>I enabled encryption via BitLocker on Windows 11</strong>, which worked perfectly... until it didn’t.</p>
<h2>The Issue with Secure Boot and VirtualBox/VMware</h2>
<p>This week, I discovered that <strong><a href="https://learn.microsoft.com/en-us/windows/security/operating-system-security/data-protection/bitlocker/countermeasures">BitLocker leverages</a> TPM (the encryption chip) and Secure Boot</strong> if they’re enabled during encryption. While this is beneficial for Windows users, it created an unexpected problem for me: <strong>virtualization on Linux</strong>.</p>
<p>Let me explain. <a href="https://wiki.gentoo.org/wiki/Secure_Boot">Secure Boot</a> is:</p>
<blockquote>
<p>...an enhancement of the security of the pre-boot process of a UEFI system. When enabled, the UEFI firmware verifies the signature of every component used in the boot process. This results in boot files that are easily readable but tamper-evident.</p>
</blockquote>
<p>This means components like the <strong>kernel, kernel modules, and firmware</strong> must be signed with a recognized signature, which must be installed on the computer.</p>
<p>This creates a tricky situation for Linux because <strong>virtualization software like VMware or VirtualBox typically compiles kernel modules on the user’s machine</strong>. These modules are unsigned by default, leading to errors when loading them:</p>
<pre><code class="language-prettyprint"># modprobe vboxdrv
modprobe: ERROR: could not insert 'vboxdrv': Key was rejected by service
</code></pre>
<p>A good way to diagnose this is to check <code>dmesg</code> for messages like:</p>
<pre><code>[47921.605346] Loading of unsigned module is rejected
[47921.664572] Loading of unsigned module is rejected
[47932.035014] Loading of unsigned module is rejected
[47932.056838] Loading of unsigned module is rejected
[47947.224484] Loading of unsigned module is rejected
[47947.257641] Loading of unsigned module is rejected
[48291.102147] Loading of unsigned module is rejected
</code></pre>
<h2>How to Fix the Issue with VirtualBox Using RPMFusion and Akmods</h2>
<p>Oracle is aware of this issue, but their <a href="https://www.virtualbox.org/manual/topics/installation.html#kernel-modules-efi-secure-boot">documentation</a> is lacking. To quote:</p>
<blockquote>
<p>If you are running on a system using UEFI (Unified Extensible Firmware Interface) Secure Boot, you may need to sign the following kernel modules before you can load them: <code>vboxdrv</code>, <code>vboxnetadp</code>, <code>vboxnetflt</code>, <code>vboxpci</code>. <strong>See your system documentation for details of the kernel module signing process</strong>.</p>
</blockquote>
<p>Fedora’s documentation is sparse, so I spent a lot of time researching <strong>manual kernel module signing</strong> (<a href="https://docs.fedoraproject.org/en-US/quick-docs/kernel-build-custom/#_secure_boot">Fedora docs</a>) and following <a href="https://gist.github.com/reillysiemens/ac6bea1e6c7684d62f544bd79b2182a4">user guides</a> until I discovered that <strong>VirtualBox is available in <a href="https://rpmfusion.org/">RPMFusion</a> with <a href="https://packages.fedoraproject.org/pkgs/akmods/akmods/index.html">akmods</a> support</strong>.</p>
<p>Some definitions:</p>
<ol>
<li><strong>RPM Fusion</strong> is a community repository for Enterprise Linux (Fedora, RHEL, etc.) that provides packages not included in official distributions.</li>
<li><strong>Akmds</strong> automates the process of building and signing kernel modules.</li>
</ol>
<p>Here’s the step-by-step solution:</p>
<h3>1. Enable RPM Fusion (Free Repo)</h3>
<p>Install the RPM Fusion free repository:</p>
<pre><code class="language-prettyprint">sudo dnf install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
</code></pre>
<p><img src="/images/posts/virtualboxsecureboot/01-install.png" alt="RPM Fusion Install" title="RPM Fusion Install" /></p>
<h3>2. Install VirtualBox (with Akmods)</h3>
<p>Ensure VirtualBox is installed from RPMFusion (akmods will be a dependency):</p>
<pre><code class="language-prettyprint">sudo dnf install virtualbox
</code></pre>
<p><img src="/images/posts/virtualboxsecureboot/02-virtualbox.png" alt="VirtualBox Install" title="VirtualBox Install" /></p>
<p><img src="/images/posts/virtualboxsecureboot/03-akmods.png" alt="VirtualBox Akmods" title="VirtualBox Akmods" /></p>
<h3>3. Start Akmods to Generate Keys</h3>
<p>Akmods will automatically sign the modules with a key stored in <code>/etc/pki/akmods/certs</code>:</p>
<pre><code class="language-prettyprint">sudo systemctl start akmods.service
</code></pre>
<p><img src="/images/posts/virtualboxsecureboot/04-akmods-start.png" alt="Akmods Start" title="Akmods Start" /></p>
<h3>4. Enroll the Key with Mokutil</h3>
<p>Use <code>mokutil</code> to register the key in Secure Boot:</p>
<pre><code class="language-prettyprint">sudo mokutil --import /etc/pki/akmods/certs/public_key.der
</code></pre>
<p><img src="/images/posts/virtualboxsecureboot/05-mokutil.png" alt="Mokutil Key Import" title="Mokutil Key Import" /></p>
<p>You’ll be prompted for a <strong>case-sensitive password</strong>—remember it for the next step.</p>
<h3>5. Reboot and Enroll the Key</h3>
<p>After rebooting, the UEFI firmware will prompt you to <strong>enroll the new key</strong>.</p>
<p><img src="/images/posts/virtualboxsecureboot/06-mokenroll.png" alt="MOK Enrollment" title="MOK Enrollment" /></p>
<p><img src="/images/posts/virtualboxsecureboot/08-mokenroll-3.png" alt="MOK Enrollment 3" title="MOK Enrollmen 3" /></p>
<p>If needed, you could also check for the key contents in that screen.</p>
<p><img src="/images/posts/virtualboxsecureboot/07-mokenroll-2.png" alt="MOK Enrollment 2" title="MOK Enrollment 2" /></p>
<h3>6. Start VirtualBox Kernel Modules</h3>
<p>The modules are now signed and can be loaded. Enable these at boot:</p>
<pre><code class="language-prettyprint">sudo systemctl start vboxdrv
sudo systemctl enable vboxdrv
</code></pre>
<p>Verify they’re loaded:</p>
<pre><code class="language-prettyprint">lsmod | grep vbox
</code></pre>
<p>Output:</p>
<pre><code>vboxnetadp             32768  0
vboxnetflt             40960  0
vboxdrv               708608  2 vboxnetadp,vboxnetflt
</code></pre>
<p>Now, <strong>VirtualBox runs on Fedora with Secure Boot and TPM enabled</strong>, without disabling BitLocker on Windows.</p>
<p><img src="/images/posts/virtualboxsecureboot/09-finalresult.png" alt="VirtualBox Running" title="VirtualBox Running" /></p>
</p>
        <a href="../blog/2024/2024-11-18-A-practical-guide-spring-boot-open-telemetry.html"><h1>A practical guide to implement OpenTelemetry in Spring Boot</h1></a>
        <p>01 December 2024</p>
        <p><p>In this tutorial I want to consolidate some practical ideas regarding OpenTelemetry and how to use it with Spring Boot.</p>
<p>This tutorial is composed by four sections</p>
<ol>
<li>OpenTelemetry practical concepts</li>
<li>Setting up an observability stack with OpenTelemetry Collector, Grafana, Loki, Tempo and Podman</li>
<li>Instrumenting Spring Boot applications for OpenTelemetry</li>
<li>Testing and E2E sample</li>
</ol>
<p>By the end of the tutorial, you should be able to implement the following architecture:</p>
<p><img src="/images/posts/opentelemetry/arch.png" alt="Arch" title="Arch" /></p>
<h2>OpenTelemetry practical concepts</h2>
<p>As the <a href="https://opentelemetry.io/docs/what-is-opentelemetry/">official documentation</a> states, OpenTelemetry is</p>
<ul>
<li>An Observability framework and toolkit designed to <strong>create and manage telemetry data such as traces, metrics, and logs.</strong></li>
<li>Vendor and tool-agnostic, meaning that it can be used with a broad variety of Observability backends.</li>
<li>Focused on the generation, collection, management, and export of telemetry. A major goal of OpenTelemetry is that you can easily instrument your applications or systems, no matter their language, infrastructure, or runtime environment.</li>
</ul>
<h3>Monitoring, observability and METL</h3>
<p>To keep things short, monitoring is the process of collecting, processing and analyzing data to track the state of a (information) system. Then, monitoring is going to the next level, <strong>to actually understand the information that is being collected</strong> and do something with it, like <a href="https://sre.google/sre-book/monitoring-distributed-systems/">defining alerts for a given system</a>.</p>
<p>To achieve both goals it is necessary to collect three dimensions of data, specifically:</p>
<ul>
<li><strong>Logs:</strong> Registries about processes and applications, with useful data like timestamps and context</li>
<li><strong>Metrics:</strong> Numerical data about the performance of applications and application modules</li>
<li><strong>Traces:</strong> Data that allow to estabilish the complete route that a given operation traverses through a series of dependent applications</li>
</ul>
<p>Hence, when the state of a given system is altered in some way, we have an <strong>Event</strong>, that correlates and ideally generates data on the three dimensions.</p>
<h3>Why is OpenTelemetry important and which problem does it solve?</h3>
<p>Developers recognize by experience that <strong>monitoring and observability</strong> are important, either to evaluate the actual state of a system or to do post-mortem analysis after disasters. Hence, it is natural to think that observability has been implemented in <strong>various ways</strong>. For example if we think on a system constructed with Java we have at least the following collection points:</p>
<ul>
<li>Logs: Systemd, /var/log, /opt/tomcat, FluentD</li>
<li>Metrics: Java metrics via JMX, OS Metrics, vendor specific metrics via Spring Actuator</li>
<li>Tracing: Data via Jaeger or Zipkin tooling in our Java workloads</li>
</ul>
<p>This variety in turn imposes a great amount of <strong>complexity in instrumenting our systems to provide information</strong>, that a- comes in different formats, from b- technology that is difficult to implement, often with c- solutions that are too tied to a given provider or in the worst cases, d- technologies that only work with certain languages/frameworks.</p>
<p>And that's the <em>magic</em> about OpenTelemetry proposal, by creating a working group <a href="https://opentelemetry.devstats.cncf.io/d/8/dashboards?orgId=1&amp;refresh=15m">under the CNCF umbrella</a> the project is able to provide useful things like:</p>
<ol>
<li>Common protocols that vendors and communities can implement to talk each other</li>
<li>Standards for software communities to implement instrumentation in libraries and frameworks to provide data in OpenTelemetry format</li>
<li>A collector able to retrieve/receive data from diverse origins compatible with OpenTelemetry, process it and send it to ...</li>
<li>Analysis platforms, databases and cloud vendors able to receive the data and provide added value over it</li>
</ol>
<p>In short, OpenTelemetry is the reunion of various great monitoring ideas that overlapping software communities can implement to facilitate the burden of monitoring implementations.</p>
<h3>OpenTelemetry data pipeline</h3>
<p>For me, the easiest way to think about OpenTelemetry concepts is a data pipeline, in this data pipeline you need to</p>
<ol>
<li><em>Instrument your workloads</em> to push (or offer) the <em>telemetry data</em> to a processing/collecting element -i.e. OpenTelemetry Collector-</li>
<li><em>Configure OpenTelemetry Collector to receive</em> or pull the data from diverse workloads</li>
<li><em>Configure OpenTelemetry Collector to process</em> the data -i.e adding special tags, filtering data-</li>
<li><em>Configure OpenTelemetry Collector to push</em> (or offer) the data to compatible backends</li>
<li><em>Configure and use the backends to receive</em> (or pull) the data from the collector, to allow analysis, alarms, AI ... pretty much any case that you can think about with data</li>
</ol>
<p><img src="/images/posts/opentelemetry/otelpipeline.png" alt="Otel Pipeline" title="Otel Pipeline" /></p>
<h2>Setting up an observability stack with OpenTelemetry Collector, Grafana, Prometheus, Loki, Tempo and Podman</h2>
<p><img src="/images/posts/opentelemetry/collectorarch.png" alt="Collectorarch" title="Collector Arch" /></p>
<p>As OpenTelemetry got popular various vendors have implemented support for it, to mention a few:</p>
<p>Self-hosted platforms</p>
<ul>
<li><a href="https://www.elastic.co/what-is/opentelemetry">Elastic</a></li>
<li><a href="https://grafana.com/oss/opentelemetry/">Grafana</a></li>
<li><a href="https://www.hyperdx.io/docs/install/opentelemetry">HyperDX</a></li>
</ul>
<p>Cloud platforms</p>
<ul>
<li><a href="https://aws-otel.github.io/">Amazon</a></li>
<li><a href="https://docs.oracle.com/en-us/iaas/application-performance-monitoring/doc/configure-open-source-tracing-systems.html">Oracle Cloud</a></li>
<li><a href="https://www.splunk.com/en_us/solutions/opentelemetry.html">Splunk</a></li>
<li><a href="https://docs.datadoghq.com/opentelemetry/">Datadog</a></li>
</ul>
<p>Hence, for development purposes, <strong>it is always useful to know how to bootstrap a quick observability stack</strong> able to receive and show OpenTelemetry capabilities.</p>
<p>For this purpose we will use the following elements:</p>
<ul>
<li>Prometheus as time-series database for metrics</li>
<li>Loki as logs platform</li>
<li>Tempo as a tracing platform</li>
<li>Grafana as a web UI</li>
</ul>
<p>And of course OpenTelemetry collector. This example is based on various <a href="https://github.com/grafana/tempo/tree/main/example/docker-compose">Grafana examples</a>, with a little bit of tweaking to demonstrate the different ways of collecting, processing and sending data to backends.</p>
<h3>OpenTelemetry collector</h3>
<p>As stated previously, <strong>OpenTelemetry collector acts as an intermediary that receives/pull information from data sources, processes this information and, forwards the information to destinations</strong> like analysis platforms or even other collectors. The collector is able to do this either with compliant workloads or via plugins that talk with the workloads using proprietary formats.</p>
<p>As the plugins collection can be increased or decreased, vendors have created their own <em>distributions</em> of OpenTelemetry collectors, for reference I've used successfully in the real world:</p>
<ul>
<li><a href="https://aws-otel.github.io/">Amazon ADOT</a></li>
<li><a href="https://github.com/signalfx/splunk-otel-collector">Splunk Distribution of OpenTelemetry Collector</a></li>
<li><a href="https://github.com/grafana/alloy">Grafana Alloy</a></li>
<li><a href="https://opentelemetry.io/docs/collector/">OpenTelemetry Collector (the reference implementation)</a></li>
</ul>
<p>You could find a complete list directly on <a href="https://opentelemetry.io/ecosystem/distributions/">OpenTelemetry website</a>.</p>
<p>For this demonstration, we will create a <em>data pipeline</em> using the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib">contrib version of the reference implementation</a> which provides a good amount of receivers, exporters and processors. In our case Otel configuration is designed to:</p>
<ul>
<li><em>Receive</em> data from Spring Boot workloads (ports 4317 and 4318)</li>
<li><em>Process</em> the data adding a new tag to metrics</li>
<li><em>Expose</em> an endpoint for Prometheus scrapping (port 8889)</li>
<li><em>Send</em> logs to Loki (port 3100) using otlphttp format</li>
<li><em>Send</em> traces to Tempo (port 9411) using otlp format</li>
<li><em>Exposes</em> a rudimentary dashboard from the collector, called zpages. Very useful for debugging.</li>
</ul>
<p><code>otel-config.yaml</code></p>
<pre><code class="language-prettyprint">receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
processors:
  attributes:
    actions:
      - key: team
        action: insert
        value: vorozco
exporters:
  debug:
  prometheus:
    endpoint: &quot;0.0.0.0:8889&quot;
  otlphttp:
    endpoint: http://loki:3100/otlp
  otlp:
    endpoint: tempo:4317
    tls:
      insecure: true
service:
  extensions: [zpages]
  pipelines:
    metrics:
      receivers: [otlp]
      processors: [attributes]
      exporters: [debug,prometheus]
    traces:
      receivers: [otlp]
      exporters: [debug, otlp]
    logs:
      receivers: [otlp]
      exporters: [debug, otlphttp]
extensions:
  zpages:
    endpoint: &quot;0.0.0.0:55679&quot;
</code></pre>
<h3>Prometheus</h3>
<p><a href="https://prometheus.io/">Prometheus is a well known analysis platform</a>, that among other things offers dimensional data and a performant time-series storage.</p>
<p>By default it works as a metrics scrapper, then, workloads provide a http endpoint offering data using the <a href="https://prometheus.io/docs/concepts/data_model/">Prometheus format</a>. For our example we configured Otel to <strong>offer metrics to the prometheus host via port 8889</strong>.</p>
<pre><code class="language-prettyprint">prometheus:
    endpoint: &quot;prometheus:8889&quot;
</code></pre>
<p>Then, whe need to configure Prometheus to <strong>scrape the metrics from the Otel host</strong>. You would notice two ports, the one that we defined for the active workload data (8889) and another for metrics data for the collector itself (8888).</p>
<p><code>prometheus.yml</code></p>
<pre><code class="language-prettyprint">scrape_configs:
- job_name: &quot;otel&quot;
  scrape_interval: 10s
  static_configs:
    - targets: [&quot;otel:8889&quot;]
    - targets: [&quot;otel:8888&quot;]
</code></pre>
<p>It is worth highlighting that <a href="https://prometheus.io/docs/specs/remote_write_spec/">Prometheus also offers a way to <em>ingest</em> information</a> instead of scrapping it, and, <a href="https://prometheus.io/blog/2024/03/14/commitment-to-opentelemetry/">the official support for OpenTelemetry ingestion is coming</a> on the new versions.</p>
<h3>Loki</h3>
<p>As described in the website, <strong><a href="https://grafana.com/oss/loki/">Loki is a specific solution for log aggregation heavily inspired by Prometheus</a></strong>, with the particular design decision to NOT format in any way the log contents, leaving that responsibility to the query system.</p>
<p>To configure the project for local environments, <a href="https://github.com/grafana/loki/blob/main/cmd/loki/loki-local-config.yaml">the project offers a configuration that is usable for most of the development purposes</a>. The following configuration is an adaptation to preserve the bare minimum to work with temporal files and memory.</p>
<p><code>loki.yaml</code></p>
<pre><code class="language-prettyprint">auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096

common:
  instance_addr: 127.0.0.1
  path_prefix: /tmp/loki
  storage:
    filesystem:
      chunks_directory: /tmp/loki/chunks
      rules_directory: /tmp/loki/rules
  replication_factor: 1
  ring:
    kvstore:
      store: inmemory

query_range:
  results_cache:
    cache:
      embedded_cache:
        enabled: true
        max_size_mb: 100

schema_config:
  configs:
    - from: 2020-10-24
      store: tsdb
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

ruler:
  alertmanager_url: http://localhost:9093

limits_config:
  allow_structured_metadata: true
</code></pre>
<p>Then, we configure an exporter to deliver the data to the loki host using <a href="https://opentelemetry.io/docs/specs/otlp/#otlphttp">oltphttp format</a>.</p>
<pre><code class="language-prettyprint">otlphttp:
  endpoint: http://loki:3100/otlp
</code></pre>
<h3>Tempo</h3>
<p>In similar fashion than Loki, <strong>Tempo is an Open Source project created by grafana that aims to provide a <a href="https://grafana.com/oss/tempo/">distributed tracing backend</a></strong>. On a personal note, for me besides performance it shines for being compatible not only with OpenTelemetry, it can also ingest data in Zipkin and Jaeger formats.</p>
<p>To configure the project for local environments, <a href="https://github.com/grafana/tempo/tree/main/example/docker-compose">the project offers a configuration that is usable for most of the development purposes</a>. The following configuration is an adaptation to remove the metrics generation and simplify the configuration, however with this <a href="https://grafana.com/docs/tempo/latest/metrics-generator/service_graphs/">we loose the service graph feature</a>.</p>
<p><code>tempo.yaml</code></p>
<pre><code class="language-prettyprint">stream_over_http_enabled: true
server:
  http_listen_port: 3200
  log_level: info

query_frontend:
  search:
    duration_slo: 5s
    throughput_bytes_slo: 1.073741824e+09
    metadata_slo:
      duration_slo: 5s
      throughput_bytes_slo: 1.073741824e+09
  trace_by_id:
    duration_slo: 5s

distributor:
  receivers:
    otlp:
      protocols:
        http:
        grpc:

ingester:
  max_block_duration: 5m               # cut the headblock when this much time passes. this is being set for demo purposes and should probably be left alone normally

compactor:
  compaction:
    block_retention: 1h                # overall Tempo trace retention. set for demo purposes

storage:
  trace:
    backend: local                     # backend configuration to use
    wal:
      path: /var/tempo/wal             # where to store the wal locally
    local:
      path: /var/tempo/blocks
</code></pre>
<p>Then, we configure an exporter to deliver the data to Tempo host using <a href="https://opentelemetry.io/docs/specs/otlp/#otlpgrpc">oltp/grpc format</a>.</p>
<pre><code class="language-prettyprint">otlp:
    endpoint: tempo:4317
    tls:
      insecure: true
</code></pre>
<h3>Grafana</h3>
<p>Loki, Tempo and (to some extent) Prometheus are data storages, but we still need to show this data to the user. Here, Grafana enters the scene.</p>
<p>Grafana offers <strong>a good selection of analysis tools, plugins, dashboards, alarms, connectors and a great community that empowers observability</strong>. Besides having a great compatibility with Prometheus, it offers of course a perfect compatibility with their other offerings.</p>
<p>To configure Grafana you just need to plug compatible datasources and the rest of work will be on the web ui.</p>
<p><code>grafana.yaml</code></p>
<pre><code class="language-prettyprint">apiVersion: 1

datasources:
  - name: Otel-Grafana-Example
    type: prometheus
    url: http://prometheus:9090
    editable: true
  - name: Loki
    type: loki
    access: proxy
    orgId: 1
    url: http://loki:3100
    basicAuth: false
    isDefault: true
    version: 1
    editable: false
  - name: Tempo
    type: tempo
    access: proxy
    orgId: 1
    url: http://tempo:3200
    basicAuth: false
    version: 1
    editable: false
    apiVersion: 1
    uid: tempo
</code></pre>
<h3>Podman (or Docker)</h3>
<p>At this point you may have noticed that I've referred to the backends using single names, <strong>this is because I intend to set these names using a Podman Compose deployment</strong>.</p>
<p><code>otel-compose.yml</code></p>
<pre><code class="language-prettyprint">version: '3'
services:
  otel:
    container_name: otel
    image: otel/opentelemetry-collector-contrib:latest
    command: [--config=/etc/otel-config.yml]
    volumes:
      - ./otel-config.yml:/etc/otel-config.yml
    ports:
      - &quot;4318:4318&quot;
      - &quot;4317:4317&quot;
      - &quot;55679:55679&quot;
  prometheus:
    container_name: prometheus
    image: prom/prometheus
    command: [--config.file=/etc/prometheus/prometheus.yml]
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - &quot;9091:9090&quot;
  grafana:
    container_name: grafana
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
    image: grafana/grafana
    volumes:
      - ./grafana.yml:/etc/grafana/provisioning/datasources/default.yml
    ports:
      - &quot;3000:3000&quot;
  loki:
    container_name: loki
    image: grafana/loki:3.2.0
    command: -config.file=/etc/loki/local-config.yaml
    volumes:
      - ./loki.yaml:/etc/loki/local-config.yaml
    ports:
      - &quot;3100&quot;
  tempo:
    container_name: tempo
    image: grafana/tempo:latest
    command: [ &quot;-config.file=/etc/tempo.yaml&quot; ]
    volumes:
      - ./tempo.yaml:/etc/tempo.yaml
    ports:
      - &quot;4317&quot;  # otlp grpc
      - &quot;4318&quot;
</code></pre>
<p>At this point the compose description is pretty self-descriptive, but I would like to highlight some things:</p>
<ul>
<li>Some ports are open to the host -e.g. 4318:4318 - while others are closed to the default network that compose will be created among containers -e.g. 3100-</li>
<li><strong>This stack is designed to avoid any permanent data.</strong> Again, this is my personal way to boot quickly an observability stack to allow tests during deployment. To make it ready for production you probably would want to preserve the data in some volumes</li>
</ul>
<p>Once the configuration is ready, you can launch it using the compose file</p>
<pre><code class="language-prettyprint">cd podman
podman compose -f otel-compose.yml up
</code></pre>
<p>If the configuration is ok, you should have five containers running without errors.</p>
<p><img src="/images/posts/opentelemetry/podman.png" alt="Podman Otel" title="Podman Otel" /></p>
<h2>Instrumenting Spring Boot applications for OpenTelemetry</h2>
<p><img src="/images/posts/opentelemetry/springbootarch.png" alt="Springbootarch" title="Springboot Arch" /></p>
<p>As part of my daily activities I was in charge of a major implementation of all these concepts. Hence it was natural for me to create a proof of concept that you could find at my <a href="https://github.com/tuxtor/spring-boot-otel-poc/tree/main">GitHub</a>.</p>
<p>For demonstration purposes we have two services with different HTTP endpoints:</p>
<ul>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/tree/main/springboot-demo"><code>springboot-demo:8080</code></a> - Useful to demonstrate local and database tracing, performance, logs and OpenTelemetry instrumentation
<ul>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/blob/main/springboot-demo/src/main/java/com/vorozco/controller/AdmBookController.java"><code>/books</code></a> - A books CRUD using Spring Data</li>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/blob/main/springboot-demo/src/main/java/com/vorozco/controller/FibonacciController.java"><code>/fibo</code></a> - A <a href="https://www.geeksforgeeks.org/program-for-nth-fibonacci-number/#naive-approach-using-recursion-o2n-time-and-on-space">Naive Fibonacci</a> implementation that generates CPU load and delays</li>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/blob/main/springboot-demo/src/main/java/com/vorozco/controller/LogController.java"><code>/log</code></a> - Which generate log messages using the different SLF4J levels</li>
</ul>
</li>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/tree/main/springboot-client-demo"><code>springboot-client-demo:8081</code></a> - Useful to demonstrate tracing capabilities, Micrometer instrumentation and Micrometer Tracing instrumentation
<ul>
<li><a href="https://github.com/tuxtor/spring-boot-otel-poc/blob/main/springboot-client-demo/src/main/java/com/vorozco/springboot_client_demo/controller/TraceDemoController.java"><code>/trace-demo</code></a> - A quick OpenFeing client that invokes books GetAll Books demo</li>
</ul>
</li>
</ul>
<h3>Instrumentation options</h3>
<p>Given the popularity of OpenTelemetry, developers can expect also multiple instrumentation options.</p>
<p><strong>First of all, the OpenTelemetry project offers a framework-agnostic instrumentation</strong> that uses bytecode manipulation, for this instrumentation to work you need to <a href="https://opentelemetry.io/docs/zero-code/java/agent/">include a Java Agent via Java Classpath</a>. In my experience this instrumentation is preferred if you don't control the workload or if your platform does not offer OpenTelemetry support at all.</p>
<p>However, instrumentation of workloads can become really specific -e.g. instrumentation of a Database pool given a particular IoC mechanism-. For this, the Java world provides a good ecosystem, for example:</p>
<ul>
<li><a href="https://quarkus.io/guides/opentelemetry">Quarkus</a></li>
<li><a href="https://helidon.io/docs/v4/mp/telemetry">Helidon</a></li>
<li><a href="https://docs.payara.fish/enterprise/docs/Technical%20Documentation/Payara%20Server%20Documentation/Logging%20and%20Monitoring/Request%20Tracing%20Service/OpenTelemetry%20and%20OpenTracing.html">Payara</a></li>
</ul>
<p><strong>And of course Spring Boot.</strong></p>
<p>Spring Boot is a special case with TWO major instrumentation options</p>
<ol>
<li><a href="https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/">OpenTelemetry's Spring Boot starter</a></li>
<li><a href="https://docs.micrometer.io/micrometer/reference/implementations/otlp.html">Micrometer</a> and <a href="https://docs.micrometer.io/tracing/reference/index.html">Micrometer Tracing</a></li>
</ol>
<p>Both options use Spring concepts like decorators and interceptors to capture and send information to the destinations. The only rule is to create the clients/services/objects in the Spring way (hence via Spring IoC).</p>
<p>I've used both successfully and my heavily opinionated conclusion is the following:</p>
<ul>
<li>Micrometer collects more information about spring metrics. Besides OpenTelemetry backend, it supports a <a href="https://docs.spring.io/spring-boot/reference/actuator/metrics.html">plethora of backends</a> directly without any collector intervention. If you cannot <em>afford</em> a collector, this is the way. From Micrometer perspective OpenTelemetry is just another backend</li>
<li><a href="https://docs.micrometer.io/tracing/reference/index.html">Micrometer Tracing is the evolution of Spring Cloud Sleuth</a>, hence if you have workloads with Spring Boot 2 and 3, you have to support both tools (or maybe migrate everything to Spring boot 3?)</li>
<li><strong>The Micrometer family does not offer a way to collect logs</strong> and send these to a backend, hence devs have to solve this by using an appender specific to your logging library. On the other hand OpenTelemetry Spring Boot starter offers this out of the box if you use Spring Boot default (SLF4J over Logback)</li>
</ul>
<p>As these libraries are mutually exclusive, <strong>if the decision is mine, I would pick OpenTelemetry's Spring Boot starter</strong>. It offers logs support OOB and also a <a href="https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/out-of-the-box-instrumentation/">bridge for micrometer Metrics</a>.</p>
<h3>Instrumenting springboot-demo with OpenTelemetry SpringBoot starter</h3>
<p>As always, <a href="https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/getting-started/">it is also good to consider the official documentation</a>.</p>
<p>Otel instrumentation with the Spring started is activated in three steps:</p>
<ol>
<li>You need to include both OpenTelemetry Bom and OpenTelemetry dependency. If you are planning to also use micrometer metrics, it is also a good idea to include Spring Actuator</li>
</ol>
<pre><code class="language-prettyprint">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;
            &lt;artifactId&gt;opentelemetry-instrumentation-bom&lt;/artifactId&gt;
            &lt;version&gt;2.10.0&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
...
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;
    &lt;artifactId&gt;opentelemetry-spring-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<ol>
<li>
<p>There is a set of <a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/supported-libraries.md#libraries--frameworks">optional libraries and adapters</a> that you can configure if your workloads already diverged from the &quot;Spring Way&quot;</p>
</li>
<li>
<p>You need to activate (or not) the dimensions of observability (metrics, traces and logs). Also, <a href="https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/out-of-the-box-instrumentation/">you can finetune the exporting</a> parameter like ports, urls or exporting periods. Either by using Spring Properties or env variables</p>
</li>
</ol>
<pre><code class="language-prettyprint">#Configure exporters
otel.logs.exporter=otlp
otel.metrics.exporter=otlp
otel.traces.exporter=otlp

#Configure metrics generation
otel.metric.export.interval=5000 #Export metrics each five seconds
otel.instrumentation.micrometer.enabled=true #Enabe Micrometer metrics bridge
</code></pre>
<h3>Instrumenting springboot-client-demo with Micrometer and Micrometer Tracing</h3>
<p><strong>Again, this instrumentation does not support logs exporting.</strong> Also, it is a good idea to check the latest documentation for <a href="https://docs.spring.io/spring-boot/reference/actuator/metrics.html#actuator.metrics.export.otlp">Micrometer</a> and <a href="https://docs.spring.io/spring-boot/reference/actuator/tracing.html">Micrometer Tracing</a>.</p>
<ol>
<li>As in the previous example, you need to enable Spring Actuator (which includes Micrometer). As OpenTelemetry is just a backend from Micrometer perspective, you just need to ehable the corresponding OTLP registry which will export metrics to localhost by default.</li>
</ol>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-otlp&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<ol>
<li>In a similar way you need to Metrics, once actuator is enabled you just need to add support for the tracing backend</li>
</ol>
<pre><code class="language-prettyprint">&lt;dependency&gt;
  &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
  &lt;artifactId&gt;micrometer-tracing-bridge-otel&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<ol>
<li>Finally, you can finetune the configuration using Spring properties. For example, you can decide if 100% of traces are reproted or how often the metrics are reported to the backend.</li>
</ol>
<pre><code class="language-prettyprint">management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
management.otlp.tracing.timeout=10s
management.tracing.sampling.probability=1

management.otlp.metrics.export.url=http://localhost:4318/v1/metrics
management.otlp.metrics.export.step=5s
management.opentelemetry.resource-attributes.&quot;service-name&quot;=${spring.application.name}
</code></pre>
<h2>Testing and E2E sample</h2>
<h3>Generating workload data</h3>
<p>The POC provides the following structure</p>
<pre><code class="language-prettyprint">├── podman # Podman compose config files
├── springboot-client-demo #Spring Boot Client instrumented with Actuator, Micrometer and MicroMeter tracing 
└── springboot-demo #Spring Boot service instrumented with OpenTelemetry Spring Boot Starter

</code></pre>
<ol>
<li>The first step is to boot the observability stack we created previously.</li>
</ol>
<pre><code class="language-prettyprint">cd podman
podman compose -f otel-compose.yml up
</code></pre>
<p>This will provide you an instance of Grafana on port 3000</p>
<p><img src="/images/posts/opentelemetry/grafana.png" alt="Grafana" title="Grafana" /></p>
<p>Then, it is time to boot the first service!. You only need Java 21 on the active shell:</p>
<pre><code class="language-prettyprint">cd springboot-demo
mvn spring-boot:run
</code></pre>
<p>If the workload is properly configured, you will see the following information on the OpenTelemetry container standard output. Which basically says you are successfully reporting data.</p>
<pre><code class="language-prettyprint">[otel]       | 2024-12-01T22:10:07.730Z info    Logs    {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;logs&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource logs&quot;: 1, &quot;log records&quot;: 24}
[otel]       | 2024-12-01T22:10:10.671Z info    Metrics {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;metrics&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource metrics&quot;: 1, &quot;metrics&quot;: 64, &quot;data points&quot;: 90}
[otel]       | 2024-12-01T22:10:10.672Z info    Traces  {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;traces&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource spans&quot;: 1, &quot;spans&quot;: 5}
[otel]       | 2024-12-01T22:10:15.691Z info    Metrics {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;metrics&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource metrics&quot;: 1, &quot;metrics&quot;: 65, &quot;data points&quot;: 93}
[otel]       | 2024-12-01T22:10:15.833Z info    Metrics {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;metrics&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource metrics&quot;: 1, &quot;metrics&quot;: 65, &quot;data points&quot;: 93}
[otel]       | 2024-12-01T22:10:15.835Z info    Logs    {&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;logs&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource logs&quot;: 1, &quot;log records&quot;: 5}
</code></pre>
<p><strong>The data is being reported over the OpenTelemetry ports (4317 and 4318)</strong> which are open from Podman to the host. By default all telemetry libraries report to localhost, but this can be configured for other cases like FaaS or Kubernetes.</p>
<p>Also, you could verify the reporting status in ZPages</p>
<p><img src="/images/posts/opentelemetry/zpages.png" alt="Zpages" title="Zpages" /></p>
<p>Finally let's do the same with Spring Boot client:</p>
<pre><code class="language-prettyprint">cd springboot-client-demo
mvn spring-boot:run
</code></pre>
<p>As described in the previous section, I created a set of interactions to:</p>
<p>Generate CPU workload using Naive fibonacci</p>
<pre><code class="language-prettyprint">curl http://localhost:8080/fibo\?n\=45
</code></pre>
<p>Generate logs in different levels</p>
<pre><code class="language-prettyprint">curl http://localhost:8080/fibo\?n\=45
</code></pre>
<p>Persist data using a CRUD</p>
<pre><code class="language-prettyprint">curl -X POST --location &quot;http://localhost:8080/books&quot; \
-H &quot;Content-Type: application/json&quot; \
-d '{
&quot;author&quot;: &quot;Miguel Angel Asturias&quot;,
&quot;title&quot;: &quot;El señor presidente&quot;,
&quot;isbn&quot;: &quot;978-84-376-0494-7&quot;,
&quot;publisher&quot;: &quot;Editorial planeta&quot;
}'
</code></pre>
<p>And then retrieve the data using a secondary service</p>
<pre><code class="language-prettyprint">curl http://localhost:8081/trace-demo 
</code></pre>
<p>This asciicast shows the interaction:</p>
<p><a href="https://asciinema.org/a/692968"><img src="https://asciinema.org/a/692968.svg" alt="asciicast" /></a></p>
<h3>Grafana results</h3>
<p>Once the data is accesible by Grafana, the <em>what</em> to do with data is up to you, again, you could:</p>
<ul>
<li>Create dashboards</li>
<li>Configure alarms</li>
<li>Configure notifications from alarms</li>
</ul>
<p>The quickest way to verify if the data is reported correctly is to verify directly in Grafana explore.</p>
<p>First, <strong>we can check some metrics like <em>system_cpu_usage</em> and filter by service name</strong>. In this case I used <code>springboot-demo</code> which has the CPU demo using naive fibonacci, I can even filter by my own tag (which was added by Otel processor):</p>
<p><img src="/images/posts/opentelemetry/grafanametrics.png" alt="Grafana Metrics" title="Grafana Metrics" /></p>
<p>In the same way, logs are already stored in Loki:</p>
<p><img src="/images/posts/opentelemetry/grafanalogs.png" alt="Grafana Logs" title="Grafana Logs" /></p>
<p>Finally, we could check the whole trace, including both services and interaction with H2 RDBMS:</p>
<p><img src="/images/posts/opentelemetry/grafanatraces.png" alt="Grafana Traces" title="Grafana Traces" /></p>
</p>
        <a href="../blog/2021/2021-09-24-Book-review-Practical-Cloud-Native-MicroProfile.html"><h1>Book Review: Practical Cloud-Native Java Development with MicroProfile</h1></a>
        <p>24 September 2021</p>
        <p><p><img src="/images/posts/practicalcn/cover.png" alt="Practical Cloud-Native Java Development with MicroProfile cover" title="Practical Cloud-Native Java Development with MicroProfile" /></p>
<h2>General information</h2>
<ul>
<li>Pages: 403</li>
<li>Published by: Packt</li>
<li>Release date: Aug 2021</li>
</ul>
<blockquote>
<p>Disclaimer: I received this book as a collaboration with Packt and one of the authors (Thanks Emily!)</p>
</blockquote>
<h2>A book about Microservices for the Java Enterprise-shops</h2>
<p>Year after year many enterprise companies are struggling to embrace Cloud Native practices that we tend to denominate as Microservices, however <a href="https://microservices.io/patterns/microservices.html">Microservices is a metapattern</a> that needs to follow a well defined approach, like:</p>
<ul>
<li>(We aim for) reactive systems</li>
<li>(Hence we need a methodology like) 12 Cloud Native factors</li>
<li>(Implementing) well-known design patterns</li>
<li>(Dividing the system by using) Domain Driven Design</li>
<li>(Implementing microservices via) Microservices chassis and/or service mesh</li>
<li>(Achieving deployments by) Containers orchestration</li>
</ul>
<p>Many of these concepts require a considerable amount of context, but some books, tutorials, conferences and YouTube videos tend to focus on specific niche information, making difficult to have a &quot;cold start&quot; in the microservices space if you have been developing regular/monolithic software. For me, <strong>that's the best thing about this book, it provides a holistic view to understand microservices with Java and MicroProfile for &quot;cold starter developers&quot;</strong>.</p>
<h2>About the book</h2>
<p>Using a software architect perspective, <strong>MicroProfile could be defined as a set of specifications (APIs) that many microservices chassis implement in order to solve common microservices problems through patterns, lessons learned from well known Java libraries</strong>, and proposals for collaboration between Java Enterprise vendors.</p>
<p>Subsequently if you think that it sounds a lot like Java EE, that's right, <strong>it's the same spirit but on the microservices space with participation for many vendors</strong>, including vendors from the Java EE space -e.g. Red Hat, IBM, Apache, Payara-.</p>
<p>The main value of this book is <strong>the willingness to go beyond the APIs</strong>, providing four structured sections that have different writing styles, for instance:</p>
<ol>
<li>Section 1: Cloud Native Applications - Written as a didactical resource to learn fundamentals of distributed systems with Cloud Native approach</li>
<li>Section 2: MicroProfile Deep Dive - Written as a reference book with code snippets to understand the motivation, functionality and specific details in MicroProfile APIs and the relation between these APIs and common Microservices patterns -e.g. Remote procedure invocation, Health Check APIs, Externalized configuration-</li>
<li>Section 3: End-to-End Project Using MicroProfile - Written as a narrative workshop with source code already available, to understand the development and deployment process of Cloud Native applications with MicroProfile</li>
<li>Section 4: The standalone specifications - Written as a reference book with code snippets, it describes the development of newer specs that could be included in the future under MicroProfile's umbrella</li>
</ol>
<h3>First section</h3>
<p>This was by far my favorite section. <strong>This section presents a well-balanced overview about Cloud Native practices</strong> like:</p>
<ul>
<li>Cloud Native definition</li>
<li>The role of microservices and the differences with monoliths and FaaS</li>
<li>Data consistency with event sourcing</li>
<li>Best practices</li>
<li>The role of MicroProfile</li>
</ul>
<p>I enjoyed this section because my current role is to coach or act as a software architect at different companies, hence <strong>this is good material to explain the whole panorama to my coworkers and/or use this book as a quick reference</strong>.</p>
<p>My only concern with this section is about the final chapter, this chapter presents an application called IBM Stock Trader that (as you probably guess) IBM uses to demonstrate these concepts using MicroProfile with OpenLiberty. The chapter by itself presents an application that combines data sources, front/ends, Kubernetes; however the application would be useful only on Section 3 (at least that was my perception). Hence you will be going back to this section once you're executing the workshop.</p>
<h3>Second section</h3>
<p>This section divides the MicroProfile APIs in three levels, the division actually makes a lot of sense but was evident to me only during this review:</p>
<ol>
<li>The base APIs to create microservices (JAX-RS, CDI, JSON-P, JSON-B, Rest Client)</li>
<li>Enhancing microservices (Config, Fault Tolerance, OpenAPI, JWT)</li>
<li>Observing microservices (Health, Metrics, Tracing)</li>
</ol>
<p>Additionally, <strong>section also describes the need for Docker and Kubernetes and how other common approaches -e.g. Service mesh- overlap with Microservice Chassis functionality</strong>.</p>
<p>Currently I'm a MicroProfile user, hence I knew most of the APIs, however I liked the actual description of the pattern/need that motivated the inclusion of the APIs, and the description could be useful for newcomers, along with the code snippets also available on GitHub.</p>
<p>If you're a Java/Jakarta EE developer you will find the CDI section a little bit superficial, <strong>indeed CDI by itself deserves a whole book/fascicle</strong> but this chapter gives the basics to start the development process.</p>
<h3>Third section</h3>
<p>This section switches the writing style to a workshop style. <strong>The first chapter is entirely focused on how to compile the sample microservices</strong>, how to fulfill the technical requirements and which MicroProfile APIs are used on every microservice.</p>
<p>You must notice that this is not a Java programming workshop, it's a Cloud Native workshop with ready to deploy microservices, hence the step by step guide is about compilation with Maven, Docker containers, scaling with Kubernetes, operators in Openshift, etc.</p>
<p>You could explore and change the source code if you wish, but the section is written in a &quot;descriptive&quot; way assuming the samples existence.</p>
<h3>Fourth section</h3>
<p>This section is pretty similar to the second section in the reference book style, hence it also describes the pattern/need that motivated the discussion of the API and code snippets. <strong>The main focus of this section is GraphQL, Reactive Approaches and distributed transactions with LRA</strong>.</p>
<p>This section will probably change in future editions of the book because at the time of publishing the Cloud Native Container Foundation revealed that some initiatives about observability will be integrated in the OpenTelemetry project and MicroProfile it's discussing their future approach.</p>
<h2>Things that could be improved</h2>
<p>As any review this is the most difficult section to write, but I think that a second edition should:</p>
<ul>
<li>Extend the CDI section due its foundational status</li>
<li>Switch the order of the Stock Tracer presentation</li>
<li>Extend the data consistency discussión -e.g. CQRS, Event Sourcing-, hopefully with advances from LRA</li>
</ul>
<p>The last item is mostly a wish since I'm always in the need for better ways to integrate this common practices with buses like Kafka or Camel using MicroProfile. I know that some implementations -e.g. Helidon, Quarkus- already have extensions for Kafka or Camel, but <strong>the data consistency is an entire discussion about patterns, tools and best practices</strong>.</p>
<h2>Who should read this book?</h2>
<ul>
<li>Java developers with strong SE foundations and familiarity with the enterprise space (Spring/Java EE)</li>
</ul>
</p>
        <a href="../blog/2020/2020-08-21-considerations-bumping-javaee.html"><h1>General considerations on updating Enterprise Java projects from Java 8 to Java 11</h1></a>
        <p>23 September 2020</p>
        <p><p><img src="/images/posts/java8java11/shell11.png" alt="shell11" title="shell11" /></p>
<p>The purpose of this article is to <strong>consolidate all difficulties and solutions that I've encountered while updating Java EE projects from Java 8 to Java 11 (and beyond)</strong>. It's a known fact that Java 11 has a lot of new characteristics that are revolutionizing how Java is used to create applications, despite being problematic under certain conditions.</p>
<p>This article is focused on Java/Jakarta EE but it could be used as basis for other enterprise Java frameworks and libraries migrations.</p>
<h2>Is it possible to update Java EE/MicroProfile projects from Java 8 to Java 11?</h2>
<p>Yes, absolutely. <a href="https://nabenik.com">My team</a> has been able to bump at least two mature enterprise applications with more than three years in development, being:</p>
<h3>A Management Information System (MIS)</h3>
<p><img src="/images/posts/java8java11/erp-1024x508.png" alt="Nabenik MIS" title="Nabenik MIS" /></p>
<ul>
<li>Time for migration: 1 week</li>
<li>Modules: 9 EJB, 1 WAR, 1 EAR</li>
<li>Classes: 671 and counting</li>
<li>Code lines: 39480</li>
<li>Project's beginning: 2014</li>
<li>Original platform: Java 7, Wildfly 8, Java EE 7</li>
<li>Current platform: Java 11, Wildfly 17, Jakarta EE 8, MicroProfile 3.0</li>
<li>Web client: Angular</li>
</ul>
<h3>Mobile POS and Geo-fence</h3>
<p><img src="/images/posts/java8java11/rep-1024x467.png" alt="Medmigo REP" title="Medmigo REP" /></p>
<ul>
<li>Time for migration: 3 week</li>
<li>Modules: 5 WAR/MicroServices</li>
<li>Classes: 348 and counting</li>
<li>Code lines: 17160</li>
<li>Project's beginning: 2017</li>
<li>Original platform: Java 8, Glassfish 4, Java EE 7</li>
<li>Current platform: Java 11, Payara (Micro) 5, Jakarta EE 8, MicroProfile 3.2</li>
<li>Web client: Angular</li>
</ul>
<h2>Why should I ever consider migrating to Java 11?</h2>
<p>As everything in IT the answer is &quot;It depends . . .&quot;. However there are a couple of good reasons to do it:</p>
<ol>
<li>Reduce <a href="https://securitytrails.com/blog/attack-surface">attack surface</a> by updating project dependencies proactively</li>
<li>Reduce <a href="https://dzone.com/articles/dealing-technical-debt">technical debt</a> and most importantly, prepare your project for the new and dynamic Java world</li>
<li>Take advantage of <a href="https://optaweb.org/blog/2019/01/17/HowMuchFasterIsJava11.html">performance improvements</a> on new JVM versions</li>
<li>Take advantage from improvements of <a href="https://www.forbes.com/sites/oracle/2020/04/02/java-14-makes-code-super-expressive-say-top-developers/">Java as programming language</a></li>
<li>Sleep better by having a more secure, efficient and quality product</li>
</ol>
<h2>Why Java updates from Java 8 to Java 11 are considered difficult?</h2>
<p>From my experience with many teams, because of this:</p>
<h3>Changes in Java release cadence</h3>
<p><img src="/images/posts/java8java11/javareleasecadence.png" alt="Java Release Cadence" title="Java Release Cadence" /></p>
<p>Currently, there are <a href="https://www.oracle.com/java/technologies/java-se-support-roadmap.html">two big branches in JVMs release model</a>:</p>
<ul>
<li>Java LTS: With a fixed lifetime (3 years) for long term support, being Java 11 the latest one</li>
<li>Java current: A fast-paced Java version that is available every 6 months over a predictable calendar, being Java 15 the latest (at least at the time of publishing for this article)</li>
</ul>
<p>The rationale behind this decision is that <strong>Java needed dynamism in providing new characteristics to the language, API and JVM</strong>, which I really agree.</p>
<p>Nevertheless, <strong>it is a know fact that most enterprise frameworks seek and use Java for stability</strong>. Consequently, most of these frameworks target Java 11 as &quot;certified&quot; Java Virtual Machine for deployments.</p>
<h3>Usage of internal APIs</h3>
<p><img src="/images/posts/java8java11/versiones-1024x516.png" alt="Java 9" title="Java 9" /></p>
<p>Errata: I <a href="https://www.reddit.com/r/java/comments/iyknaa/general_considerations_on_updating_enterprise/">fixed and simplified this section following an interesting discussion on reddit :)</a></p>
<p><strong>Java 9 introduced changes in internal classes that weren't meant for usage outside JVM</strong>, preventing/breaking the functionality of popular libraries that made use of these internals -e.g. Hibernate, ASM, Hazelcast- to gain performance.</p>
<p>Hence to avoid it, internal APIs in JDK 9 are inaccessible at compile time (but accesible with --add-exports), remaining accessible if they were in JDK 8 but in a future release they will become inaccessible, <strong>in the long run this change will reduce the costs borne by the maintainers of the JDK itself and by the maintainers of libraries and applications that, knowingly or not, make use of these internal APIs</strong>.</p>
<p>Finally, during the introduction of JEP-260 internal APIs were classified as critical and non-critical, consequently critical internal APIs for which replacements are introduced in JDK 9 are deprecated in JDK 9 and will be either encapsulated or removed in a future release.</p>
<p>However, you are inside the danger zone if:</p>
<ol>
<li>Your project compiles against dependencies pre-Java 9 depending on critical internals</li>
<li>You bundle dependencies pre-Java 9 depending on critical internals</li>
<li>You run your applications over a runtime -e.g. Application Servers- that include pre Java 9 transitive dependencies</li>
</ol>
<p>Any of these situations means that your application has a probability of not being compatible with JVMs above Java 8. At least not without updating your dependencies, which also could uncover breaking changes in library APIs creating mandatory refactors.</p>
<h3>Removal of CORBA and Java EE modules from OpenJDK</h3>
<p><img src="/images/posts/java8java11/jep320.png" alt="JEP230" title="JEP230" /></p>
<p>Also during Java 9 release, many Java EE and CORBA modules <a href="https://cr.openjdk.java.net/~iris/se/9/java-se-9-fr-spec/#APIs-proposed-for-removal">were marked as deprecated</a>, <strong>being effectively <a href="https://openjdk.java.net/jeps/320">removed at Java 11</a></strong>, specifically:</p>
<ul>
<li>java.xml.ws (JAX-WS, plus the related technologies SAAJ and Web Services Metadata)</li>
<li>java.xml.bind (JAXB)</li>
<li>java.activation (JAF)</li>
<li>java.xml.ws.annotation (Common Annotations)</li>
<li>java.corba (CORBA)</li>
<li>java.transaction (JTA)</li>
<li>java.se.ee (Aggregator module for the six modules above)</li>
<li>jdk.xml.ws (Tools for JAX-WS)</li>
<li>jdk.xml.bind (Tools for JAXB)</li>
</ul>
<p>As JEP-320 states, many of these modules were included in Java 6 as a convenience to generate/support SOAP Web Services. But these modules eventually took off as independent projects already available at Maven Central. <strong>Therefore it is necessary to include these as dependencies</strong> if our project implements services with JAX-WS and/or depends on any library/utility that was included previously.</p>
<h3>IDEs and application servers</h3>
<p><img src="/images/posts/java8java11/eclipse11.png" alt="Eclipse" title="Eclipse" /></p>
<p>In the same way as libraries, Java IDEs had to catch-up with the introduction of Java 9 at least in three levels:</p>
<ol>
<li>IDEs as Java programs should be compatible with Java Modules</li>
<li>IDEs should support new Java versions as programming language -i.e. Incremental compilation, linting, text analysis, modules-</li>
<li>IDEs are also basis for an ecosystem of plugins that are developed independently. Hence if plugins have any transitive dependency with issues over JPMS, these also have to be updated</li>
</ol>
<p>Overall, none of the Java IDEs guaranteed that plugins will work in JVMs above Java 8. Therefore you could possibly run your IDE over Java 11 but a legacy/deprecated plugin could prevent you to run your application.</p>
<h2>How do I update?</h2>
<p>You must notice that Java 9 launched three years ago, hence the situations previously described are mostly covered. However you should do the following verifications and actions to prevent failures in the process:</p>
<ol>
<li>Verify server compatibility</li>
<li>Verify if you need a specific JVM due support contracts and conditions</li>
<li>Configure your development environment to support multiple JVMs during the migration process</li>
<li>Verify your IDE compatibility and update</li>
<li>Update Maven and Maven projects</li>
<li>Update dependencies</li>
<li>Include Java/Jakarta EE dependencies</li>
<li>Execute multiple JVMs in production</li>
</ol>
<h3>Verify server compatibility</h3>
<p><img src="/images/posts/java8java11/tomcat.png" alt="Tomcat" title="Tomcat" /></p>
<p><strong><a href="https://www.oreilly.com/radar/rethinking-programming/">Mike Luikides from O'Reilly affirms</a> that there are two types of programmers</strong>. In one hand we have the low level programmers that create tools as libraries or frameworks, and on the other hand we have developers that use these tools to create experience, products and services.</p>
<p><strong>Java Enterprise is mostly on the second hand, the &quot;productive world&quot; resting in giant's shoulders</strong>. That's why you should check first if your runtime or framework already has a version compatible with Java 11, and also if you have the time/decision power to proceed with an update. If not, any other action from this point is useless.</p>
<p>The good news is that most of the popular servers in enterprise Java world are already compatible, like:</p>
<ul>
<li><a href="http://tomcat.apache.org/whichversion.html">Apache Tomcat</a></li>
<li><a href="https://winterbe.com/posts/2018/08/29/migrate-maven-projects-to-java-11-jigsaw/">Apache Maven</a></li>
<li><a href="https://spring.io/blog/2020/03/11/spring-tips-java-14-or-can-your-java-do-this">Spring</a></li>
<li><a href="https://docs.oracle.com/en/middleware/standalone/weblogic-server/14.1.1.0/notes/whatsnew.html">Oracle WebLogic</a></li>
<li><a href="https://blog.payara.fish/jdk-11-support-available-in-payara-platform-194">Payara</a></li>
<li><a href="http://tomee-openejb.979440.n4.nabble.com/Does-TomEE-8-0-0-run-on-Java-11-td4690633.html">Apache TomEE</a><br />
... among others</li>
</ul>
<p>If you happen to depend on non compatible runtimes, <strong>this is where the road ends unless you support the maintainer to update it</strong>.</p>
<h3>Verify if you need an specific JVM</h3>
<p><img src="/images/posts/java8java11/fixes.png" alt="FixesJDK15" title="FixesJDK15" /></p>
<p>On a non-technical side, under support contract conditions you could be obligated to use an specific JVM version.</p>
<p><strong>OpenJDK by itself is an open source project receiving contributions from many companies (being Oracle the most active contributor)</strong>, but nothing prevents any other company to compile, pack and TCK other JVM distribution as demonstrated by <a href="https://aws.amazon.com/corretto/">Amazon Correto</a>, <a href="https://www.azul.com/downloads/zulu-community/">Azul Zulu</a>, <a href="https://bell-sw.com/">Liberica JDK</a>, etc.</p>
<p>In short, there is software that technically could run over any JVM distribution and version, but the support contract will ask you for a particular version. For instance:</p>
<ul>
<li>WebLogic is only <a href="https://docs.oracle.com/en/middleware/standalone/weblogic-server/14.1.1.0/notes/whatsnew.html#GUID-960100E8-DFC1-49E5-8CED-1EC1D883A42F">certified for Oracle HotSpot and GraalVM</a></li>
<li>SAP Netweaver <a href="https://wiki.scn.sap.com/wiki/display/ASJAVA/SAP%20JVM%20Netweaver%20compatibility%20and%20Installation">includes by itself SAP JVM</a></li>
</ul>
<h3>Configure your development environment to support multiple JDKs</h3>
<p>Since the jump from Java 8 to Java 11 is mostly an experimentation process, it is a good idea to install multiple JVMs on the development computer, being SDKMan and jEnv the common options:</p>
<h4>SDKMan</h4>
<p><img src="/images/posts/java8java11/sdkman.jpg" alt="sdkman" title="sdkman" /></p>
<p>SDKMan is available for Unix-Like environments (Linux, Mac OS, Cygwin, BSD) and as the name suggests, acts as a Java tools package manager.</p>
<p>It helps to install and manage JVM ecosystem tools -e.g. Maven, Gradle, Leiningen- and also <a href="https://sdkman.io/jdks">multiple JDK installations</a> from different providers.</p>
<h4>jEnv</h4>
<p><img src="/images/posts/java8java11/jenv.png" alt="jenv" title="jenv" /></p>
<p>Also available for Unix-Like environments (Linux, Mac OS, Cygwin, BSD), jEnv is basically a script to manage and switch multiple JVM installations per system, user and shell.</p>
<p>If you happen to install JDKs from different sources -e.g Homebrew, Linux Repo, Oracle Technology Network- it is a good choice.</p>
<p>Finally, if you use Windows the common alternative is to <a href="https://blogs.oracle.com/pranav/switch-between-different-jdk-versions-in-windows">automate the switch using .bat files</a> however I would appreciate any other suggestion since I don't use Windows so often.</p>
<h3>Verify your IDE compatibility and update</h3>
<p>Please remember that any IDE ecosystem is composed by three levels:</p>
<ol>
<li>The IDE acting as platform</li>
<li>Programming language support</li>
<li>Plugins to support tools and libraries</li>
</ol>
<p>After updating your IDE, you should also verify if all of the plugins that make part of your development cycle work fine under Java 11.</p>
<h3>Update Maven and Maven projects</h3>
<p><img src="/images/posts/java8java11/maven.png" alt="maven" title="maven" /></p>
<p>Probably the most common choice in Enterprise Java is Maven, and many IDEs use it under the hood or explicitly. Hence, you should update it.</p>
<p>Besides installation, please remember that Maven has a modular architecture and Maven modules version could be forced on any project definition. So, as rule of thumb you should also update these modules in your projects to the <a href="https://maven.apache.org/pom-archives/default-plugins-LATEST/plugin-management.html">latest stable version</a>.</p>
<p>To verify this quickly, you could use <a href="https://www.mojohaus.org/versions-maven-plugin/">versions-maven-plugin</a>:</p>
<pre><code class="language-prettyprint">&lt;plugin&gt;
      &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
      &lt;artifactId&gt;versions-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.8.1&lt;/version&gt;
&lt;/plugin&gt;
</code></pre>
<p>Which includes a specific goal to verify Maven plugins versions:</p>
<pre><code class="language-prettyprint">mvn versions:display-plugin-updates
</code></pre>
<p><img src="/images/posts/java8java11/maven-versions-output.png" alt="mavenversions" title="mavenversions" /></p>
<p>After that, you also need to configure Java source and target compatibility, generally this is achieved in two points.</p>
<p>As properties:</p>
<pre><code class="language-prettyprint">&lt;properties&gt;
        ...
    &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;
&lt;/properties&gt;
</code></pre>
<p>As configuration on Maven plugins, specially in maven-compiler-plugin:</p>
<pre><code class="language-prettyprint">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.8.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;release&gt;11&lt;/release&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<p>Finally, some plugins need to &quot;break&quot; the barriers imposed by Java Modules and Java Platform Teams knows about it. Hence JVM has an <a href="https://docs.oracle.com/javase/9/tools/java.htm#JSWOR624">argument called illegal-access</a> to allow this, at least during Java 11.</p>
<p>This could be a good idea in plugins like surefire and failsafe which also invoke runtimes that depend on this flag (like Arquillian tests):</p>
<pre><code class="language-prettyprint">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.22.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --illegal-access=permit
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.22.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;argLine&gt;
            --illegal-access=permit
        &lt;/argLine&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<h3>Update project dependencies</h3>
<p>As mentioned before, you need to check for compatible versions on your Java dependencies. Sometimes these libraries could introduce breaking changes on each major version -e.g. Flyway- and you should consider a time to refactor this changes.</p>
<p>Again, if you use Maven <a href="https://www.mojohaus.org/versions-maven-plugin/">versions-maven-plugin</a> has a goal to verify dependencies version. The plugin will inform you about available updates.:</p>
<pre><code class="language-prettyprint">mvn versions:display-dependency-updates
</code></pre>
<p><img src="/images/posts/java8java11/maven-dependency-update.png" alt="mavendependency" title="mavendependency" /></p>
<p>In the particular case of Java EE, you already have an advantage. <strong>If you depend only on APIs -e.g. Java EE, MicroProfile- and not particular implementations, many of these issues are already solved for you</strong>.</p>
<h3>Include Java/Jakarta EE dependencies</h3>
<p><img src="/images/posts/java8java11/jakarta.png" alt="jakarta" title="jakarta" /></p>
<p>Probably modern REST based services won't need this, <strong>however in projects with heavy usage of SOAP and XML marshalling is mandatory to include the Java EE modules removed on Java 11</strong>. Otherwise your project won't compile and run.</p>
<p>You must include as dependency:</p>
<ul>
<li>API definition</li>
<li>Reference Implementation (if needed)</li>
</ul>
<p><strong>At this point is also a good idea to evaluate if you could move to Jakarta EE</strong>, <a href="https://dzone.com/articles/jakarta-ee-generation-iv-a-new-hope">the evolution of Java EE under Eclipse Foundation</a>.</p>
<p>Jakarta EE 8 is practically Java EE 8 with another name, but it retains package and features compatibility, <a href="https://jakarta.ee/compatibility/">most of application servers are in the process or already have Jakarta EE certified implementations</a>:</p>
<p>We could swap the Java EE API:</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax&lt;/groupId&gt;
    &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;
    &lt;version&gt;8.0.1&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>For Jakarta EE API:</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.platform&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.jakartaee-api&lt;/artifactId&gt;
    &lt;version&gt;8.0.0&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>After that, please include any of these dependencies (if needed):</p>
<h4>Java Beans Activation</h4>
<p>Java EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax.activation&lt;/groupId&gt;
    &lt;artifactId&gt;javax.activation-api&lt;/artifactId&gt;
    &lt;version&gt;1.2.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Jakarta EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.activation&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.activation-api&lt;/artifactId&gt;
    &lt;version&gt;1.2.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4>JAXB (Java XML Binding)</h4>
<p>Java EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;
    &lt;version&gt;2.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Jakarta EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;
    &lt;version&gt;2.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Implementation</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;
    &lt;version&gt;2.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4>JAX-WS</h4>
<p>Java EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax.xml.ws&lt;/groupId&gt;
    &lt;artifactId&gt;jaxws-api&lt;/artifactId&gt;
    &lt;version&gt;2.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Jakarta EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.xml.ws&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.xml.ws-api&lt;/artifactId&gt;
    &lt;version&gt;2.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Implementation (runtime)</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;
    &lt;artifactId&gt;jaxws-rt&lt;/artifactId&gt;
    &lt;version&gt;2.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Implementation (standalone)</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;com.sun.xml.ws&lt;/groupId&gt;
    &lt;artifactId&gt;jaxws-ri&lt;/artifactId&gt;
    &lt;version&gt;2.3.2-1&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre>
<h4>Java Annotation</h4>
<p>Java EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax.annotation&lt;/groupId&gt;
    &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;
    &lt;version&gt;1.3.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Jakarta EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.annotation&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.annotation-api&lt;/artifactId&gt;
    &lt;version&gt;1.3.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4>Java Transaction</h4>
<p>Java EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax.transaction&lt;/groupId&gt;
    &lt;artifactId&gt;javax.transaction-api&lt;/artifactId&gt;
    &lt;version&gt;1.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>Jakarta EE</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.transaction&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.transaction-api&lt;/artifactId&gt;
    &lt;version&gt;1.3.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3>CORBA</h3>
<p>In the particular case of CORBA, I'm aware of its adoption. <a href="https://github.com/eclipse-ee4j/orb">There is an independent project in eclipse to support CORBA</a>, based on Glassfish CORBA, but this should be investigated further.</p>
<h2>Multiple JVMs in production</h2>
<p>If everything compiles, tests and executes. You did a successful migration.</p>
<p>Some deployments/environments run multiple application servers over the same Linux installation. <strong>If this is your case it is a good idea to install multiple JVMs</strong> to allow stepped migrations instead of big bang.</p>
<p>For instance, RHEL based distributions like <a href="https://blogs.igalia.com/dpino/2011/10/13/configuring-different-jdks-with-alternatives/">CentOS, Oracle Linux or Fedora</a> include various JVM versions:</p>
<p><img src="/images/posts/java8java11/olinux.png" alt="olinux" title="olinux" /></p>
<p>Most importantly, If you install JVMs outside directly from RPMs(like Oracle HotSpot), Java alternatives will give you support:</p>
<p><img src="/images/posts/java8java11/hotspot.png" alt="hotspot" title="hotspot" /></p>
<p><strong>However on modern deployments probably would be better to use Docker, specially on Windows</strong> which also needs .bat script to automate this task. Most of the JVM distributions are also available on Docker Hub:</p>
<p><img src="/images/posts/java8java11/dockerjava.png" alt="dockerjava" title="dockerjava" /></p>
</p>
        <a href="../blog/2019/2019-10-02-MicroProfile-JWT-Token-Provider-Servlet.html"><h1>A simple MicroProfile JWT token provider with Payara realms and JAX-RS</h1></a>
        <p>02 October 2019</p>
        <p><p><img src="/images/posts/jwtrealm/armor.png" alt="Armor" title="Armor" /></p>
<p>In this tutorial I will demonstrate <strong>how to create a &quot;simple&quot; (yet practical) token provider using Payara realms as users/groups store</strong>, with a couple of tweaks it's applicable to any MicroProfile implementation (since all implementations support JAX-RS).</p>
<p>In short this guide will:</p>
<ul>
<li>Create a public/private key in <a href="https://en.wikipedia.org/wiki/PKCS_1">RSASSA-PKCS-v1_5</a> format to sign tokens</li>
<li>Create user, password and fixed groups on Payara file realm (groups will be web and mobile)</li>
<li>Create a vanilla JakartaEE + MicroProfile project</li>
<li>Generate tokens that are compatible with MicroProfile JWT specification using <a href="https://connect2id.com/products/nimbus-jose-jwt">Nimbus JOSE</a></li>
</ul>
<h2>Create a public/private pair</h2>
<p><a href="https://www.eclipse.org/community/eclipse_newsletter/2017/september/article2.php">MicroProfile JWT</a> establishes that <strong>tokens should be signed by using RSASSA-PKCS-v1_5 signature with SHA-256 hash algorithm</strong>.</p>
<p>The general idea behind this is to generate a private key that will be used on token provider, subsequently the clients only need the public key to verify the signature. One of the &quot;simple&quot; ways to do this is by generating an SSH keypair using OpenSSL.</p>
<p>First it is necessary to generate a base key to be signed:</p>
<pre><code class="language-prettyprint">openssl genrsa -out baseKey.pem
</code></pre>
<p>From the base key generate the PKCS#8 private key:</p>
<pre><code class="language-prettyprint">openssl pkcs8 -topk8 -inform PEM -in baseKey.pem -out privateKey.pem -nocrypt
</code></pre>
<p>Using the private key you could generate a public (and distributable) key</p>
<pre><code class="language-prettyprint">openssl rsa -in baseKey.pem -pubout -outform PEM -out publicKey.pem
</code></pre>
<p>Finally some crypto libraries like <a href="https://github.com/SAMLRaider/SAMLRaider/issues/37">bouncy castle only accept traditional RSA keys</a>, hence it is safe to convert it using also openssl:</p>
<pre><code class="language-prettyprint">openssl rsa -in privateKey.pem -out myprivateKey.pem
</code></pre>
<p>At the end <code>myprivateKey.pem</code> could be used to sign the tokens and <code>publicKey.pem</code> could be distributed to any potential consumer.</p>
<h2>Create user, password and groups on Payara realm</h2>
<p>According to <a href="https://docs.oracle.com/cd/E19798-01/821-1751/gkbiy/index.html">Glassfish documentation</a>, the general idea of realms is to <strong>provide a security policy for domains, being able to contain users and groups and consequently assign users to groups</strong>, these realms could be created using:</p>
<ul>
<li>File containers</li>
<li>Certificates databases</li>
<li>LDAP directories</li>
<li>Plain old JDBC</li>
<li>Solaris</li>
<li>Custom realms</li>
</ul>
<p>For tutorial purposes a file realm will be used but any properly configured Realm should work.</p>
<p>On vanilla Glassfish installations <code>domain 1</code> uses <code>server-config</code> configuration, thus to create the realm you need to go to <code>server-config -&gt; Security -&gt; Realms</code> and add a new realm, in this tutorial <code>burgerland</code> will be created with the following configuration:</p>
<ul>
<li>Name: burgerland</li>
<li>Class name: com.sun.enterprise.security.auth.realm.file.FileRealm</li>
<li>JAAS Context: fileRealm</li>
<li>Key file: ${com.sun.aas.instanceRoot}/config/burgerlandkeyfile</li>
</ul>
<p><img src="/images/posts/jwtrealm/realmcreation.png" alt="Realm Creation" title="Realm Creation" /></p>
<p>Once the realm is ready we can add two users/password with different roles (<code>web</code>, <code>mobile</code>), being <code>ronald</code> and <code>king</code>, final result should look like this:</p>
<p><img src="/images/posts/jwtrealm/users.png" alt="Users Creation" title="Users Creation" /></p>
<h2>Create a vanilla JakartaEE project</h2>
<p>In order to generate the Tokens, we need to create a greenfield application, this could be achieved by using <a href="https://github.com/AdamBien/javaee8-essentials-archetype">javaee8-essentials-archetype</a> with the following command:</p>
<pre><code class="language-prettyprint">mvn archetype:generate -Dfilter=com.airhacks:javaee8-essentials-archetype -Dversion=0.0.4
</code></pre>
<p>As usual archetype assistant will ask for project details, project will be named <code>microjwt-provider</code>:</p>
<p><img src="/images/posts/jwtrealm/archetype.png" alt="Project Creation" title="Project Creation" /></p>
<p>Now, it is necessary to copy the <code>myprivateKey.pem</code> file generated at section 1 to project's classpath using Maven structure, specifically to <code>src/main/resources</code>, <strong>to avoid any confussion I also renamed this file to <code>privateKey.pem</code></strong>, the final structure will look like this:</p>
<pre><code class="language-prettyprint">microjwt-provider$ tree
.
├── buildAndRun.sh
├── Dockerfile
├── pom.xml
├── README.md
└── src
    └── main
        ├── java
        │   └── com
        │       └── airhacks
        │           ├── JAXRSConfiguration.java
        │           └── ping
        │               └── boundary
        │                   └── PingResource.java
        ├── resources
        │   ├── META-INF
        │   │   └── microprofile-config.properties
        │   └── privateKey.pem
        └── webapp
            └── WEB-INF
                └── beans.xml
</code></pre>
<p>You could get rid of source code since application will be bootstrapped using a different package structure :-).</p>
<h2>Generating MP compliant tokens from Payara realm</h2>
<p>In order to create a provider, <strong>we will create a project with a central JAX-RS resource named TokenProviderResource</strong> with the following characteristics:</p>
<ul>
<li>Receives a POST+Form params petition over <code>/auth</code></li>
<li>Resource creates and signs a token using privateKey.pem certificate</li>
<li>Returns token in response body</li>
<li>Roles will be established using <code>web.xml</code> file</li>
<li>Roles will be mapped to Payara realm using <code>glassfish-web.xml</code> file</li>
<li>User, password and roles will be checked using Servlet 3+ API</li>
</ul>
<p>Nimbus JOSE and Bouncy Castle should be added as dependencies in order to read and sign tokens, these should be added at <code>pom.xml</code> file.</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
    &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
    &lt;version&gt;5.7&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;
    &lt;artifactId&gt;bcpkix-jdk15on&lt;/artifactId&gt;
    &lt;version&gt;1.53&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>
<p>Later, a enum will be used to describe the fixed roles in a type safe way:</p>
<pre><code class="language-prettyprint">public enum RolesEnum {
	WEB(&quot;web&quot;),
	MOBILE(&quot;mobile&quot;);

	private String role;

	public String getRole() {
		return this.role;
	}

	RolesEnum(String role) {
		this.role = role;
	}
}
</code></pre>
<p>Once dependencies and roles are into project, we will implement a plain old Java bean in chage of token creation. First <strong>to be compliant with MicroProfile token structure a MPJWTToken bean is created</strong>, this will also contain a fast objet to JSON string converter but you could use any other marshaller implementation.</p>
<pre><code class="language-prettyprint">public class MPJWTToken {
	private String iss; 
    private String aud;
    private String jti;
    private Long exp;
    private Long iat;
    private String sub;
    private String upn;
    private String preferredUsername;
    private List&lt;String&gt; groups = new ArrayList&lt;&gt;();
    private List&lt;String&gt; roles;
    private Map&lt;String, String&gt; additionalClaims;

    //Gets and sets go here

    public String toJSONString() {

        JSONObject jsonObject = new JSONObject();
        jsonObject.appendField(&quot;iss&quot;, iss);
        jsonObject.appendField(&quot;aud&quot;, aud);
        jsonObject.appendField(&quot;jti&quot;, jti);
        jsonObject.appendField(&quot;exp&quot;, exp / 1000);
        jsonObject.appendField(&quot;iat&quot;, iat / 1000);
        jsonObject.appendField(&quot;sub&quot;, sub);
        jsonObject.appendField(&quot;upn&quot;, upn);
        jsonObject.appendField(&quot;preferred_username&quot;, preferredUsername);

        if (additionalClaims != null) {
            for (Map.Entry&lt;String, String&gt; entry : additionalClaims.entrySet()) {
                jsonObject.appendField(entry.getKey(), entry.getValue());
            }
        }

        JSONArray groupsArr = new JSONArray();
        for (String group : groups) {
            groupsArr.appendElement(group);
        }
        jsonObject.appendField(&quot;groups&quot;, groupsArr);

        return jsonObject.toJSONString();
    }

</code></pre>
<p>Once JWT structure is complete, a CypherService is implemented to create and sign the token. This service will implement the JWT generator and also a key &quot;loader&quot; that reads privateKey file from classpath using Bouncy Castle.</p>
<pre><code class="language-prettyprint">public class CypherService {

	public static String generateJWT(PrivateKey key, String subject, List&lt;String&gt; groups) {
        JWSHeader header = new JWSHeader.Builder(JWSAlgorithm.RS256)
                .type(JOSEObjectType.JWT)
                .keyID(&quot;burguerkey&quot;)
                .build();

        MPJWTToken token = new MPJWTToken();
        token.setAud(&quot;burgerGt&quot;);
        token.setIss(&quot;https://burger.nabenik.com&quot;);
        token.setJti(UUID.randomUUID().toString());

        token.setSub(subject);
        token.setUpn(subject);

        token.setIat(System.currentTimeMillis());
        token.setExp(System.currentTimeMillis() + 7*24*60*60*1000); // 1 week expiration!

        token.setGroups(groups);

        JWSObject jwsObject = new JWSObject(header, new Payload(token.toJSONString()));

        // Apply the Signing protection
        JWSSigner signer = new RSASSASigner(key);

        try {
            jwsObject.sign(signer);
        } catch (JOSEException e) {
            e.printStackTrace();
        }

        return jwsObject.serialize();
    }

    public PrivateKey readPrivateKey() throws IOException {

        InputStream inputStream = CypherService.class.getResourceAsStream(&quot;/privateKey.pem&quot;);

        PEMParser pemParser = new PEMParser(new InputStreamReader(inputStream));
        JcaPEMKeyConverter converter = new JcaPEMKeyConverter().setProvider(new BouncyCastleProvider());
        Object object = pemParser.readObject();
        KeyPair kp = converter.getKeyPair((PEMKeyPair) object);
        return kp.getPrivate();
    }	
}
</code></pre>
<p><strong>CypherService will be used from TokenProviderResource as injectable CDI bean</strong>. One of my motivations to separate key reading from signing process is that key reading should be implemented respecting resource lifecycle, hence the key will be loaded at CDI <code>@PostConstruct</code> callback.</p>
<p>Here, full resource code:</p>
<pre><code class="language-prettyprint">@Singleton
@Path(&quot;/auth&quot;)
public class TokenProviderResource {

    @Inject
    CypherService cypherService;

    private PrivateKey key;

    @PostConstruct
    public void init() {
        try {
            key = cypherService.readPrivateKey();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @POST
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
    public Response doTokenLogin(@FormParam(&quot;username&quot;) String username, @FormParam(&quot;password&quot;)String password,
                               @Context HttpServletRequest request){

        List&lt;String&gt; target = new ArrayList&lt;&gt;();
        try {
            request.login(username, password);

            if(request.isUserInRole(RolesEnum.MOBILE.getRole()))
                target.add(RolesEnum.MOBILE.getRole());

            if(request.isUserInRole(RolesEnum.WEB.getRole()))
                target.add(RolesEnum.WEB.getRole());

        }catch (ServletException ex){
            ex.printStackTrace();
            return Response.status(Response.Status.UNAUTHORIZED)
                    .build();
        }

        String token = cypherService.generateJWT(key, username, target);

            return Response.status(Response.Status.OK)
                    .header(AUTHORIZATION, &quot;Bearer &quot;.concat(token))
                    .entity(token)
                    .build();

    }

}
</code></pre>
<p><strong>JAX-RS endpoints in the end are abstractions over Servlet API</strong>, consequently you could inject the <code>HttpServletRequest</code> or <code>HttpServletResponse</code> object on any method (<code>doTokenLogin</code>). In this case it is usefull since I'm triggering a manual login using Servlet 3+ <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#login-java.lang.String-java.lang.String-">login method</a>.</p>
<p><a href="https://stackoverflow.com/questions/344117/how-to-get-user-roles-in-a-jsp-servlet">As noticed by many users</a>, <strong>Servlet API does not allow to read user roles in a portable way</strong>, hence I'm just checking if a given user is included in fixed roles using the previously defined enum and adding these roles to the target ArrayList.</p>
<p>In this code the parameters were declared as <code>@FormParam</code> consuming <code>x-www-form-urlencoded</code> data making it usefull for plain HTML forms, but this configuration is completely optional.</p>
<h2>Mapping project to Payara realm</h2>
<p><strong>The main motivation to use Servlet's login method is basically because it is already integrated with Java EE security schemes</strong>, hence using the realm will be a simple two-step configuration:</p>
<ul>
<li>Add the realm/roles configuration at <code>web.xml</code> file in the project</li>
<li>Map Payara groups to application roles using <code>glassfish-web.xml</code> file</li>
</ul>
<p>If you wanna know the full description of this mapping I found a useful post <a href="http://randomthoughtsonjavaprogramming.blogspot.com/2016/04/security-realms-in-glassfish.html">here</a>.</p>
<p>First, I need to map the application to <code>burgerland</code> realm and declare the two roles. Since I'm not selecting an auth method, project will fallback to BASIC method, however I'm not protecting any resource so, credentials won't be explicitly required on any HTTP request:</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
         version=&quot;3.1&quot;&gt;

    &lt;login-config&gt;
        &lt;realm-name&gt;burgerland&lt;/realm-name&gt;
    &lt;/login-config&gt;
    &lt;security-role&gt;
        &lt;role-name&gt;web&lt;/role-name&gt;
    &lt;/security-role&gt;
    &lt;security-role&gt;
        &lt;role-name&gt;mobile&lt;/role-name&gt;
    &lt;/security-role&gt;
&lt;/web-app&gt;
</code></pre>
<p>Payara groups and Java web application roles are not the same concepts, but these could actually be mapped using glassfish descriptor <code>glassfish-web.xml</code>:</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE glassfish-web-app PUBLIC &quot;-//GlassFish.org//DTD GlassFish Application Server 3.1 Servlet 3.0//EN&quot; &quot;http://glassfish.org/dtds/glassfish-web-app_3_0-1.dtd&quot;&gt;
&lt;glassfish-web-app error-url=&quot;&quot;&gt;
    &lt;security-role-mapping&gt;
        &lt;role-name&gt;mobile&lt;/role-name&gt;
        &lt;group-name&gt;mobile&lt;/group-name&gt;
    &lt;/security-role-mapping&gt;
    &lt;security-role-mapping&gt;
        &lt;role-name&gt;web&lt;/role-name&gt;
        &lt;group-name&gt;web&lt;/group-name&gt;
    &lt;/security-role-mapping&gt;
&lt;/glassfish-web-app&gt;
</code></pre>
<p>Finally the new application is deployed and a simple test demonstrates the functionality of token provider:</p>
<p><img src="/images/posts/jwtrealm/postman.png" alt="Postman test" title="Postman test" /></p>
<p>The token could be explored using any JWT tool, like the popular jwt.io, here the token is a compatible JWT implementation:</p>
<p><img src="/images/posts/jwtrealm/jwt1.png" alt="JWT test" title="JWT test" /></p>
<p>And as stated previously the signature could be checked using only the PUBLIC key:</p>
<p><img src="/images/posts/jwtrealm/jwt2.png" alt="JWT test 2" title="JWT test 2" /></p>
<p>As always, full implementation <a href="https://github.com/tuxtor/microjwt-provider">is available at GitHub</a>.</p>
</p>
        <a href="../blog/2019/2019-09-11-Packagin-Angular-8-Apps-War.html"><h1>How to pack Angular 8 applications on regular war files</h1></a>
        <p>11 September 2019</p>
        <p><p><img src="/images/posts/angularmaven/maven.png" alt="Maven" title="Maven" /></p>
<p>From time to time it is necessary to distribute SPA applications using war files as containers, in my experience this is necessary when:</p>
<ul>
<li>You don't have control over deployment infrastructure</li>
<li>You're dealing with rigid deployment standards</li>
<li>IT people is reluctant to publish a plain old web server</li>
</ul>
<p>Anyway, and as described in <a href="https://docs.oracle.com/javaee/5/tutorial/doc/bnadx.html">Oracle's documentation</a> one of the benefits of using war files is the possibility to include static (HTML/JS/CSS) files in the deployment, hence is safe to assume that you could distribute any SPA application using a war file as wrapper (with special considerations).</p>
<h2>Creating a POC with Angular 8 and Java War</h2>
<p>To demonstrate this I will create a project that:</p>
<ol>
<li>Is compatible with the big three Java IDEs (NetBeans, IntelliJ, Eclipse) and VSCode</li>
<li>Allows you to use the IDEs as JavaScript development IDEs</li>
<li>Allows you to create a SPA modern application (With all npm, ng, cli stuff)</li>
<li>Allows you to combine Java(Maven) and JavaScript(Webpack) build systems</li>
<li>Allows you to distribute a minified and ready for production project</li>
</ol>
<h2>Bootstrapping a simple Java web project</h2>
<p>To bootstrap the Java project, you could use the plain old <a href="https://maven.apache.org/archetypes/maven-archetype-webapp/">maven-archetype-webapp</a> as basis:</p>
<pre><code class="language-prettyprint">mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4
</code></pre>
<p>The interactive shell will ask you for you project characteristics including groupId, artifactId (project name) and base package.</p>
<p><img src="/images/posts/angularmaven/javabootstrap.png" alt="Java Bootstrap" title="Java Bootstrap" /></p>
<p>In the end you should have the following structure as result:</p>
<pre><code class="language-prettyprint">demo-angular-8$ tree
.
├── pom.xml
└── src
    └── main
        └── webapp
            ├── WEB-INF
            │   └── web.xml
            └── index.jsp

4 directories, 3 files
</code></pre>
<p>Now you should be able to open your project in any IDE. By default the 'pom.xml' will include locked down versions for maven plugins, you could safely get rid of those since we won't personalize the entire Maven lifecycle, just a couple of hooks.</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.nabenik&lt;/groupId&gt;
  &lt;artifactId&gt;demo-angular-8&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;

  &lt;name&gt;demo-angular-8 Maven Webapp&lt;/name&gt;

  &lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;
  &lt;/properties&gt;
&lt;/project&gt;
</code></pre>
<p>Besides that <code>index.jsp</code> is not necessary, just delete it.</p>
<h2>Bootstrapping a simple Angular JS project</h2>
<p>As an opinionated approach I suggest to isolate the Angular project at its own directory (<code>src/main/frontend</code>), on the past and with simple frameworks (AngularJS, Knockout, Ember) it was possible to bootstrap the entire project with a couple of includes in the index.html file, however nowadays most of the modern front end projects use some kind of bundler/linter in order to enable modern (&gt;=ES6) features like modules, and in the case of Angular, it uses Webpack under the hood for this.</p>
<p>For this guide I assume that you already have installed all <a href="https://angular.io/guide/setup-local">Angular CLI tools</a>, hence we could go inside our source code structure and bootstrap the Angular project.</p>
<pre><code class="language-prettyprint">demo-angular-8$ cd src/main/
demo-angular-8/src/main$ ng new frontend
</code></pre>
<p>This will bootstrap a vanilla Angular project, and in fact you could consider the <code>src/main/frontend</code> folder as a separate root (and also you could open this directly from VSCode), the final structure will be like this:</p>
<p><img src="/images/posts/angularmaven/structure.png" alt="JS Structure" title="JS Structure" /></p>
<p>As a first POC I started the application directly from CLI using IntelliJ IDEA and <code>ng serve --open</code>, all worked as expected.</p>
<p><img src="/images/posts/angularmaven/run.png" alt="Angular run" title="Angular run" /></p>
<h2>Invoking Webpack from Maven</h2>
<p>One of the useful plugins for this task is <a href="https://github.com/eirslett/frontend-maven-plugin">frontend-maven-plugin</a> which allows you to:</p>
<ol>
<li>Download common JS package managers (npm, cnpm, bower, yarn)</li>
<li>Invoke JS build systems and tests (grunt, gulp, webpack or npm itself, karma)</li>
</ol>
<p>By default Angular project come with hooks from <code>npm</code> to <code>ng</code> but we need to add a hook in package.json to create a production quality build (<code>buildProduction</code>), please double check the base-href parameter since I'm using the default root from Java conventions (same as project name)</p>
<pre><code class="language-prettyprint">...
&quot;scripts&quot;: {
    &quot;ng&quot;: &quot;ng&quot;,
    &quot;start&quot;: &quot;ng serve&quot;,
    &quot;build&quot;: &quot;ng build&quot;,
    &quot;buildProduction&quot;: &quot;ng build --prod --base-href /demo-angular-8/&quot;,
    &quot;test&quot;: &quot;ng test&quot;,
    &quot;lint&quot;: &quot;ng lint&quot;,
    &quot;e2e&quot;: &quot;ng e2e&quot;
  }
...
</code></pre>
<p>To test this build we could execute npm run buildProduction at webproject's root (<code>src/main/frontend</code>), the output should be like this:</p>
<p><img src="/images/posts/angularmaven/npmhook.png" alt="NPM Hook" title="NPM Hook" /></p>
<p>Finally It is necessary to invoke or new target with maven, hence our configuration should:</p>
<ol>
<li>Install NodeJS (and NPM)</li>
<li>Install JS dependencies</li>
<li>Invoke our new hook</li>
<li>Copy the result to our final distributable war</li>
</ol>
<p>To achieve this, the following configuration should be enough:</p>
<pre><code class="language-prettyprint">&lt;build&gt;
&lt;finalName&gt;demo-angular-8&lt;/finalName&gt;
    &lt;plugins&gt;
    &lt;plugin&gt;
            &lt;groupId&gt;com.github.eirslett&lt;/groupId&gt;
            &lt;artifactId&gt;frontend-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;1.6&lt;/version&gt;

            &lt;configuration&gt;
                &lt;workingDirectory&gt;src/main/frontend&lt;/workingDirectory&gt;
            &lt;/configuration&gt;

            &lt;executions&gt;

                &lt;execution&gt;
                    &lt;id&gt;install-node-and-npm&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;install-node-and-npm&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;nodeVersion&gt;v10.16.1&lt;/nodeVersion&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;

                &lt;execution&gt;
                    &lt;id&gt;npm install&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;npm&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;arguments&gt;install&lt;/arguments&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;npm build&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;npm&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;arguments&gt;run buildProduction&lt;/arguments&gt;
                    &lt;/configuration&gt;
                    &lt;phase&gt;generate-resources&lt;/phase&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
        &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;configuration&gt;
            &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;

            &lt;!-- Add frontend folder to war package --&gt;
            &lt;webResources&gt;
                &lt;resource&gt;
                    &lt;directory&gt;src/main/frontend/dist/frontend&lt;/directory&gt;
                &lt;/resource&gt;
            &lt;/webResources&gt;

        &lt;/configuration&gt;
    &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>And that's it!. Once you execute <code>mvn clean package</code> you will obtain as result a portable war file that will run over any Servlet container runtime. For Instance I tested it with Payara Full 5, working as expected.</p>
<p><img src="/images/posts/angularmaven/payara.png" alt="Payara" title="Payara" /></p>
</p>
        <a href="../blog/2019/2019-05-02-Payara-Nginx-LetsEncrypt.html"><h1>How to install Payara 5 with NGINX and Let&apos;s Encrypt over Oracle Linux 7.x</h1></a>
        <p>02 May 2019</p>
        <p><p><img src="/images/posts/reversepayara/payarassl.png" alt="Payara SSL" title="Payara SSl" /></p>
<p>From field experiences I must affirm that one of the greatest and stable combinations is Java Application Servers + Reverse Proxies, although some of the functionality is a clear overlap, I tend to put reverse proxies in front of application servers for the following reasons (<a href="https://www.nginx.com/resources/glossary/reverse-proxy-server/">please see NGINX page for more details</a>):</p>
<ul>
<li><strong>Load balancing:</strong> The reverse proxy acts as traffic cop and could be used as API gateway for clustered instances/backing services</li>
<li><strong>Web acceleration:</strong> Most of our applications nowadays use SPA frameworks, hence it is worth to cache all the js/css/html files and free the application server from this responsibility</li>
<li><strong>Security:</strong> Most of the HTTP requests could be intercepted by the reverse proxy <strong>before</strong> any attempt against the application server, increasing the opportunity to define rules</li>
<li><strong>SSL Management:</strong> It is easier to install/manage/deploy OpenSSL certificates in Apache/NGINX if compared to <a href="https://en.wikipedia.org/wiki/Java_KeyStore">Java KeyStores</a>. Besides this, <a href="https://letsencrypt.org/">Let's Encrypt</a> officially support NGINX with plugins.</li>
</ul>
<h2>Requirements</h2>
<p>To demonstrate this functionality, this tutorial combines the following stack in a classic (non-docker) way, however most of the concepts could be useful for Docker deployments:</p>
<ul>
<li>Payara 5 as application server</li>
<li>NGINX as reverse proxy</li>
<li>Let's encrypt SSL certificates</li>
</ul>
<p>It is assumed that a clean Oracle Linux 7.x (7.6) box will be used during this tutorial and tests will be executed over Oracle Cloud with <code>root</code> user.</p>
<p><img src="/images/posts/reversepayara/oraclelinux.png" alt="Oracle Linux" title="Oracle Linux" /></p>
<h2>Preparing the OS</h2>
<p>Since Oracle Linux is binary compatible with RHEL, <a href="https://fedoraproject.org/wiki/EPEL">EPEL</a> repository will be added to get access to Let's Encrypt. It is also useful to update the OS as a previous step:</p>
<pre><code class="language-prettyprint">yum -y update
yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
</code></pre>
<h2>Setting up Payara 5</h2>
<p>In order to install Payara application server a couple of dependencies will be needed, specially a Java Developer Kit. For instance OpenJDK is included at Oracle Linux repositories.</p>
<pre><code class="language-prettyprint">yum -y install java-1.8.0-openjdk-headless
yum -y install wget
yum -y install unzip
</code></pre>
<p>Once all dependencies are installed, it is time to download, unzip and install Payara. It will be located at <code>/opt</code> following standard Linux conventions for external packages:</p>
<pre><code class="language-prettyprint">cd /opt
wget -O payara-5.191.zip https://search.maven.org/remotecontent?filepath=fish/payara/distributions/payara/5.191/payara-5.191.zip
unzip payara-5.191.zip
rm payara-5.191.zip
</code></pre>
<p>It is also useful to create a <code>payara</code> user for administrative purposes, to administrate the domain(s) or to run Payara as Linux service with systemd:</p>
<pre><code class="language-prettyprint">adduser payara
chown -R payara:payara payara5
echo 'export PATH=$PATH:/opt/payara5/glassfish/bin' &gt;&gt; /home/payara/.bashrc
chown payara:payara /home/payara/.bashrc
</code></pre>
<p>A systemd unit is also needed:</p>
<pre><code class="language-prettyprint">echo '[Unit]
Description = Payara Server v5
After = syslog.target network.target

[Service]
User=payara
ExecStart = /usr/bin/java -jar /opt/payara5/glassfish/lib/client/appserver-cli.jar start-domain
ExecStop = /usr/bin/java -jar /opt/payara5/glassfish/lib/client/appserver-cli.jar stop-domain
ExecReload = /usr/bin/java -jar /opt/payara5/glassfish/lib/client/appserver-cli.jar restart-domain
Type = forking

[Install]
WantedBy = multi-user.target' &gt; /etc/systemd/system/payara.service
systemctl enable payara
</code></pre>
<p>Additionally if remote administration is needed, secure admin should be enabled:</p>
<pre><code class="language-prettyprint">sudo -u payara /opt/payara5/bin/asadmin --host localhost --port 4848 change-admin-password
systemctl start payara
sudo -u payara /opt/payara5/bin/asadmin --host localhost --port 4848 enable-secure-admin
systemctl restart payara
</code></pre>
<p><img src="/images/posts/reversepayara/payaraboot.png" alt="Payara Boot" title="Payara Boot" /></p>
<p>Oracle Cloud default configuration will create a VNIC attached to your instance, hence you should check the rules in order to allow access to ports.</p>
<p><img src="/images/posts/reversepayara/ingresrules.png" alt="Ingres Rules" title="Ingres Rules" /></p>
<p>By default, Oracle Linux instances have a restricted set of rules in iptables and SELinux, hence ports should be opened with firewalld and SELinux should be configured to allow reverse proxy traffic:</p>
<pre><code class="language-prettyprint">firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --zone=public --permanent --add-service=https
firewall-cmd --zone=public --permanent --add-port=4848/tcp
setsebool -P httpd_can_network_connect 1
</code></pre>
<p>With this, the access is guaranteed to http+https+payara admin port.</p>
<h2>Setting up NGINX reverse proxy</h2>
<p>NGINX is available at EPEL:</p>
<pre><code class="language-prettyprint">yum -y install nginx
systemctl enable nginx
</code></pre>
<p>At this time your will need a FQDN pointing to your server, otherwhise Let's encrypt validation won't work. For this tutorial the <code>ocl.nabenik.com</code> domain will be used. If your domain propagated properly you should see a page like this:</p>
<p><img src="/images/posts/reversepayara/nginxproxy.png" alt="NGINX Proxy" title="NGINX Proxy" /></p>
<p>Don't worry the Fedora logo is due EPEL usage, but you're running Oracle Linux :).</p>
<p>Now it's time to setup NGINX as reverse proxy, an opinionated deployment option is to create a <code>/etc/nginx/sites-available</code> and <code>/etc/nginx/sites-enabled</code> structure inside NGINX configuration, to isolate/manage multiple domains with the same instance (aka virtual hosts).</p>
<pre><code class="language-prettyprint">mkdir -p /etc/nginx/sites-available
mkdir -p /etc/nginx/sites-enabled
mkdir -p /var/www/ocl.nabenik.com/
chown -R nginx:nginx /var/www/ocl.nabenik.com

echo 'server {
    server_name ocl.nabenik.com;

    gzip on;
    gzip_types      text/css text/javascript text/plain application/xml;
    gzip_min_length 1000;

    location ^~ /.well-known/acme-challenge/ {
        allow all;
        root /var/www/ocl.nabenik.com/;
        default_type &quot;text/plain&quot;;
        try_files $uri =404;
    }

    location / {
        proxy_pass             http://localhost:8080;
        proxy_connect_timeout       300;
        proxy_send_timeout          300;
        proxy_read_timeout          300;
        send_timeout                300;
    }

    error_page  500 502 503 504  /50x.html;
    location = /50x.html {
        root  /usr/share/nginx/html;
    }

    listen 80;
}' &gt; /etc/nginx/sites-available/ocl.nabenik.com.conf
</code></pre>
<p>To enable the new host, a symlink is created on <code>sites-enabled</code>:</p>
<pre><code class="language-prettyprint">ln -s /etc/nginx/sites-available/ocl.nabenik.com.conf /etc/nginx/sites-enabled/ocl.nabenik.com.conf
</code></pre>
<p>After that you should include the following line inside <code>/etc/nginx/nginx.conf</code>, just before config file ending.</p>
<pre><code>include /etc/nginx/sites-enabled/*.conf;
</code></pre>
<p>It is also useful to check your configuration with <code>nginx -t</code>, if all works property you should reach payara after NGINX reload.</p>
<p><img src="/images/posts/reversepayara/reversepayara.png" alt="Reverse Payara" title="Reverse Payara" /></p>
<h2>Setting up Let's Encrypt</h2>
<p>Once the reverse proxy is working, certbot should be enough to add an SSL certificate, the plugin itself will create a challenge at <code>^~ /.well-known/acme-challenge/</code>, hence the proxy exclusion is mandatory (as reflected in the previous configuration step).</p>
<pre><code class="language-prettyprint">yum install -y certbot-nginx
certbot --nginx -d ocl.nabenik.com
</code></pre>
<p>One of the caveats of using certbot is the dependency of python version. Another alternative if you find any issues is to install it with <code>pip</code></p>
<pre><code class="language-prettyprint">yum install -y python-pip
pip install certbot-nginx
certbot --nginx -d ocl.nabenik.com
</code></pre>
<p>If everything works as expected, you should see the Payara page under SSL.</p>
<p><img src="/images/posts/reversepayara/payarassl.png" alt="Payara SSL" title="Payara SSL" /></p>
<p>Finally and most importantly, Let's Encrypt certificates are valid just for 90 days, hence you could add certification renewal (<code>crontab -e</code>) as a cron task</p>
<pre><code>15 3 * * * /usr/bin/certbot renew --quiet
</code></pre>
</p>
        <a href="../blog/2019/2019-04-29-Boostraping-Eclipse-Jboss-Tools.html"><h1>Getting started with Java EE 8, Java 11, Eclipse for Java Enterprise and Wildfly 16</h1></a>
        <p>30 April 2019</p>
        <p><p><img src="/images/posts/wildfly16/eclipse2019.png" alt="Eclipse 2019" title="Eclipse 2019-03" /></p>
<p>In this mini-tutorial we will demonstrate the configuration of a pristine development environment with Eclipse, JBoss Tools and Wildfly Application Server on MacOS.</p>
<h2>From JBoss with love</h2>
<p>If you have been in the Java EE space for a couple of years, <strong><a href="https://www.eclipse.org/downloads/packages/">Eclipse IDE for Java Enterprise Developers</a> is probably one of the best IDE experiences</strong>, making an easy task the creation of applications with important EE components like CDI, EJB, JPA mappings, configuration files and good interaction with some of the <em>important</em> application servers (TomEE, WebLogic, Payara, Wildfly, JBoss).</p>
<p>In this line, Red Hat develops the Eclipse variant &quot;<a href="https://developers.redhat.com/products/codeready-studio/overview/">CodeReady Studio</a>&quot; giving you and IDE with support for Java Enterprise Frameworks, Maven, HTML 5, Red Hat Fuse and OpenShift deployments.</p>
<p>To give support to its IDE, Red Hat also publishes CodeReady plugins as an independent project called <a href="http://tools.jboss.org/">JBoss Tools</a>, enabling custom Enterprise Java development environments with Eclipse IDE for Java Enterprise developers as basis, which we demonstrate in this tutorial.</p>
<p>Why? For fun. Or as in my case, I don't use the entire toolset from Red Hat.</p>
<h2>Requirements</h2>
<p>In order to complete this tutorial you will need to download/install the following elements:</p>
<p>1- Java 11 JDK from <a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle</a> or any <a href="https://adoptopenjdk.net/">OpenJDK distro</a><br />
2- <a href="https://www.eclipse.org/downloads/packages/release/2019-03/r/eclipse-ide-enterprise-java-developers">Eclipse IDE for Enterprise Java Developers</a><br />
3- <a href="https://wildfly.org/downloads/">Wildfly 16</a></p>
<h2>Installing OpenJDK</h2>
<p>Since this is an OS/distribution dependent step, you could follow tutorials for <a href="https://developers.redhat.com/openjdk-install/">Red Hat's OpenJDK</a>, <a href="https://adoptopenjdk.net/installation.html?variant=openjdk11&amp;jvmVariant=hotspot#x64_linux-jdk">AdoptOpenJDK</a>,  <a href="https://www.linuxuprising.com/2019/04/install-latest-openjdk-12-11-or-8-in.html">Ubuntu</a>, etc. At this time, <strong>Wildfly has Java 11 as target due new Java-LTS version scheme</strong>.</p>
<p>For MacOS one convenient way is <a href="https://github.com/AdoptOpenJDK/homebrew-openjdk">AdoptOpenJDK tap</a>.</p>
<p>First you should install <a href="https://brew.sh/">Homebrew</a></p>
<pre><code class="language-bash">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre>
<p>After that and if you want an specific Java version, you should add AdoptOpenJDK tap and install from there. For instance if we like a OpenJDK 11 instance we should type:</p>
<pre><code class="language-bash">brew tap AdoptOpenJDK/openjdk
brew cask install adoptopenjdk11
</code></pre>
<p>If all works as expected, you should have a new Java 11 environment running:</p>
<p><img src="/images/posts/wildfly16/java11.png" alt="Java 11" title="Java 11" /></p>
<h2>Eclipse IDE for Enterprise Java Developers</h2>
<p>Eclipse offers collections of plugins denominated <em>Packages</em>, <strong>each package is a collection of common plugins aimed for a particular development need</strong>. Hence to simplify the process you could download directly Eclipse IDE for Enterprise Java Developers.</p>
<p><img src="/images/posts/wildfly16/eclipseenterprise.png" alt="Eclipse Enterprise" title="Eclipse Enterprise" /></p>
<p>On Mac you will download a convenient .dmg file that you should drag and drop on the <strong>Applications folder</strong>.</p>
<p><img src="/images/posts/wildfly16/eclipseinstall.png" alt="Eclipse Install" title="Eclipse Install" /></p>
<p>The result is a brand new Eclipse Installation with Enterprise Java (Jakarta EE) support.</p>
<p><img src="/images/posts/wildfly16/eclipseideee.png" alt="Eclipse IDE" title="Eclipse IDE" /></p>
<h2>JBoss Tools</h2>
<p>To install the &quot;Enterprise Java&quot; Features to your Eclipse installation, go to JBoss Tools main website at <a href="https://tools.jboss.org/">https://tools.jboss.org/</a> you should double check the compatibility with your Eclipse version before installing. Since <strong>Eclipse is lauching new versions each quarter</strong> the preferred way to install the plugins is by adding the update URL .</p>
<p>First, go to:</p>
<pre><code>Help &gt; Install New Software… &gt; Work with:
</code></pre>
<p>And add the JBoss Tools URL <a href="http://download.jboss.org/jbosstools/photon/development/updates/">http://download.jboss.org/jbosstools/photon/development/updates/</a></p>
<p><img src="/images/posts/wildfly16/jbossrepo.png" alt="JBoss Repo" title="JBoss Repo" /></p>
<p>After that you should select the individual features, a minimal set of features for developers aiming Jakarta EE is:</p>
<ul>
<li>JBoss Web and Java EE Development: Support for libraries and tools like DeltaSpike, Java EE Batch, Hibernate, JavaScript, JBoss Forge</li>
<li>JBoss Application Server Adapters: Support for JBoss, Wildfly and OpenShift 3</li>
<li>JBoss Cloud and Container Development Tools: Support for Vagrant, Docker and Red Hat Containers development kit</li>
<li>JBoss Maven support: Integrations between Maven and many EE/JBoss APIs</li>
</ul>
<p><img src="/images/posts/wildfly16/jbosstools.png" alt="JBoss Tools" title="JBoss Tools" /></p>
<p>Finally you should accept licenses and restart your Eclipse installation.</p>
<h2>Wildfly 16</h2>
<p>Wildfly distributes the application server in zip or tgz files. After getting the link you could do the install process from the CLI. For example if you wanna create your Wildfly directory at ~/opt/ you should execute the following commands</p>
<pre><code class="language-bash">mkdir ~/opt/
cd ~/opt/
wget https://download.jboss.org/wildfly/16.0.0.Final/wildfly-16.0.0.Final.zip
unzip wildfly-16.0.0.Final.zip
</code></pre>
<p>It is also convenient to add an administrative user that allows the creation of DataSources, Java Mail destinations, etc. For instance and using again <code>~/opt/</code> as basis:</p>
<pre><code class="language-bash">cd ~/opt/wildfly-16.0.0.Final/bin/
./add-user.sh
</code></pre>
<p><img src="/images/posts/wildfly16/wildflyadmin.png" alt="Wildfly Admin" title="Wildfly Admin" /></p>
<p>The script will ask basic details like user name, password and consideration on cluster environments, in the end you should have a configured Wildfly instance ready for development, to start the instance just type:</p>
<pre><code class="language-bash">~/opt/wildfly-16.0.0.Final/bin/standalone.sh
</code></pre>
<p>To check your administrative user, go to <a href="http://localhost:9990/console/index.html">http://localhost:9990/console/index.html</a>.</p>
<p><img src="/images/posts/wildfly16/wildflydashboard.png" alt="Wildfly Dashboard" title="Wildfly Dashboard" /></p>
<h2>Eclipse and Wildfly</h2>
<p>Once you have all set, it is easy to add Wildfly to your Eclipse installation. Go to servers window and add a new server instance, the wizard is pretty straight forward so screenshot are added just for reference:</p>
<p><img src="/images/posts/wildfly16/wildfly16.png" alt="Wildfly 16" title="Wildfly 16" /></p>
<p><img src="/images/posts/wildfly16/wildfly16local.png" alt="Wildfly 16 local" title="Wildfly 16 local" /></p>
<p><img src="/images/posts/wildfly16/wildflyhome.png" alt="Wildfly Home" title="Wildfly Home" /></p>
<p>If you wanna go deep on server's configuration, Eclipse allows you to open the <code>standalone.xml</code> configuration file directly from the IDE, just check if the application server is stopped, otherwhise your configuration changes will be deleted.</p>
<p><img src="/images/posts/wildfly16/standalone.png" alt="Wildfly Standalone" title="Wildfly Standalone" /></p>
<h2>Testing the environment</h2>
<p>To test this application I've created a nano-application using an Archetype for Java EE 8. The application server and the IDE support Java 11 and the deployment works as expected directly from the ide.</p>
<p><img src="/images/posts/wildfly16/java11ee.png" alt="Wildfly EE" title="Wildfly EE" /></p>
</p>
        <a href="../blog/2019/2019-04-17-Evaluating-Kotlin-caveats-JavaEE.html"><h1>The state of Kotlin for Jakarta EE/MicroProfile traditional applications</h1></a>
        <p>22 April 2019</p>
        <p><p><img src="/images/posts/kotlinee/kotlinee.png" alt="Kotlin EE" title="Kotlin EE Logo" /></p>
<p>This easter I had the opportunity to catch up with some R&amp;D tasks in my main Job, in short I had to evaluate the feasibility of using Kotlin in regular Jakarta EE/MicroProfile projects including:</p>
<ul>
<li>Language benefits</li>
<li>Jakarta EE/MicroProfile API support, specifically CDI, JPA, JAX-RS</li>
<li>Maven support</li>
<li>Compatibility with my regular libraries (Flyway, SL4J, Arquillian)</li>
<li>Regular application server support -e.g Payara-</li>
<li>Tooling support (deployment, debugging, project import)</li>
<li>Cloud deployment by Docker</li>
</ul>
<h2>TL;DR version</h2>
<p>Kotlin works as language and plays well with Maven, I'm able to use many of the EE API for &quot;services&quot;, however the roadblock is not the language or libraries, is the tooling support.</p>
<p><strong>The experience is superb on IntelliJ IDEA and all works as expected, however the IDE is a barrier if you're not an IntelliJ user</strong>, Kotlin doesn't play well with WTP on Eclipse (hence it doesn't deploy to app servers) and Kotlin support for Netbeans is mostly dead.</p>
<h2>About language</h2>
<p>If you have a couple of years in the JVM space you probably remember that <strong>Scala, Ceylon and Kotlin have been considered as better Javas</strong>. I do a lot of development in different languages including Java for backends, Kotlin for mobile, JavaScript on front-ends, Bash for almost every automation task so I knew the streghts of Kotlin from the mobile space where is specially important, basically most of the Java development on Android is currently a Java 7+Lambdas experience.</p>
<p>My top five features that could help you in your EE tasks are<br />
* One line functions<br />
* Public by default<br />
* Multiline Strings<br />
* Companion objects<br />
* Type inference</p>
<p>I'll try to exemplify these in a regular application</p>
<h2>The Jakarta EE/MicroProfile application</h2>
<p>The demo application follows a simple structure, it includes MicroProfile Config, CDI, EJB, JPA, and JAX-RS, focused on a simple phrase collector/retrieval service. Interesting Kotlin features are highlighted.</p>
<p>Source code is available at GitHub repo <a href="https://github.com/tuxtor/integrum-ee">https://github.com/tuxtor/integrum-ee</a>.</p>
<h3>Project configuration</h3>
<p>To enable Kotlin support I basically followed <a href="https://kotlinlang.org/docs/reference/using-maven.html">Kotlin's Maven guide</a>, is not so explanatory but if you have a litle bit of experience in maven this won't be a problem.</p>
<p>Besides adding Kotlin dependencies to a regular EE <code>pom.xml</code>a special configuration is needed for the <code>all-open</code> plugin, Jakarta EE works with proxy entities that inherit from your original code. To make it simple all CDI, EJB and JAX-RS important annotations were included as &quot;open activators&quot;.</p>
<pre><code class="language-prettyprint">&lt;plugin&gt;
    &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
    &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${kotlin.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;compile&lt;/id&gt;
            &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;sourceDirs&gt;
                    &lt;sourceDir&gt;${project.basedir}/src/main/kotlin&lt;/sourceDir&gt;
                    &lt;sourceDir&gt;${project.basedir}/src/main/java&lt;/sourceDir&gt;
                &lt;/sourceDirs&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;test-compile&lt;/id&gt;
            &lt;goals&gt; &lt;goal&gt;test-compile&lt;/goal&gt; &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;sourceDirs&gt;
                    &lt;sourceDir&gt;${project.basedir}/src/test/kotlin&lt;/sourceDir&gt;
                    &lt;sourceDir&gt;${project.basedir}/src/test/java&lt;/sourceDir&gt;
                &lt;/sourceDirs&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;compilerPlugins&gt;
            &lt;plugin&gt;all-open&lt;/plugin&gt;
        &lt;/compilerPlugins&gt;

        &lt;pluginOptions&gt;
            &lt;option&gt;all-open:annotation=javax.ws.rs.Path&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.enterprise.context.RequestScoped&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.enterprise.context.SessionScoped&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.enterprise.context.ApplicationScoped&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.enterprise.context.Dependent&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.ejb.Singleton&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.ejb.Stateful&lt;/option&gt;
            &lt;option&gt;all-open:annotation=javax.ejb.Stateless&lt;/option&gt;
        &lt;/pluginOptions&gt;
    &lt;/configuration&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
            &lt;artifactId&gt;kotlin-maven-allopen&lt;/artifactId&gt;
            &lt;version&gt;${kotlin.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/plugin&gt;
</code></pre>
<h3>Model</h3>
<p>Table models are easily created by using Kotlin's Data Classes, note the default values on parameters and nullable types for autogenerated values, using an incrementable value on a table.</p>
<pre><code class="language-prettyprint">@Entity
@Table(name = &quot;adm_phrase&quot;)
@TableGenerator(name = &quot;admPhraseIdGenerator&quot;, table = &quot;adm_sequence_generator&quot;, pkColumnName = &quot;id_sequence&quot;, valueColumnName = &quot;sequence_value&quot;, pkColumnValue = &quot;adm_phrase&quot;, allocationSize = 1)
data class AdmPhrase(
        @Id
        @GeneratedValue(strategy = GenerationType.TABLE, generator = &quot;admPhraseIdGenerator&quot;)
        @Column(name = &quot;phrase_id&quot;)
        var phraseId:Long? = null,
        var author:String = &quot;&quot;,
        var phrase:String = &quot;&quot;
)
</code></pre>
<p>After that, I need to provide also a repository, the repository is a classic CRUD component injectable with CDI, one line methods are created to make the repository concise. The interesting part however is that Kotlin's nullability system plays well with CDI by using <code>lateinit</code>.</p>
<p>The most pleasant part is to create JPQL querys with multiline declarations, In general I dislike the + signs polluting my query in Java :).</p>
<pre><code class="language-prettyprint">@RequestScoped
class AdmPhraseRepository @Inject constructor() {

    @Inject
    private lateinit var em:EntityManager

    @PostConstruct
    fun init() {
        println (&quot;Booting repository&quot;)
    }

    fun create(admPhrase:AdmPhrase) = em.persist(admPhrase)

    fun update(admPhrase:AdmPhrase) = em.merge(admPhrase)

    fun findById(phraseId: Long) = em.find(AdmPhrase::class.java, phraseId)

    fun delete(admPhrase: AdmPhrase) = em.remove(admPhrase)

    fun listAll(author: String, phrase: String): List&lt;AdmPhrase&gt; {

        val query = &quot;&quot;&quot;SELECT p FROM AdmPhrase p
            where p.author LIKE :author
            and p.phrase LIKE :phrase
        &quot;&quot;&quot;

        return em.createQuery(query, AdmPhrase::class.java)
                .setParameter(&quot;author&quot;, &quot;%$author%&quot;)
                .setParameter(&quot;phrase&quot;, &quot;%$phrase%&quot;)
                .resultList
    }

}
</code></pre>
<h3>Controller</h3>
<p>The model needs to be exposed by using a controller, hence a JAX-RS activator is needed</p>
<pre><code class="language-prettyprint">@ApplicationPath(&quot;/rest&quot;)
class RestApplication : Application()
</code></pre>
<p>That's all the code.</p>
<p>On the other side, implementing the controller looks a lot more like Java, specially if the right HTTP codes are needed. In this line to express the Java class to the builders the special Kotlin syntax <code>this::class.java</code> is mandatory.</p>
<p>Is also observed the elvis operator in action (in DELETE), if the entity is not found the alternative return is fired immediately, a nice idiomatic resource.</p>
<pre><code class="language-prettyprint">@Path(&quot;/phrases&quot;)
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
class AdmPhraseController{

    @Inject
    private lateinit var admPhraseRepository: AdmPhraseRepository

    @Inject
    private lateinit var logger: Logger

    @GET
    fun findAll(@QueryParam(&quot;author&quot;) @DefaultValue(&quot;%&quot;) author: String,
                @QueryParam(&quot;phrase&quot;) @DefaultValue(&quot;%&quot;) phrase: String) =
                admPhraseRepository.listAll(author, phrase)

    @GET
    @Path(&quot;/{id:[0-9][0-9]*}&quot;)
    fun findById(@PathParam(&quot;id&quot;) id:Long) = admPhraseRepository.findById(id)

    @PUT
    fun create(phrase: AdmPhrase): Response {
        admPhraseRepository.create(phrase)
        return Response.created(UriBuilder.fromResource(this::class.java)
                .path(phrase.phraseId.toString()).build()).build()
    }

    @POST
    @Path(&quot;/{id:[0-9][0-9]*}&quot;)
    fun update(@PathParam(&quot;id&quot;) id: Long?, phrase: AdmPhrase): Response {
        if(id != phrase.phraseId) return Response.status(Response.Status.NOT_FOUND).build()

        val updatedEntity = admPhraseRepository.update(phrase)
        return Response.ok(updatedEntity).build()
    }

    @DELETE
    @Path(&quot;/{id:[0-9][0-9]*}&quot;)
    fun delete(@PathParam(&quot;id&quot;) id: Long): Response {
        val updatedEntity = admPhraseRepository.findById(id) ?:
            return Response.status(Response.Status.NOT_FOUND).build()
        admPhraseRepository.delete(updatedEntity)
        return Response.ok().build()
    }
}
</code></pre>
<p>To try MicroProfile a second controller is created that tries to read JAVA_HOME</p>
<pre><code class="language-prettyprint">@Path(&quot;/hello&quot;)
class HelloController{

    @Inject
    @ConfigProperty(name =&quot;JAVA_HOME&quot;, defaultValue = &quot;JAVA_HOME&quot;)
    lateinit var javaHome:String

    @GET
    fun doHello() = &quot;There is no place like $javaHome&quot;

}
</code></pre>
<h3>Utilities</h3>
<p>To create a real test, four &quot;advanced components&quot; were included, being an entity manager producer for CDI components, a Flyway bootstrapper with <code>@Startup</code> EJB, a Log producer for SL4J, and a &quot;simple&quot; test with Arquillian.</p>
<p>The producer itself is pretty similar to its Java equivalent, it only takes advantage of one line methods.</p>
<pre><code class="language-prettyprint">@ApplicationScoped
class EntityManagerProducer {

    @PersistenceUnit
    private lateinit var entityManagerFactory: EntityManagerFactory

    @Produces
    @Default
    @RequestScoped
    fun create(): EntityManager = this.entityManagerFactory.createEntityManager()

    fun dispose(@Disposes @Default entityManager: EntityManager) {
        if (entityManager.isOpen) {
            entityManager.close()
        }
    }
}
</code></pre>
<p>The Flyway migration is implemented with EJB to fire it every time that this application is deployed (and of course to test EJB). Since Kotlin doesn't have a try-with-resources structure the resource management is implemented with a <code>let</code> block, making it really readable. Besides this if there is a problem the data source it will be null and <code>let</code> block won't be executed.</p>
<pre><code class="language-prettyprint">@ApplicationScoped
@Singleton
@Startup
class FlywayBootstrapper{

    @Inject
    private lateinit var logger:Logger

    @Throws(EJBException::class)
    @PostConstruct
    fun init() {

        val ctx = InitialContext()
        val dataSource = ctx.lookup(&quot;java:app/jdbc/integrumdb&quot;) as? DataSource

        dataSource.let {
            val flywayConfig = Flyway.configure()
                    .dataSource(it)
                    .locations(&quot;db/postgresql&quot;)

            val flyway = flywayConfig.load()
            val migrationInfo = flyway.info().current()

            if (migrationInfo == null) {
                logger.info(&quot;No existing database at the actual datasource&quot;)
            }
            else {
                logger.info(&quot;Found a database with the version: ${migrationInfo.version} : ${migrationInfo.description}&quot;)
            }

            flyway.migrate()
            logger.info(&quot;Successfully migrated to database version: {}&quot;, flyway.info().current().version)
            it?.connection?.close()
        }
        ctx.close()
    }
}
</code></pre>
<p>To create a non empty-database a PostgreSQL migration was created at <code>db/postgresql</code> in project resources.</p>
<pre><code class="language-prettyprint">CREATE TABLE IF NOT EXISTS public.adm_sequence_generator (
    id_sequence VARCHAR(75) DEFAULT '' NOT NULL,
    sequence_value BIGINT DEFAULT 0 NOT NULL,
    CONSTRAINT adm_sequence_generator_pk PRIMARY KEY (id_sequence)
);
COMMENT ON COLUMN public.adm_sequence_generator.id_sequence IS 'normal_text - people name, items short name';
COMMENT ON COLUMN public.adm_sequence_generator.sequence_value IS 'integuer_qty - sequences, big integer qty';


CREATE TABLE IF NOT EXISTS public.adm_phrase
(
    phrase_id BIGINT DEFAULT 0 NOT NULL,
    author varchar(25) DEFAULT '' NOT NULL,
    phrase varchar(25) DEFAULT '' NOT NULL,
    CONSTRAINT adm_phrase_pk PRIMARY KEY (phrase_id)
);

insert into adm_phrase values (1, 'Twitter','Kotlin is cool');
insert into adm_phrase values (2, 'TIOBE','Java is the king');
</code></pre>
<p>Log producer also gets benefits from one line methods</p>
<pre><code class="language-prettyprint">open class LogProducer{

    @Produces
    fun produceLog(injectionPoint: InjectionPoint): Logger =
            LoggerFactory.getLogger(injectionPoint.member.declaringClass.name)
}
</code></pre>
<p>Finally a test class is also implemented, since Kotlin doesn't have static methods a companion object with @JvmStatic annotation is created on the class, otherwise test won't be executed. This is probably one of the examples where Kotlin's program get bigger if compared to Java equivalent.</p>
<pre><code class="language-prettyprint">@RunWith(Arquillian::class)
class AdmPhraseRepositoryIT {

    @Inject
    private lateinit var admPhraseRepository: AdmPhraseRepository


    companion object ArquillianTester{

        @JvmStatic
        @Deployment
        fun bootstrapTest(): WebArchive {
            val war = createBasePersistenceWar()
                    .addClass(AdmPhraseRepository::class.java)
                    .addAsWebInfResource(&quot;test-beans.xml&quot;, &quot;beans.xml&quot;)
            println(war.toString(true))

            return war
        }
    }

    @Test
    fun testPersistance(){
        val phrase = AdmPhrase( author = &quot;Torvalds&quot;, phrase = &quot;Intelligence is the ability to avoid doing work, yet getting the work done&quot;)
        admPhraseRepository.create(phrase)
        assertNotNull(phrase.phraseId)
    }
}
</code></pre>
<h2>Testing the application with IntelliJ IDEA and Payara 5</h2>
<p>If the application is executed/debugged on IntelliJ IDEA all works as expected, sincerely I wasn't expecting an easy road but this worked really well. For instance a debugging session is initiated with Payara 5:</p>
<p><img src="/images/posts/kotlinee/intellijdebug.png" alt="Debugging as expected" title="Debugging as expected" /></p>
<p>I could also retrieve the results from RDMBS</p>
<p><img src="/images/posts/kotlinee/phrases.png" alt="Json Phrases" title="Json Phrases" /></p>
<p>And my hello world with MicroProfile works too</p>
<p><img src="/images/posts/kotlinee/hellomicroprofie.png" alt="Hello Microprofile" title="Hello Microprofile" />.</p>
<h2>Testing the application on Oracle Cloud</h2>
<p>As <a href="https://developer.oracle.com/ambassador">Oracle Groundbreaker Ambassador</a> I have access to instances on Oracle Cloud, hence I created and deployed the same application just to check if there are any other caveats.</p>
<p>Packing applications in Payara Micro is very easy, basically you copy your application to a predefined location:</p>
<pre><code class="language-prettyprint">FROM payara/micro
COPY target/integrum-ee.war $DEPLOY_DIR
</code></pre>
<p>A scalable Docker Compose descriptor is needed to provide a simple load balancer and RDBMS, this step is also applicable with Kubernetes, Docker Swarm, Rancher, etc.</p>
<pre><code class="language-prettyprint">version: '3.1'
services:
  db:
    image: postgres:9.6.1
    restart: always
    environment:
      POSTGRES_PASSWORD: informatica
      POSTGRES_DB: integrum
    networks:
      - webnet
  web:
    image: &quot;integrum-ee:latest&quot;
    restart: always
    environment:
      JDBC_URL: 'jdbc:postgresql://db:5432/integrum'
      JAVA_TOOL_OPTIONS: '-Xmx64m'
      POSTGRES_PASSWORD: informatica
      POSTGRES_DB: integrum
    ports:
      - 8080
    networks:
      - webnet
  nginx:
    image: nginx:latest
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web
    ports:
      - &quot;4000:4000&quot;
    networks:
      - webnet
networks:
  webnet:
</code></pre>
<p>A simple nginx.conf file is created just to balance the access to Payara (eventual and scalable) Workers:</p>
<pre><code class="language-prettyprint">user  nginx;

events {
    worker_connections   1000;
}
http {
        server {
              listen 4000;
              location / {
                proxy_pass http://web:8080;
              }
        }
}
</code></pre>
<p>The JTA resource is created via <code>glassfish-resources.xml</code> expressing RDBMS credentials with env variables:</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE resources PUBLIC &quot;-//GlassFish.org//DTD GlassFish Application Server 3.1 Resource Definitions//EN&quot; &quot;http://glassfish.org/dtds/glassfish-resources_1_5.dtd&quot;&gt;
&lt;resources&gt;
    &lt;jdbc-connection-pool name=&quot;postgres_appPool&quot; allow-non-component-callers=&quot;false&quot; associate-with-thread=&quot;false&quot; connection-creation-retry-attempts=&quot;0&quot; connection-creation-retry-interval-in-seconds=&quot;10&quot; connection-leak-reclaim=&quot;false&quot; connection-leak-timeout-in-seconds=&quot;0&quot; connection-validation-method=&quot;table&quot; datasource-classname=&quot;org.postgresql.ds.PGSimpleDataSource&quot; fail-all-connections=&quot;false&quot; idle-timeout-in-seconds=&quot;300&quot; is-connection-validation-required=&quot;false&quot; is-isolation-level-guaranteed=&quot;true&quot; lazy-connection-association=&quot;false&quot; lazy-connection-enlistment=&quot;false&quot; match-connections=&quot;false&quot; max-connection-usage-count=&quot;0&quot; max-pool-size=&quot;200&quot; max-wait-time-in-millis=&quot;60000&quot; non-transactional-connections=&quot;false&quot; ping=&quot;false&quot; pool-resize-quantity=&quot;2&quot; pooling=&quot;true&quot; res-type=&quot;javax.sql.DataSource&quot; statement-cache-size=&quot;0&quot; statement-leak-reclaim=&quot;false&quot; statement-leak-timeout-in-seconds=&quot;0&quot; statement-timeout-in-seconds=&quot;-1&quot; steady-pool-size=&quot;8&quot; validate-atmost-once-period-in-seconds=&quot;0&quot; wrap-jdbc-objects=&quot;true&quot;&gt;
        &lt;property name=&quot;URL&quot; value=&quot;${ENV=JDBC_URL}&quot;/&gt;
        &lt;property name=&quot;User&quot; value=&quot;postgres&quot;/&gt;
        &lt;property name=&quot;Password&quot; value=&quot;${ENV=POSTGRES_PASSWORD}&quot;/&gt;
        &lt;property name=&quot;DatabaseName&quot; value=&quot;${ENV=POSTGRES_DB}&quot;/&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;org.postgresql.Driver&quot;/&gt;
    &lt;/jdbc-connection-pool&gt;
    &lt;jdbc-resource enabled=&quot;true&quot; jndi-name=&quot;java:app/jdbc/integrumdb&quot; object-type=&quot;user&quot; pool-name=&quot;postgres_appPool&quot;/&gt;
&lt;/resources&gt;
</code></pre>
<p>After that, Invoking the compose file will bring the application+infrastructure to life. Now it's time to test it on a real cloud. First the image is published to Oracle's Container Registry</p>
<p><img src="/images/posts/kotlinee/ocs.png" alt="Oracle Container Registry" title="Oracle Container Registry" /></p>
<p>Once the container is available at Oracle Cloud the image become usable for any kind of orchestation, for simplicity I'm running directly the compose file over a bare CentOS VM image (the Wercker+Docker+Kubernetes is an entirely different tutorial).</p>
<p><img src="/images/posts/kotlinee/registry.png" alt="Oracle Container Registry" title="Oracle Container Registry" /></p>
<p>To use it on Oracle's infrasctructure, the image ID should be switched to the full name <code>image: iad.ocir.io/tuxtor/microprofile/integrum-ee:1</code>, in the end the image is pulled, and the final result is our Kotlin EE application running over Oracle Cloud.</p>
<p><img src="/images/posts/kotlinee/oracle-cloud.png" alt="Oracle Cloud" title="Oracle Cloud" /></p>
<h2>Testing the application with NetBeans</h2>
<p>JetBrains <a href="https://github.com/JetBrains/kotlin-netbeans">dropped Kotlin support for NetBeans in 2017</a>, I tried the plugin just for fun on NetBeans 11 but it hangs Netbeans startup while loading Kotlin support, so NetBeans tests were not possible.</p>
<p><img src="/images/posts/kotlinee/kotlinnetbeans.png" alt="Kotlin NetBeans" title="Kotlin NetBeans" /></p>
<h2>Testing the application with Eclipse for Java EE</h2>
<p><a href="https://github.com/JetBrains/kotlin-eclipse">JetBeans currently develops a Kotlin complement</a> for Eclipse and seems to work fine with pure Kotlin projects, however the history is very different for Jakarta EE.</p>
<p>After importing the Maven project (previously created in IntelliJ IDEA) many default <a href="http://help.eclipse.org/oxygen/topic/org.eclipse.jst.j2ee.doc.user/topics/cfacets.html">facets</a> are included in the project, being CDI the most problematic, it takes a lot of time to build the project in the CDI builder step.</p>
<p><img src="/images/posts/kotlinee/cdisleep.png" alt="CDI slow" title="CDI slow" /></p>
<p>Besides that, Jakarta EE complements/parsers work over the code and not the class files, hence the &quot;advanced&quot; menus don't show content, a very cosmetic detail anyway. If Kotlin sources are located under <code>src/main/kotlin</code> as suggested by JetBrains Maven guide, these are ignored by default. Hence, I took the easy road and moved all the code to <code>src/main/java</code>.</p>
<p><img src="/images/posts/kotlinee/facets.png" alt="Eclipse facets" title="Eclipse facets" /></p>
<p>Kotlin syntax highlighting works fine, as expected from any language on Eclipse.</p>
<p><img src="/images/posts/kotlinee/kotlineclipse.png" alt="Kotlin syntax" title="Kotlin syntax" /></p>
<p>However if you try to deploy the application it simply doesn't work because Eclipse compiler does not produce the class file for Kotlin source files, <a href="https://youtrack.jetbrains.com/issue/KE-57?p=KT-14838">a bug was raised in 2017</a> and many <a href="https://discuss.kotlinlang.org/t/eclipse-maven-m2e-wtp-with-kotlin/2604">other users report issues with Tomcat and Wildfly</a>. Basically <a href="https://www.eclipse.org/webtools/">Eclipse WTP</a> is not compatible with Kotlin and deployment/debugging Kotlin code won't work over an application server.</p>
<h2>Final considerations</h2>
<p>At the end I was a little dissapointed, <strong>Kotlin has great potential for Jakarta EE but it works only if you use IntelliJ IDEA</strong>. I'm not sure about IntelliJ CE but as stated in JetBrains website, <a href="https://www.jetbrains.com/idea/buy/">EE support is only included on Ultimate Edition</a>, maybe this could be changed with more community involvemente but I'm not sure if this is the right direction considering <a href="https://openjdk.java.net/projects/amber/">project Amber</a>.</p>
</p>
        <a href="../blog/2018/2018-12-19-Book-review-Enterprise-Java-Microservices.html"><h1>Book Review: Enterprise Java Microservices by Ken Finnigan</h1></a>
        <p>19 December 2018</p>
        <p><p><img src="/images/posts/ejmicro/cover.png" alt="Enterprise Java Microservices cover" title="Enterprise Java Microservices" /></p>
<h2>General information</h2>
<ul>
<li>Pages: 245</li>
<li>Published by: Manning</li>
<li>Release date: nov 2018</li>
</ul>
<blockquote>
<p>Disclaimer: I received this book as a collaboration with Manning and the author.</p>
</blockquote>
<h2>Some context on learning Microservices</h2>
<p>Let's clarify one thing, switching from Monoliths to Microservices is not like switching from traditional JavaEE to Spring (and viceversa), <strong>is more like learning to develop software again</strong> because you have to learn:</p>
<ul>
<li>New architectural patterns</li>
<li>How to work with distributed transactions</li>
<li>How to guarantee consistency in distributed data (or not)</li>
<li>New plumbing/management tools like Docker, Kubernets, Pipelines</li>
<li>New frameworks and/or old frameworks with new Cloud Native capabilities</li>
</ul>
<p>Despite really good publications like the <a href="https://12factor.net/">12 factors for web native applications</a>. <strong>From my perspective the real challenge on learning Microservices is the lack of a central documentation/tutorial/from 0 to wow guide.</strong></p>
<p>In the old days, if you wanted to learn enterprise software development on Java, you simply took the Java EE tutorial from 0 to 100, maybe a second tutorial like <a href="https://developers.redhat.com/ticket-monster/">Ticket Monster</a>, a couple of reference books and that's it. However, learning Microservices is more like:</p>
<ul>
<li>Learning new cloud native capabilities of old frameworks in documentations that take for granted your knowledge of previous versions of the framework</li>
<li>Or learning new frameworks with words like reactive, functional, non-blocking, bazinga</li>
<li>Learning new design patterns without knowing the real motivation of each pattern</li>
<li>Surfing in a lot of reddit and StackOverflow discussions on not-so clear explanations</li>
<li>Learning Docker and Kubernets because every body is doing it</li>
<li>Hitting end roads because you are accustomed to things like JNDI, JTA, Stateful sessions</li>
</ul>
<h2>About the book</h2>
<p>Do you see the problem? The lack of a cohesive guide that explains who, how and why you need the zillion of new tools makes the path of learning Microservices an uphill battle, and that's where <strong>Enterprise Java Microservices</strong> shines.</p>
<p>Enterprise Java Microservices is one of the <strong>first attempts to create a cohesive guide with special focus on Java EE developers and MicroProfile</strong>. The book is divided in two main sections, the first one focused on Microservice basics (my favorite) and the second one focused on Microservices implementations with specific libraries (being a little bit biased for Red Hat Solutions).</p>
<h3>First section</h3>
<p><strong>For those that already have some Enterprise Java knowledge but don't have too much idea about the new challenges in the Microservice world this will be the most useful section</strong>, with your actual knowledge you should be able to understand:</p>
<ul>
<li>The main differences between monoliths and microservices architectural styles and patterns, this is by far the most important section for me and gave me a couple of new ideas debunking some misconceptions that I had</li>
<li>Just Enough and Micro application servers/frameworks</li>
<li>New jargon on the cloud native world (yup you have to learn a lot of new acronyms)</li>
<li>General knowledge on testing Microservices</li>
<li>Why do you need new tools like service discovery, service registry, gateways, etc.</li>
<li>Principles of reactive applications</li>
</ul>
<p>This section also includes a brief introduction to API/Rest Web Services creation with Java EE and Spring, however I'm not sure about the feeling of this section for a newcomer.</p>
<h3>Second section</h3>
<p>Once you took the basis from the first section (or from bad implementations and end roads in the real life like me), this section will cover three of the most complex and important topics in Microservices, being:</p>
<ol>
<li>Service discovery and load balancing</li>
<li>Fault tolerance (circuit breakers, bulkheads, etc.)</li>
<li>Strategies for management and monitoring microservices</li>
</ol>
<p><strong>The chapters of the second section are structured in a way that makes easier to understand why do you need the &quot;topic&quot; that you are about to learn</strong>, however and despite being early focused on MicroProfile, it will use specific libraries like Hystrix, Ribbon and Feing (yes, like in Spring Boot) for the implementation of these patterns, adding also some specific integrations with Thorntail.</p>
<p>Later on, the book evolves over a sample application, covering topics like security, architectures with Docker/Kubernets and data streams processing, where as I said a particular bias is present, implementing the solutions by using Minishift, Keycloack and other Red Hat specifics.</p>
<p>To clarify, <strong>I don't think that this bias is bad, considering that there are (as I said) a zillion of alternatives for <a href="https://www.eclipsecon.org/europe2018/sessions/build-12-factor-microservice-using-microprofile">those factors not covered by Java</a></strong>, I think it was the right decision.</p>
<h2>Things that could be better</h2>
<p>As any review this is the most difficult section to write, but I think that a second edition should include:</p>
<ul>
<li>MicroProfile fault tolerance</li>
<li>MicroProfile type safe clients</li>
</ul>
<p>Since Ken is one of the guys behind MicroProfile implementation in Red Hat, I'm guessing that the main motivation for not including it is simple, MicroProfile is evolving so fast that these standards were presented after book printing.</p>
<p>People looking for data consistency patterns (CQRS, Event Sourcing, eventual consistency, etc.) could find the streaming processing section a little smaller than it should be.</p>
<h2>Who should read this book?</h2>
<ul>
<li>Java developers with strong foundations, or experience in Spring or Java EE</li>
</ul>
<p>Yes, despite their coverage of basic APIs, I think that you need foundations like those covered in OCP certification, otherwise you will be confused in the implementation of annotations, callbacks, declarative and imperative code.</p>
</p>
        <a href="../blog/2018/2018-10-31-Eclipse-Metrics-Usecases.html"><h1>Eclipse MicroProfile Metrics, practical use cases</h1></a>
        <p>31 October 2018</p>
        <p><h2>Background</h2>
<p>At the end of 2000 decade, one of the main motivations for DevOps creation was the (relatively speaking) neglected interaction between development, QA and operations teams.</p>
<p>In this line, <strong>the &quot;DevOps promise&quot; could be summarized as the union between culture, practices and tools</strong> to improve software quality and, at the same time, to speed up software development teams in terms of time to market. Winning in many successful implementations colateral effects like scalability, stability, security and development speed.</p>
<p>In line with <a href="https://aws.amazon.com/devops/what-is-devops/">diverse opinions</a>, to implement a successful DevOps culture IT teams need to implement practices like:</p>
<ul>
<li>Continuos integration (CI)</li>
<li>Continuos delivery (CD)</li>
<li>MicroServices</li>
<li>Infrastructure as code</li>
<li>Communication and collaboration</li>
<li><strong>Monitoring and metrics</strong></li>
</ul>
<p>In this world of <strong>buzzwords</strong> it's indeed difficult to identify the DevOps maturity state without losing the final goal: <strong>To create applications that generate value for the customer in short periods of time</strong>.</p>
<p>In this post, we will discuss about monitoring and metrics in the Java Enterprise World, specially how the new DevOps practices impact the architectural decision at the technology selection phase.</p>
<h2>Metrics in Java monoliths</h2>
<p>If traditional architectures are considered, monolithic applications hold common characteristics like:</p>
<ol>
<li>Execution over servlet containers and application servers, with the JVM being a <strong>long running</strong> process.</li>
<li>Ideally, these containers are never rebooted, or reboots are allowed on planned maintenance Windows.</li>
<li>An application could compromise the integrity of the entire monolith under several conditions like bad code, bad deployments and server issues.</li>
</ol>
<p><strong>Without considering any Java framework, the deployment structure will be similar to the figure</strong>. In here we observe that applications are distributed by using .war or .jar files, being collected in .ear files for management purposes. In these architectures applications are created as modules, and separated considering its business objectives.</p>
<p><img src="/images/posts/metrics/monolith.png" alt="Monolith deployment" /></p>
<p>If a need to scale appears, there are basically two options, <strong>1- to scale server resources (vertical) and 2- to add more servers with an application copy to distribute clients using a load balancer</strong>. It is worth to notice that new nodes tend to be also <strong>long running</strong> processes, since any application server reboot implies a considerable amount of time that is directly proportional to the quantity of applications that have been deployed.</p>
<p>Hence, the decision to provision (or not) a new application server often is a combined decision between development and operations teams, and with this you have the following options to monitor the state of your applications and application server:</p>
<ol>
<li>Vendor or vendor-neutral telemetric APIs -e.g  <a href="https://jolokia.org/">Jookla</a>, <a href="https://www.oracle.com/technetwork/articles/java/glassfishmm-2082439.html">Glassfish REST Metrics</a>-</li>
<li>JMX monitoring through specific tools and ports -e.g. <a href="https://visualvm.github.io/">VisualVM</a>, <a href="https://github.com/JDKMissionControl/jmc">Mission Control</a>-</li>
<li>&quot;Shell wrangling&quot; with tail, sed, cat, top and htop</li>
</ol>
<p>It should be noticed also, in this kind of deployments it's necessary to obtain metrics from <strong>application and server</strong>, creating a complex scenario for status monitoring.</p>
<p>The <em>rule of thumb</em> for this scenarios is often to choose telemetric/own APIs to monitor application state and JMX/Logs for a deeper analysis of runtime situation, again presenting more questions:</p>
<ul>
<li>Which telemetric API should I choose? Do I need a specific format?</li>
<li>Server's telemetry would be sufficient? How metrics will be processed?</li>
<li>How do I got access to JMX in my deployments if I'm a Containers/PaaS user?</li>
</ul>
<h2>Reactive applications</h2>
<p><strong>One of the (not so) recent approaches to improve users experience is to implement reactive systems</strong> with the defined principles of the <a href="https://www.reactivemanifesto.org/">Reactive Manifesto</a>.</p>
<p><img src="/images/posts/metrics/reactive-traits.png" alt="Reactive manifesto" /></p>
<p>In short, a reactive system is a system capable of:</p>
<ul>
<li>Being directed/activated by messages often processed asynchronously</li>
<li>Presents resilience by failing partially, without compromising all the system</li>
<li>Is elastic to provision and halt modules and resources on demand, having a direct impact in resources billing</li>
<li>The final result is a responsive system for the user</li>
</ul>
<p>Despite not being discussed so often, <strong>reactive architectures have a direct impact on metrics</strong>. With dynamic provisioning you won't have long running processes to attach and save metrics, and additionally the services are switching ip addresses depending on clients demand.</p>
<h2>Metrics in Java Microservices architectures</h2>
<p>Without considering any particular framework or library, the reactive architectural style puts as <strong>strong suggestion</strong> the usage of containers and/or Microservice, specially for resilience and elasticity:</p>
<p><img src="/images/posts/metrics/microservices.png" alt="Microservices deployment" /></p>
<p>In a traditional Microservices architecture we observe that services are basically short-lived &quot;workers&quot;, which could have clones reacting to changes on clients demand. These environments are often orchestrated with tools like Docker Swarm or Kubernetes, hence each service is responsable of register themself to a service registry acting as a directory. Being the registry, the ideal source for any metric tool to read services location, <strong>pulling and saving the correspondent metrics</strong>.</p>
<h2>Metrics with Java EE and Eclipse MicroProfile</h2>
<p>Despite the early efforts on the EE space like <a href="https://jcp.org/en/jsr/detail?id=77">an administrative API with metrics</a>, the need of a formal standard for metrics became mandatory due Microservices popularization. Being <strong><a href="https://metrics.dropwizard.io/3.1.0/">Dropwizard Metrics</a> one of the pioneers to cover the need of a telemetric toolkit with <a href="https://github.com/astefanutti/metrics-cdi">specific CDI extensions</a></strong>.</p>
<p>In this line, the MicroProfile project has included among its recent versions(1.4 and 2.0) support for Healthcheck and state Metrics. <strong>Many of the current DropWizard users would notice that annotations are similar if not the same. In fact MicroProfile annotations are based directly on DropWizard's <a href="https://microprofile.io/project/eclipse/microprofile-metrics/spec/src/main/asciidoc/app-programming-model.adoc">API 3.2.3</a></strong>.</p>
<p>To differentiate between concepts, Healtheck API is in charge of answering a simple question &quot;Is the service running and how well is it doing it?&quot; and are targeted for orchestrations. On the other side Metrics present instant or periodical metrics on how services are reacting over consumers requests.</p>
<p>Latest version of MicroProfile (2.0) includes support for Metrics 1.1, including:</p>
<ul>
<li>Counted</li>
<li>Gauge</li>
<li>Metered</li>
<li>Timed</li>
<li>Histogram</li>
</ul>
<p>So, it is worth to <strong>give them a try with practical use cases</strong>.</p>
<h2>Metrics with Payara and Eclipse MicroProfile</h2>
<p>For the test we will use an application composed by two microservices, as described in the diagram:</p>
<p><img src="/images/posts/metrics/demomicro.png" alt="Arquitectura tests" /></p>
<p><strong>Our scenario includes two microservices, OmdbService focused on information retrieving from <a href="http://www.omdbapi.com/">OMDB</a> to obtain up to date movie information and MovieService aimed to obtain movie information from a relational database and mix it with OMDB plot</strong>. Projects code is available at GitHub.</p>
<ul>
<li><a href="https://github.com/tuxtor/payara-demo/tree/micro">https://github.com/tuxtor/payara-demo/tree/micro</a></li>
<li><a href="https://github.com/tuxtor/omdb-demo">https://github.com/tuxtor/omdb-demo</a></li>
</ul>
<p>To activate support for MicroProfile 2.0 two things are needed, 1- the right dependency on pom.xml and 2- to deploy/run our application over a MicroProfile compatible implementation, like Payara Micro.</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.eclipse.microprofile&lt;/groupId&gt;
	&lt;artifactId&gt;microprofile&lt;/artifactId&gt;
	&lt;type&gt;pom&lt;/type&gt;
	&lt;version&gt;2.0.1&lt;/version&gt;
	&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>MicroProfile uses a basic convention in regards of metrics, presenting three levels:</p>
<ol>
<li><strong>Base:</strong> Mandatory Metrics for all MicroProfile implementations, located at <code>/metrics/base</code></li>
<li><strong>Application:</strong> Custom metrics exposed by the developer, located at <code>/metrics/application</code></li>
<li><strong>Vendor:</strong> Any MicroProfile implementation could implement its own variant, located at <code>/metrics/vendor</code></li>
</ol>
<p>Depending on requests header, metrics will be available in JSON or <a href="https://openmetrics.io/">OpenMetrics</a> format. The last one popularized by Prometheus, a <a href="https://www.cncf.io/announcement/2018/08/09/prometheus-graduates/">Cloud Native Computing Foundation project</a>.</p>
<h2>Practical use cases</h2>
<p>So far, we've established that:</p>
<ol>
<li>You could monitor your Java application by using telemetric APIs and JMX</li>
<li>Reactive applications present new challenges, specially due microservices dynamic and short running nature</li>
<li>JMX is sometimes difficult to implement on container/PaaS based deployments</li>
<li>MicroProfile Metrics is a new proposal for Java(Jakarta) EE environments, working indistinctly for monoliths and microservices architectures</li>
</ol>
<p>In this post we present a couple of cases discussed also at Oracle Code One:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/eUiXJWDy_g0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h3>Case 0: Telemetry from JVM</h3>
<p>To give a quick look on MicroProfile metrics, it is enough to boot a MicroProfile compliant app server/microservice framework with any deployment. Since Payara Micro is compatible with Microprofile, <strong>metrics will be available from the beginning</strong> at <code>http://localhost:8080/metrics/base</code>.</p>
<p><img src="/images/posts/metrics/base-metrics.png" alt="Base metrics" /></p>
<p>You could switch the <strong>Accept request header</strong> in order to obtain JSON format, in curl for instance:</p>
<pre><code>curl -H &quot;Accept: application/json&quot; http://localhost:8080/metrics/base
</code></pre>
<p><img src="/images/posts/metrics/json-metrics.png" alt="JSON metrics" /></p>
<p>By itself metrics are just an <strong>up to date snapshot</strong> about platform state. If you wanna compare these snapshots over time, metrics should be retrieved on constant periods of time . . . or you could integrate prometheus which already does it for you. In here I demonstrate some useful querys for JVM state, including heap state, cpu utilization and GC executions:</p>
<pre><code>base:memory_used_heap_bytes
</code></pre>
<p><img src="/images/posts/metrics/metrics-heap.png" alt="Heap metrics" /></p>
<pre><code>base:cpu_system_load_average
</code></pre>
<p><img src="/images/posts/metrics/metrics-cpu.png" alt="CPU metrics" /></p>
<pre><code>base:gc_ps_mark_sweep_count
</code></pre>
<p><img src="/images/posts/metrics/metrics-gc.png" alt="GC metrics" /></p>
<h3>Case 1: Metrics for Microservices</h3>
<p>In a regular and &quot;full tolerant&quot; request from one microservice to another your communication flow will go through the following decisions:</p>
<p><img src="/images/posts/metrics/fallpattern.png" alt="Metrics fallback patterns" /></p>
<ol>
<li>To use or not a cache to attend the request</li>
<li>To cut the communication (circuit breaker) and execute a fallback method if a metric threshold has been reached</li>
<li>To reject the request if a bulkhead has been exhausted and execute a fallback method instead</li>
<li>To execute a fallback method if the execution reached a failed state</li>
</ol>
<p>Many of the caveats on developing Microservices come from the fact that you are dealing with distributed computation, hence you should include new patterns that already depend on metrics. If metrics are being generated, with exposure you will gain data for improvements, diagnosis and issue management.</p>
<h4>Case 1.1: Counted to retrieve failed hits</h4>
<p>The first metric to implement will be Counted, a pretty simple one actually. Its main objective is to increment/decrement its value over time. <strong>In this use case the metric is counting how many times the service reached the fallBack alternative</strong> by injecting it directly on a JAX-RS service:</p>
<pre><code class="language-prettyprint">@Inject
@Metric
Counter failedQueries;
...
@GET
@Path(&quot;/{id:[a-z]*[0-9][0-9]*}&quot;)
@Fallback(fallbackMethod = &quot;findByIdFallBack&quot;)
@Timeout(TIMEOUT)
public Response findById(@PathParam(&quot;id&quot;) 
final String imdbId) {
...
}

public Response findByIdFallBack(@PathParam(&quot;id&quot;) 
final String imdbId) {
	...
	failedQueries.inc();
}
</code></pre>
<p>After simulating a couple of failed queries over OMDB database (no internet :) ) the metric <code>application:com_nabenik_omdb_rest_omdb_endpoint_failed_queries</code> shows how many times my service has invoked the fallback method:</p>
<p><img src="/images/posts/metrics/counted-metrics.png" alt="Counted metrics" /></p>
<h4>Case 1.2: Gauge to create your own metric</h4>
<p>Although you could depend on simple counters to describe the state of any given service. With gauge you could create your own metric . . . like a dummy metric to display 100 or 50 depending on odd/even random number:</p>
<pre><code class="language-prettyprint">@Gauge(unit = &quot;ExternalDatabases&quot;, name = &quot;movieDatabases&quot;, absolute = true)
public long getDatabases() {
	int number = (int)(Math.random() * 100);
	int criteria = number % 2;
	
	if(criteria == 0) {
		return 100;
	}else {
		return 50;
	}
}
</code></pre>
<p>Again, you could search for the metric at prometheus, specifically <code>application:movie_databases_ExternalDatabases</code></p>
<p><img src="/images/posts/metrics/gauge-metrics.png" alt="Gauge metrics" /></p>
<h4>Case 1.3: Metered to analyze request totals</h4>
<p>Are you charging your API per request? Don't worry you could measure the usage rate with <code>@Metered</code>.</p>
<pre><code class="language-prettyprint">@Metered(name = &quot;moviesRetrieved&quot;,
	unit = MetricUnits.MINUTES,
	description = &quot;Metrics to monitor movies&quot;,
	absolute = true)
public Response findExpandedById(@PathParam(&quot;id&quot;) final Long id) 
</code></pre>
<p>In this practical use case 500 +/- requests where simulated over a one minute period. As you could observe from the metric <code>application:movies_retrieved_total</code> the stress test from JMeter and Prometheus show the same information:</p>
<p><img src="/images/posts/metrics/metered-stress.png" alt="Stress metrics" /><br />
<img src="/images/posts/metrics/metered-metric.png" alt="Metered metrics" /></p>
<h4>Case 1.4: Timed to analyze your response performance</h4>
<p>If used properly, <code>@Timed</code> will give you information about requests performance over time units.</p>
<pre><code class="language-prettyprint">@Timed(name = &quot;moviesDelay&quot;,
	description = &quot;Metrics to monitor the time for movies retrieval&quot;,
	unit = MetricUnits.MINUTES,
	absolute = true)
public Response findExpandedById(@PathParam(&quot;id&quot;) final Long id)
</code></pre>
<p>By retrieving the metric <code>application:movies_delay_rate_per_second</code> its observable that requests take more time to complete at the end of the stress test (as expected with more traffic, less bandwidth and more time to answer):</p>
<p><img src="/images/posts/metrics/timed-metric.png" alt="Timed metrics" /></p>
<h4>Case 1.5: Histogram to accumulate useful information</h4>
<p>As described in Wikipedia, an Histogram is an accurate representation of the distribution of numerical data. Hence we could create our own distribution by manipulating directly the metrics API with any given data, like global attendees:</p>
<pre><code class="language-prettyprint">@Inject
MetricRegistry registry;

@POST
@Path(&quot;/add/{attendees}&quot;)
public Response addAttendees(@PathParam(&quot;attendees&quot;) Long attendees) {
	Metadata metadata =
	new Metadata(&quot;matrix attendees&quot;,
	MetricType.HISTOGRAM);
	Histogram histogram = 
	registry.histogram(metadata);
	histogram.update(attendees);
	return Response.ok().build();
}
</code></pre>
<p>And as any distribution, we could get the mins, max, average and values per quantile:</p>
<p><img src="/images/posts/metrics/histogram-metric.png" alt="Histogram metrics" /></p>
</p>
        <a href="../blog/2018/2018-08-22-Book-review-best-developer-job.html"><h1>Book Review: Best Developer Job Ever! by Bruno Souza</h1></a>
        <p>22 August 2018</p>
        <p><p><img src="/images/posts/bestjob/cover.jpg" alt="Best Developer Job Ever! cover" title="Best Developer Job Ever" /></p>
<h2>General information</h2>
<ul>
<li>Pages: 95</li>
<li>Published by: Amazon Digital Services LLC</li>
<li>Release date: july 2018</li>
</ul>
<h2>About the author</h2>
<p>I should start this review with a personal comment about the author, <a href="https://twitter.com/brjavaman">Bruno</a> as many Java developers know is one of the most influential leaders in the Java community, being in my case one of the people that adviced me to create a <a href="https://blogs.oracle.com/java/2016-duke%E2%80%99s-choice-award-winners">Duke's Choice Award winner</a> project. Hence when he announced the release of his developers advisory book, It went directly to my reading list.</p>
<h2>About the book</h2>
<p>Different from some motivational books that I've read, this book is focused in just one topic with a practical approach:</p>
<blockquote>
<p>How do I improve my professional carreer as software developer?</p>
</blockquote>
<p>For a regular book reader it will be a very short book, it took me 3 hours to complete the book from start to end.</p>
<p>The book is divided in five main sections:</p>
<ol>
<li>Get clarity on your strengths</li>
<li>Define your objectives</li>
<li>(How to) Expand your network</li>
<li>Promote yourself (in the right way)</li>
<li>Get quality interviews</li>
</ol>
<p>From reading just the section titles, readers could be tempted to guess that this book is focused on boosting any professional carreer, however each section and advice is tailored to IT following an evolutive approach:</p>
<ul>
<li>Any advice starts with an argumentative step, presenting diverse paths to reach the same professional objective in IT and specially in software development</li>
<li>After argumentation and based in author's real world experience, some advices are presented to choose the best path and take advantage of it in a productive way</li>
<li>Finally, some tools, tips and techniques are presented and complemented with various success histories to validate the tips (whick I must say, I know them to be true)</li>
</ul>
<h2>Room for improvement</h2>
<p>The main caveat for this book is that isn't available in other languages. I also noticed that despite presenting many usefull advices, it lacks of some diagrams to re-read the tips and act also as a developers carreer manual.</p>
<p>For the non-casual readers, the writting style could be interpreted as too informal or not so literary. As is, the book is written as an informal conversation between peers and it's a little bit repetitive while trying to emphasize some important points. It depends on readers background.</p>
<h2>Who should read this book?</h2>
<ul>
<li>Any IT professional, specialy software developers</li>
<li>IT recruiters, it will give serious advices of how software development world works</li>
</ul>
<p>To finish the review, I think that the following excerpt contains the spirit of the book</p>
<blockquote>
<p>People can be givers or takers. The givers come in and bring things others can benefit from while the takers take more than they give and ultimately drag the network down by trying to benefit themselves. That’s why givers tend to grow more than takers or matchers.</p>
</blockquote>
</p>
        <a href="../blog/2018/2018-07-30-NetBeans-9-JavaEE-JakartaEE.html"><h1>Notes on Java EE support for NetBeans 9</h1></a>
        <p>30 July 2018</p>
        <p><p>Today one of my favourite open source projects got a major release, now under Apache Foundation, welcome back NetBeans!.</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">The <a href="https://twitter.com/TheASF?ref_src=twsrc%5Etfw">@TheASF</a> <a href="https://twitter.com/netbeans?ref_src=twsrc%5Etfw">@NetBeans</a> community is proud to announce the 1st official release of <a href="https://twitter.com/TheASF?ref_src=twsrc%5Etfw">@TheASF</a> <a href="https://twitter.com/netbeans?ref_src=twsrc%5Etfw">@NetBeans</a> (incubating): <a href="https://t.co/GJLsExeWXO">https://t.co/GJLsExeWXO</a> Especially for devs, users, and students of JDK 8, 9, and 10. 100% free and open source and we welcome pull requests: <a href="https://t.co/AT39k8NCnO">https://t.co/AT39k8NCnO</a> <a href="https://t.co/Ae70AyqiGp">pic.twitter.com/Ae70AyqiGp</a></p>&mdash; Apache NetBeans (incubating) (@netbeans) <a href="https://twitter.com/netbeans/status/1023647803116015616?ref_src=twsrc%5Etfw">July 29, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>In this line, I think that the most frequent question since beta release is:</p>
<blockquote>
<p>What about Java EE/C++/PHP/JavaME . . .? You name it</p>
</blockquote>
<p><strong>Quick response:</strong></p>
<p><strong>First source code donation to Apache includes only base NetBeans platform</strong> modules plus Java SE support</p>
<p><strong>Long response:</strong></p>
<p><a href="https://blogs.apache.org/netbeans/entry/announce-apache-netbeans-incubating-92">Please see Apache Foundation official statement</a>.</p>
<h2>Does it mean that I won't be able to develop my Java EE application on NetBeans 9</h2>
<p><strong>Short answer:</strong> No</p>
<p><strong>Long answer:</strong> Currently Oracle already did a second donation, where most of NetBeans modules considered as external are included, as Apache statement suggests we could expect these modules on future NetBeans releases.</p>
<h2>Is it possible to enable Java EE support in NetBeans 9?</h2>
<p>Considering that NetBeans has been modular since . . . ever, we could expect support for old modules in the new NetBeans version. As a matter of fact, <strong>this is the official approach to enable Java EE support on NetBeans 9</strong>, <a href="https://blogs.apache.org/netbeans/entry/what-s-happened-to-my">by using kits</a>.</p>
<p>Hence I've prepared a small tutorial to achieve this. This tutorial is focused on MacOS but steps should be exactly the same for Linux and Windows. To show some caveats, I've tested two app server over Java 8 and Java 10.</p>
<h3>Downloading NetBeans 9.0</h3>
<p>First, you should download NetBeans package from official Apache Mirrors, at this time distributions are only available as .zip files.</p>
<p><img src="/images/posts/nb9/nb9-download.png" alt="NetBeans 9 Download" title="NetBeans 9 download" /></p>
<p>After download, just uncompress the .zip file</p>
<pre><code class="language-bash">unzip incubating-netbeans-java-9.0-bin.zip
</code></pre>
<p>You should find a netbeans executable at <code>bin/</code> directory, for Unix:</p>
<pre><code class="language-bash">cd netbeans
bin/netbeans
</code></pre>
<p>Whit this you would be able to run NetBeans 9. <strong>By default, NetBeans will run on the most up-to date JVM available at system.</strong></p>
<p><img src="/images/posts/nb9/nb9.png" alt="NetBeans 9" title="NetBeans 9" /></p>
<h3>Enabling Java EE support</h3>
<p>To install Java EE support you should enable also NetBeans 8.2 update center repository.</p>
<p>First go to <code>Tools &gt; Plugins &gt; Settings</code>.</p>
<p>Second, add a new update repository:</p>
<blockquote>
<p><a href="http://updates.netbeans.org/netbeans/updates/8.2/uc/final/distribution/catalog.xml.gz">http://updates.netbeans.org/netbeans/updates/8.2/uc/final/distribution/catalog.xml.gz</a></p>
</blockquote>
<p><img src="/images/posts/nb9/nb82update.png" alt="NetBeans 8.2 update center" title="NetBeans 8.2 update center" /></p>
<p><img src="/images/posts/nb9/nb82update2.png" alt="NetBeans 8.2 update center" title="NetBeans 8.2 update center" /></p>
<p>Third, search for new plugins with the keyword &quot;Kit&quot;, as the name suggests, <strong>these are plugins collections for specific purposes</strong></p>
<p><img src="/images/posts/nb9/nb82update3.png" alt="NetBeans 8.2 update center" title="NetBeans 8.2 update center" /></p>
<p>From experience I do recommend the following plugins:</p>
<ul>
<li>HTML5 Kit</li>
<li>JSF</li>
<li>SOAP Web Services</li>
<li>EJB and EAR</li>
<li>RESTful Web Services</li>
<li>Java EE Base</li>
</ul>
<p>Restart the IDE and you're ready to develop apps with Java EE :).</p>
<h2>Test 1: Wildfly 13</h2>
<p>To test NetBeans setup, I added a new application server and ran a recent Java EE 8 REST-CRUD application, <a href="https://github.com/comunidad-hispana-jugs/workshop-03-JEE8_-_JSE10/blob/master/JEE_8/README.md">from recent jEspañol presentation</a> (in Spanish).</p>
<p>You have to select WildFly Application Server</p>
<p><img src="/images/posts/nb9/wf1.png" alt="WildFly 13" title="WildFly 13" /></p>
<p>As <a href="http://wildfly.org/news/2018/05/30/WildFly13-Final-Released/">WildFly release notes</a> suggests if you wanna Java EE 8 support, you should choose <code>standalone-ee8.xml</code> as domain configuration.<br />
<img src="/images/posts/nb9/wf2.png" alt="WildFly 13" title="WildFly 13" /></p>
<p>Domain configuration will be detected by NetBeans 9</p>
<p><img src="/images/posts/nb9/wf3.png" alt="WildFly 13" title="WildFly 13" /></p>
<p>WildFly team has been working on Java 9 and 10 compatibility, hence application ran as expected delivering new records from in-memory database.</p>
<p><img src="/images/posts/nb9/wf4.png" alt="WildFly 13" title="WildFly 13" /></p>
<h2>Test 2: Glassfish 5 and Payara 5 on Java 10 (NetBeans) and Java 8 (App server platform)</h2>
<p>To test vanilla experience, I tried to connect Payara and Glassfish 5 app server, as in the case of WildFly, configuration is pretty straight forward:</p>
<p>You have to select Payara Application Server<br />
<img src="/images/posts/nb9/py1.png" alt="Payara 5" title="Payara 5" /></p>
<p>Domain 1 default configuration should be ok<br />
<img src="/images/posts/nb9/py2.png" alt="Payara 5" title="Payara 5" /></p>
<p>Since Payara and Glassfish only support Java 8 (<a href="https://blog.payara.fish/payara-server-and-payara-micro-in-2018">Java 11 support is on the roadmap</a>) you have to create a new platform with Java 8. Go to <code>Tools -&gt; Java Platforms</code> and click on <code>Add Platform</code><br />
<img src="/images/posts/nb9/py3.png" alt="Payara 5" title="Payara 5" /></p>
<p>Select a new Java SE Platform</p>
<p><img src="/images/posts/nb9/py4.png" alt="Payara 5" title="Payara 5" /></p>
<p>Pick the home directory for Java 8</p>
<p><img src="/images/posts/nb9/py6.png" alt="Payara 5" title="Payara 5" /></p>
<p>Finally, go to server properties and change Java Platform<br />
<img src="/images/posts/nb9/py7.png" alt="Payara 5" title="Payara 5" /></p>
<p>At this time, it seem that NetBeans should be running on Java 8 too, otherwhise you won't be able to retrieve server's configuration and logs, <a href="https://marketplace.eclipse.org/comment/4948#comment-4948">there is a similar report on Eclipse Plugin</a>.</p>
<p><img src="/images/posts/nb9/py8.png" alt="Payara 5" title="Payara 5" /></p>
<h2>Test 3: Glassfish 5 and Payara 5 on Java 8 (NetBeans) and Java 8 (App server platform)</h2>
<p>Finally, I configured NetBeans to use JDK 8 as NetBeans JDK, for this, you sould edit <code>etc/netbeans.conf</code> file and point the <code>netbeans_jdkhome</code> variable to JDK 8, since I'm using jenv to manage JVM environments the right value is <code>netbeans_jdkhome=&quot;/Users/tuxtor/.jenv/versions/1.8&quot;</code></p>
<p>With this NetBeans 9 is able to run Payara 5 and Glassfish 5 as expected:</p>
<p><img src="/images/posts/nb9/py9.png" alt="Payara 5" title="Payara 5" /></p>
<p>I'm Still not sure about TomEE, OpenLiberty, WebSphere and WebLogic, but it seems like it would be a matter of hacking a litle bit on JDK versions.</p>
<p>Long live to NetBeans and Jakarta EE!</p>
</p>
        <a href="../blog/2018/2018-06-18-javaee7-javaee8-backward-compatibility.html"><h1>Testing JavaEE backward and forward compatibility with Servlet, JAX-RS, Batch and Eclipse MicroProfile</h1></a>
        <p>18 June 2018</p>
        <p><p>One of the most interesting concepts that made Java EE (and Java) appealing for the enterprise is its <strong>great backward compatibility</strong>, ensuring that years of investment in R&amp;D could be reused in future developments.</p>
<p>Neverthless one of the least understood facts is that <strong>Java EE in the end is a set of curated APIs that could be extendend and improved</strong> with additional EE-based APIs -e.g Eclipse MicroProfile, DeltaSpike- and vendor-specific improvements -e.g. Hazelcast on Payara, Infinispan on Wildfly-.</p>
<p>In this article I'll try to elaborate a reponse for a recent question in my development team:</p>
<blockquote>
<p>Is it possible to implement a new artifact that uses MicroProfile API within Java EE 7? May I use this artifact also in a Java EE 8 Server?</p>
</blockquote>
<p>To answer this question, I prepared a <strong>POC to demonstrate Java EE capabilities</strong>.</p>
<h2>Is Java EE backward compatible? Is it safe to assume a clean migration from EE 7 to EE 8?</h2>
<p>One of the most pervasive rules in IT is &quot;if ain't broke, don't fix it&quot;, however the <strong>broke is pretty relative in regards of security, bugs and features</strong>.</p>
<p>Commonly, <strong>security vunlerabilities and regular bugs are patched through vendor specific updates in Java EE</strong>, retaining the feature compatibility through EE API level, hence this kind of updates are considered safer and should be applied proactively.</p>
<p>However, once a new EE versión is on the streets, <strong>each vendor publish it's product calendar</strong>, being responsable of the future updates and it's expected that any Java EE user will update his stack (or perish :) ).</p>
<p>In this line Java EE has a complete set of <a href="https://javaee.github.io/javaee-spec/CompatibilityRequirements">requrimentes and backward compatibility instructions, for vendors, spec leads and contributors</a>, this is specially important considering that we receive on every version of Java EE:</p>
<ul>
<li>New APIs (like Batch in EE 7 or JSON-B in EE 8)</li>
<li>APIs that simply don't change and are included in the next EE versión (like Batch in EE 8)</li>
<li>APIs with minor updates (Bean Validation in EE 8)</li>
<li>APIS with new features and interfaces (reactive client in JAX-RS EE 8)</li>
</ul>
<p>According to compatibility requirements, if your code retains and implements only EE standard code you receive source-code compatibility, binary compatibility and behaviour compatibility for any application that uses a previous version of the specificiation, at least that's the idea.</p>
<h2>Creating a &quot;complex&quot; implementation</h2>
<p>To test this assumption I've prepared a POC that implements</p>
<ul>
<li>Servlets (updated in EE 8)</li>
<li>JAX-RS (updated in EE 8)</li>
<li>JPA (minor update in EE 8)</li>
<li>Batch (does not change in EE 8)</li>
<li>MicroProfile Config (extension)</li>
<li>DeltaSpike Data (extension)</li>
</ul>
<p><img src="/images/posts/batch/batchee-diagram.png" alt="Batch Structure" title="Components Structure" /></p>
<p>This application just <strong>loads a bunch of IMDB records <a href="https://raw.githubusercontent.com/KarthikMaharajan/Data-Mining-on-IMDB-Dataset/master/imdb.csv">from a csv file</a> in background to save the records in Derby(Payara 4) and H2(Payara 5)</strong> using the <code>jdbc/__default</code> JTA Datasource.</p>
<p>For referece, the complete Maven project of this POC is available <a href="https://github.com/tuxtor/batchee-demo">at GitHub</a>.</p>
<h3>Part 1: File upload</h3>
<p>The POC a) implements a multipart servlet that receives files from a plain HTML form,  b) saves the file using MicroProfile config to retreive the final destination URL and  c) Calls a Batch Job named <code>csvJob</code>:</p>
<pre><code class="language-prettyprint">@WebServlet(name = &quot;FileUploadServlet&quot;, urlPatterns = &quot;/upload&quot;)
@MultipartConfig
public class FileUploadServlet extends HttpServlet {
    @Inject
    @ConfigProperty(name = &quot;file.destination&quot;, defaultValue = &quot;/tmp/&quot;)
    private String destinationPath;

    @Inject
    private Logger logger;

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String description = request.getParameter(&quot;description&quot;);
        Part filePart = request.getPart(&quot;file&quot;);
        String fileName = Paths.get(filePart.getSubmittedFileName()).getFileName().toString();


        //Save using buffered streams to avoid memory consumption
        try(InputStream fin = new BufferedInputStream(filePart.getInputStream());
                OutputStream fout = new BufferedOutputStream(new FileOutputStream(destinationPath.concat(fileName)))){

            byte[] buffer = new byte[1024*100];//100kb per chunk
            int lengthRead;
            while ((lengthRead = fin.read(buffer)) &gt; 0) {
                fout.write(buffer,0,lengthRead);
                fout.flush();
            }

            response.getWriter().write(&quot;File written: &quot; + fileName);

            //Fire batch Job after file upload
            JobOperator jobOperator = BatchRuntime.getJobOperator();
            Properties props = new Properties();
            props.setProperty(&quot;csvFileName&quot;, destinationPath.concat(fileName));
            response.getWriter().write(&quot;Batch job &quot; + jobOperator.start(&quot;csvJob&quot;, props));
            logger.log(Level.WARNING, &quot;Firing csv bulk load job - &quot; + description );

        }catch (IOException ex){
            logger.log(Level.SEVERE, ex.toString());

            response.getWriter().write(&quot;The error&quot;);
            response.sendError(HttpServletResponse.SC_BAD_REQUEST);
        }


    }

}
</code></pre>
<p>You also need a plain HTML form</p>
<pre><code class="language-prettyprint">&lt;h1&gt;CSV Batchee Demo&lt;/h1&gt;
&lt;form action=&quot;upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;description&quot;&gt;Description&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;description&quot; name=&quot;description&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;file&quot;&gt;File&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;/&gt;
    &lt;/div&gt;

    &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<h3>Part 2: Batch Job, JTA and JPA</h3>
<p><a href="https://javaee.github.io/tutorial/batch-processing.html">As described in Java EE tutorial</a>, typical batch Jobs are composed by steps, these steps also implement a three phase process involving a reader, processor and writer that works by chunks.</p>
<p>Batch Job is defined by using a XML file located in <code>resources/META-INF/batch-jobs/csvJob.xml</code>, the reader-writer-processor triad will be implemented through named CDI beans.</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;job id=&quot;csvJob&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/jobXML_1_0.xsd&quot;
    version=&quot;1.0&quot;&gt;
    
    &lt;step id=&quot;loadAndSave&quot; &gt;
        &lt;chunk item-count=&quot;5&quot;&gt;
            &lt;reader ref=&quot;movieItemReader&quot;/&gt;
            &lt;processor ref=&quot;movieItemProcessor&quot;/&gt;
            &lt;writer ref=&quot;movieItemWriter&quot;/&gt;
        &lt;/chunk&gt;
    &lt;/step&gt;
&lt;/job&gt;
</code></pre>
<p>MovieItemReader reads the csv file line per line and wraps the result using a <code>Movie</code> object for the next step, note that open, readItem and checkpointInfo methods are overwritten to ensure that the task restarts properly if needed.</p>
<pre><code class="language-prettyprint">@Named
public class MovieItemReader extends AbstractItemReader {

	@Inject
	private JobContext jobContext;

	@Inject
	private Logger logger;

	private FileInputStream is;
	private BufferedReader br;
	private Long recordNumber;

	@Override
	public void open(Serializable prevCheckpointInfo) throws Exception {
		recordNumber = 1L;
		JobOperator jobOperator = BatchRuntime.getJobOperator();
		Properties jobParameters = jobOperator.getParameters(jobContext.getExecutionId());
		String resourceName = (String) jobParameters.get(&quot;csvFileName&quot;);
		is = new FileInputStream(resourceName);
		br = new BufferedReader(new InputStreamReader(is));

		if (prevCheckpointInfo != null)
			recordNumber = (Long) prevCheckpointInfo;
		for (int i = 0; i &lt; recordNumber; i++) { // Skip until recordNumber
			br.readLine();
		}
		logger.log(Level.WARNING, &quot;Reading started on record &quot; + recordNumber);
	}

	@Override
	public Object readItem() throws Exception {

		String line = br.readLine();

		if (line != null) {
			String[] movieValues = line.split(&quot;,&quot;);
			Movie movie = new Movie();
			movie.setName(movieValues[0]);
			movie.setReleaseYear(movieValues[1]);
			
			// Now that we could successfully read, Increment the record number
			recordNumber++;
			return movie;
		}
		return null;
	}

	@Override
	public Serializable checkpointInfo() throws Exception {
	        return recordNumber;
	}
}
</code></pre>
<p>Since this is a POC my &quot;processing&quot; step just converts the movie title to uppercase and pauses the thread a half second on each row:</p>
<pre><code class="language-prettyprint">@Named
public class MovieItemProcessor implements ItemProcessor {

  @Inject
  private JobContext jobContext;

	@Override
  public Object processItem(Object obj) 
          throws Exception {
      Movie inputRecord =
              (Movie) obj;
      
      //&quot;Complex processing&quot;
      inputRecord.setName(inputRecord.getName().toUpperCase());
      Thread.sleep(500);
        
      return inputRecord;
  } 
}
</code></pre>
<p>Finally each chunk is written on MovieItemWriter using a DeltaSpike repository:</p>
<pre><code class="language-prettyprint">@Named
public class MovieItemWriter extends AbstractItemWriter {

	@Inject
    MovieRepository movieService;
	
	@Inject
	Logger logger;

    public void writeItems(List list) throws Exception {
        for (Object obj : list) {
        	logger.log(Level.INFO, &quot;Writing &quot; + obj);
            movieService.save((Movie)obj);
        }
    }
}
</code></pre>
<p>For reference, this is the Movie Object</p>
<pre><code class="language-prettyprint">@Entity
@Table(name=&quot;movie&quot;)
public class Movie implements Serializable {

	@Override
	public String toString() {
		return &quot;Movie [name=&quot; + name + &quot;, releaseYear=&quot; + releaseYear + &quot;]&quot;;
	}

	private static final long serialVersionUID = 1L;

    @Id
    @GeneratedValue(strategy= GenerationType.AUTO)
    @Column(name=&quot;movie_id&quot;)
    private int id;
    
    @Column(name=&quot;name&quot;)
    private String name;
    
    @Column(name=&quot;release_year&quot;)
    private String releaseYear;

    //Getters and setters
</code></pre>
<p>Default datasource is configured on <code>resources/META-INF/persistence.xml</code>, note that I'm using a JTA Data Source:</p>
<pre><code class="language-prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;persistence xmlns=&quot;http://xmlns.jcp.org/xml/ns/persistence&quot;
             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd&quot;
             version=&quot;2.1&quot;&gt;

    &lt;persistence-unit name=&quot;batchee-persistence-unit&quot; transaction-type=&quot;JTA&quot;&gt;
        &lt;description&gt;BatchEE Persistence Unit&lt;/description&gt;
        &lt;jta-data-source&gt;jdbc/__default&lt;/jta-data-source&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
		 &lt;properties&gt;
		      &lt;property name=&quot;javax.persistence.schema-generation.database.action&quot; value=&quot;drop-and-create&quot;/&gt;
		      &lt;property name=&quot;javax.persistence.schema-generation.scripts.action&quot; value=&quot;drop-and-create&quot;/&gt;
		      &lt;property name=&quot;javax.persistence.schema-generation.scripts.create-target&quot; value=&quot;sampleCreate.ddl&quot;/&gt;
		      &lt;property name=&quot;javax.persistence.schema-generation.scripts.drop-target&quot; value=&quot;sampleDrop.ddl&quot;/&gt;
		    &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</code></pre>
<p>To test JSON marshalling throug JAX-RS I also implemented a Movie endpoint with GET method, the repository (AKA DAO) is defined by using DeltaSpike</p>
<pre><code class="language-prettyprint">@Path(&quot;/movies&quot;)
@Produces({ &quot;application/xml&quot;, &quot;application/json&quot; })
@Consumes({ &quot;application/xml&quot;, &quot;application/json&quot; })
public class MovieEndpoint {
	
	@Inject
	MovieRepository movieService;

	@GET
	public List&lt;Movie&gt; listAll(@QueryParam(&quot;start&quot;) final Integer startPosition,
			@QueryParam(&quot;max&quot;) final Integer maxResult) {
		final List&lt;Movie&gt; movies = movieService.findAll();
		return movies;
	}

}
</code></pre>
<p>The repository</p>
<pre><code class="language-prettyprint">@Repository(forEntity = Movie.class)
public abstract class MovieRepository extends AbstractEntityRepository&lt;Movie, Long&gt; {
	
	@Inject
    public EntityManager em;
}

</code></pre>
<h2>Test 1: Java EE 7 server with Java EE 7 pom</h2>
<p>Since the objective is to test real backward (lower EE level than server) and forward (Micprofile and DeltaSpike extensions) compatibility, first I built and deployed this project with the following dependencies on <code>pom.xml</code>, the EE 7 Pom vs EE 7 Server  test is only executed to verify that project works properly:</p>
<pre><code class="language-prettyprint">&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax&lt;/groupId&gt;
            &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;
            &lt;version&gt;7.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.microprofile&lt;/groupId&gt;
            &lt;artifactId&gt;microprofile&lt;/artifactId&gt;
            &lt;version&gt;1.3&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.deltaspike.modules&lt;/groupId&gt;
            &lt;artifactId&gt;deltaspike-data-module-api&lt;/artifactId&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.deltaspike.modules&lt;/groupId&gt;
            &lt;artifactId&gt;deltaspike-data-module-impl&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.deltaspike.core&lt;/groupId&gt;
            &lt;artifactId&gt;deltaspike-core-api&lt;/artifactId&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.deltaspike.core&lt;/groupId&gt;
            &lt;artifactId&gt;deltaspike-core-impl&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.deltaspike.distribution&lt;/groupId&gt;
                &lt;artifactId&gt;distributions-bom&lt;/artifactId&gt;
                &lt;version&gt;${deltaspike.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;build&gt;
        &lt;finalName&gt;batchee-demo&lt;/finalName&gt;
    &lt;/build&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;deltaspike.version&gt;1.8.2&lt;/deltaspike.version&gt;
        &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
    &lt;/properties&gt;
</code></pre>
<p>As expected, the application loads the data properly, here two screenshots taken during batch Job Execution:</p>
<p><img src="/images/posts/batch/payara4a.png" alt="Payara 4 Demo 1" title="Payara 4 Instant 1" /></p>
<p><img src="/images/posts/batch/payara4b.png" alt="Payara 4 Demo 2" title="Payara 4 Instant 2" /></p>
<h2>Test 2: Java EE 8 server with Java EE 7 pom</h2>
<p>To test the real binary compatibility, <strong>the application is deployed without changes on Payara 5 (Java EE 8)</strong>, <a href="https://docs.payara.fish/documentation/payara-micro/h2/h2.html">this Payara release also switches Apache Derby with H2 database</a>.</p>
<p>As expected and according with Java EE compatibility guidelines, the application works flawesly.</p>
<p><img src="/images/posts/batch/payara5a.png" alt="Payara 5 Demo 1" title="Payara 5 Instant 1" /></p>
<p><img src="/images/posts/batch/payara5b.png" alt="Payara 5 Demo 2" title="Payara 5 Instant 2" /></p>
<p>To verify assumptions, this is a query launched through SQuirrel SQL:<br />
<img src="/images/posts/batch/squirel.png" alt="SQuirrel SQL Demo" title="SQuirrel SQL" /></p>
<h2>Test 3: Java EE 8 server with Java EE 8 pom</h2>
<p>Finally to enable new EE APIs, a little bit of tweaking is needed on pom.xml, specifically the JavaEE dependency</p>
<pre><code class="language-prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;javax&lt;/groupId&gt;
    &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;
    &lt;version&gt;8.0&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>Again, the application just works:</p>
<p><img src="/images/posts/batch/payara5ee8.png" alt="Payara 5 Java EE 8" title="Payara 5 Java EE 8 pom" /></p>
<p>This is why standards matters :).</p>
</p>
        <a href="../blog/2018/2018-06-04-getting-started-payara5-javaee8-eclipse.html"><h1>Getting started with Java EE 8, Payara 5 and Eclipse Oxygen</h1></a>
        <p>04 June 2018</p>
        <p><p>Some days ago I had the opportunity/obligation to setup a brand new Linux(Gentoo) development box, hence to make it &quot;enjoyable&quot; <strong>I prepared a back to basics tutorial on how to setup a working environment</strong>.</p>
<h1>Requirements</h1>
<p>In order to setup a complete Java EE development box, you need at least:</p>
<p>1- Working JDK installation and environment<br />
2- IDE/text editor<br />
3- Standalone application server if your focus is &quot;monolithic&quot;</p>
<p>Due personal preferences I choose</p>
<p>1- OpenJDK on Gentoo Linux (Icedtea bin build)<br />
2- Eclipse for Java EE developers<br />
3- Payara 5</p>
<h1>Installing OpenJDK</h1>
<p>Since this is a distribution dependent step, you could follow tutorials on <a href="http://openjdk.java.net/install/">Ubuntu, CentOS, Debian</a> and many more distributions if you need to. At this time, <strong>most application servers have Java 8 as target due new Java-LTS version scheme</strong>, as in the case of Payara.</p>
<p><a href="/images/posts/payara5/00.png" data-lightbox="Gentoo" title="Gentoo" ><br />
<img class="img-fluid" src="/images/posts/payara5/00.png"><br />
</a></p>
<p>For Gentoo Linux you could get a new OpenJDK setup by installing <a href="https://packages.gentoo.org/packages/dev-java/icedtea">dev-java/icedtea</a> for the source code version and <a href="https://packages.gentoo.org/packages/dev-java/icedtea-bin">dev-java/icedtea-bin</a> for the precompiled version.</p>
<pre><code>emerge dev-java/icedtea-bin
</code></pre>
<h2>Is OpenJDK a good choice for my need?</h2>
<p>Currently <a href="https://blogs.oracle.com/java-platform-group/update-and-faq-on-the-java-se-release-cadence">Oracle has plans to free up all enterprise-commercial JDK features</a>. In a near future the differences between OracleJDK and OpenJDK should be zero.</p>
<p>In this line, Red Hat and other big players have been offering OpenJDK as the standard JDK in Linux distributions, <strong>working flawlessly for many enterprise grade applications</strong>.</p>
<h1>Eclipse for Java EE Developers</h1>
<p>After a complete revamp of websites GUI, you could go directly to <a href="https://eclipse.org">eclipse.org</a> website and download Eclipse IDE.</p>
<p>Eclipse offers collections of plugins denominated <em>Packages</em>, <strong>each package is a collection of common plugins aimed for a particular development need</strong>. Hence to simplify the process you could download directly Eclipse IDE for Java EE Developers.</p>
<p><a href="/images/posts/payara5/01.png" data-lightbox="Eclipse" title="Eclipse" ><br />
<img class="img-fluid" src="/images/posts/payara5/01.png"><br />
</a></p>
<p>On Linux, you will download a .tar.gz file, hence you should uncompress it on your preferred directory.</p>
<pre><code>tar xzvf eclipse-jee-oxygen-3a-linux-gtk-x86_64.tar.gz
</code></pre>
<p>Finally, you could execute the IDE by entering the <em>bin</em> directory and launching <code>eclipse</code> binary.</p>
<pre><code>cd eclipse/bin
./eclipse
</code></pre>
<p>The result should be a brand new Eclipse IDE.</p>
<p><a href="/images/posts/payara5/03.png" data-lightbox="image-1" title="Pick font" ><br />
<img class="img-fluid" src="/images/posts/payara5/03.png"><br />
</a></p>
<h1>Payara</h1>
<p>You could grab a fresh copy of Payara by visiting <a href="https://payara.fish">payara.fish</a> website.</p>
<p><a href="/images/posts/payara5/02.png" data-lightbox="Payara" title="Payara" ><br />
<img class="img-fluid" src="/images/posts/payara5/02.png"><br />
</a></p>
<p>From Payara's you will receive a zipfile that again you should uncompress in your preferred directory.</p>
<pre><code>unzip payara-5.181.zip
</code></pre>
<p>Finally, you could add Payara's bin directory to PATH variable in order to use <code>asadmin</code> command from any CLI. You could achieve this by using ~/.bashrc file. For example if you installed Payara at ~/opt/ the complete instruction is:</p>
<pre><code>echo &quot;PATH=$PATH:~/opt/payara5/bin&quot; &gt;&gt; ~/.bashrc
</code></pre>
<h1>Integration between Eclipse and Payara</h1>
<p>After unzipping Payara you are ready to integrate the app server in your Eclipse IDE.</p>
<p>Recently and due Java/Jakarta EE transition, <a href="https://blog.payara.fish/payara-tools-unlocks-eclipse-for-payara-5">Payara Team has prepared a new integration plugin compatible with Payara 5</a>. In the past you would also use Glassfish Developer Tools with Payara, but <strong>this is not possible anymore</strong>.</p>
<p>To install it, simply grab the following button on your Eclipse Window, and follow wizard steps.</p>
<p><a href="http://marketplace.eclipse.org/marketplace-client-intro?mpc_install=4014208" class="drag" title="Drag to your running Eclipse* workspace. *Requires Eclipse Marketplace Client"><img typeof="foaf:Image" class="img-responsive" src="https://marketplace.eclipse.org/sites/all/themes/solstice/public/images/marketplace/btn-install.png" alt="Drag to your running Eclipse* workspace. *Requires Eclipse Marketplace Client" /></a></p>
<p><a href="/images/posts/payara5/w1.png" data-lightbox="pwizard" title="pwizard" ><br />
<img class="img-fluid" src="/images/posts/payara5/w1.png"><br />
</a></p>
<p><a href="/images/posts/payara5/w2.png" data-lightbox="pwizard2" title="pwizard" ><br />
<img class="img-fluid" src="/images/posts/payara5/w2.png"><br />
</a></p>
<p>In the final step you will be required to restart Eclipse, after that you still need to add the application server. <strong>Go to the Servers tab and click create a new server</strong>:</p>
<p><a href="/images/posts/payara5/ns0.png" data-lightbox="ns0" title="ns0" ><br />
<img class="img-fluid" src="/images/posts/payara5/ns0.png"><br />
</a></p>
<p>Select Payara application server:</p>
<p><a href="/images/posts/payara5/ns1.png" data-lightbox="ns1" title="ns1" ><br />
<img class="img-fluid" src="/images/posts/payara5/ns1.png"><br />
</a></p>
<p>Find Payara's install location and JDK location (corresponding to ~/opt/payara5 and /opt/icedtea-bin on my system):</p>
<p><a href="/images/posts/payara5/ns2.png" data-lightbox="ns2" title="ns2" ><br />
<img class="img-fluid" src="/images/posts/payara5/ns2.png"><br />
</a></p>
<p>Configure Payara's domain, user and password.</p>
<p><a href="/images/posts/payara5/ns3.png" data-lightbox="ns3" title="ns3" ><br />
<img class="img-fluid" src="/images/posts/payara5/ns3.png"><br />
</a></p>
<p>In the end, you will have Payara server available for deployment:</p>
<p><a href="/images/posts/payara5/ns4.png" data-lightbox="ns4" title="ns4" ><br />
<img class="img-fluid" src="/images/posts/payara5/ns4.png"><br />
</a></p>
<h1>Test the demo environment</h1>
<p>It's time to give it a try. <strong>We could start a new application with a Java EE 8 archetype</strong>, one of my favorites is Adam Bien's <a href="https://mvnrepository.com/artifact/com.airhacks/javaee8-essentials-archetype">javaee8-essentials-archetype</a>, wich provides you an opinionated essentials setup.</p>
<p>First, create a new project and select a new Maven Project:</p>
<p><a href="/images/posts/payara5/arch0.png" data-lightbox="arch0" title="arch0" ><br />
<img class="img-fluid" src="/images/posts/payara5/arch0.png"><br />
</a></p>
<p>In Maven's window you could search by name any archetype in Maven central, however you should wait a little bit for synchronization between Eclipse and Maven.</p>
<p><a href="/images/posts/payara5/arch1.png" data-lightbox="arch1" title="arch1" ><br />
<img class="img-fluid" src="/images/posts/payara5/arch1.png"><br />
</a></p>
<p>If waiting is not your thing. You could also add the archetype directly:</p>
<p><a href="/images/posts/payara5/arch2.png" data-lightbox="arch2" title="arch2" ><br />
<img class="img-fluid" src="/images/posts/payara5/arch2.png"><br />
</a></p>
<p>This archetype also creates a new JAX-RS application and endpoint, after some minor modifications just deploy it to Payara 5 and see the results:</p>
<p><a href="/images/posts/payara5/arch3.png" data-lightbox="arch3" title="arch3" ><br />
<img class="img-fluid" src="/images/posts/payara5/arch3.png"><br />
</a></p>
<p><a href="/images/posts/payara5/arch4.png" data-lightbox="arch4" title="arch4" ><br />
<img class="img-fluid" src="/images/posts/payara5/arch4.png"><br />
</a></p>
</p>
        <a href="../blog/2018/2018-03-14-Empty-Reports-Jasper-Reports.html"><h1>Fixing missing data on Jasper Reports with community Linux distros</h1></a>
        <p>14 March 2018</p>
        <p><p>. . . or why my report is half empty in Centos 7.</p>
<p>One of the most common and least emotional tasks in any enterprise software is to produce reports. However after many years today I got <strong>my first &quot;serious bug&quot; in Jasper Reports.</strong></p>
<h1>The problem</h1>
<p>My development team is composed by a mix of Ubuntu and Mac OS workstations, hence we could consider that we use user-friendly environments. Between many applications, we have in maintenance mode a not-so small accounting module which produces a considerable amount of reports. This applications is running (most of the times) on Openshift (Red Hat) platforms or on-premise (also Red Hat).</p>
<p>A recent deployment was carried over a headless(pure cli) CentOS 7 fresh install and after deploying application on the app server, all reports presented the following issue:</p>
<p>Good report, Red Hat, Mac Os, Ubuntu<br />
<a href="/images/posts/jasper/goodreport.png" data-lightbox="image-1" title="Good Report" ><br />
<img class="img-fluid" src="/images/posts/jasper/goodreport.png"><br />
</a></p>
<p>Bad report, Centos 7<br />
<a href="/images/posts/jasper/badreport.png" data-lightbox="image-1" title="Bad Report" ><br />
<img class="img-fluid" src="/images/posts/jasper/badreport.png"><br />
</a></p>
<p>At first sight both reports are working and equal, however <strong>in the Centos 7 version, all quantities disappeared</strong> and the only &quot;meaningful&quot; log message related to fonts was:</p>
<blockquote>
<p>[org.springframework.beans.factory.xml.XmlBeanDefinitionReader](default task-1) Loading XML bean definitions from URL [vfs:/content/erp-ear.ear/core-web.war/WEB-INF/lib/DynamicJasper-core-fonts-1.0.jar/fonts<br />
/fonts1334623843090.xml]</p>
</blockquote>
<h1>Fonts in Java</h1>
<p>After many unsuccessful tests like deploying a new application server version, I learnt a little bit about fonts in the Java virtual machine and Jasper Reports.</p>
<p>According to <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/intl/font.html">Oracle official</a> documentation, you basically have four rules while using fonts in Java, being:</p>
<ol>
<li>Java supports only TTF and Postscript type 1 fonts</li>
<li>The only font family included in JDK is Lucida</li>
<li>If not Lucida JDK will depend on operating system fonts</li>
<li>Java applications will fallback to the sans/serif default font if the required font is not present on the system</li>
</ol>
<p>And if you are a Jaspersoft Studio, it makes easy for you to pick Microsoft's True Type fonts</p>
<p><a href="/images/posts/jasper/pickfont.png" data-lightbox="image-1" title="Pick font" ><br />
<img class="img-fluid" src="/images/posts/jasper/pickfont.png"><br />
</a></p>
<h1>My CentOS 7 solution</h1>
<p>Of course Jasper Reports has <a href="https://community.jaspersoft.com/wiki/custom-font-font-extension">support for embedding fonts</a>, however report's font was not Lato, Roboto or Sage, <strong>it was the omnipresent Verdana</strong> part of the <a href="https://en.wikipedia.org/wiki/Core_fonts_for_the_Web">&quot;Core fonts for the web&quot;</a> from Microsoft, not included in most Unix variant <a href="https://blogs.oracle.com/solaris/truetype-fonts-v2">due license restrictions</a>.</p>
<p>Let's assume that nowadays MS Core Fonts are a gray area and you are actually able to install these by using repackaged versions, like mscorefonts2 at sourceforge.</p>
<p>In CentOS is easy as 1) install dependencies,</p>
<pre><code>yum install curl cabextract xorg-x11-font-utils fontconfig
</code></pre>
<p>2) download the <a href="http://mscorefonts2.sourceforge.net/">repackaged fonts</a></p>
<pre><code>wget https://downloads.sourceforge.net/project/mscorefonts2/rpms/msttcore-fonts-2.1-1.noarch.rpm
</code></pre>
<p>3) and install the already available rpm file</p>
<pre><code>yum install msttcore-fonts-2.1-1.noarch.rpm
</code></pre>
<p>With this, all reports were fixed. I really hope that you were able to found this post before trying anything else.</p>
</p>
        <a href="../blog/2017/2017-12-30-2017-My-Java-Year.html"><h1>2017 My Java Community Year</h1></a>
        <p>30 December 2017</p>
        <p><p>Yup it's the time of the year when everybody writes about yearly adventures.</p>
<p>This year was one of the best for my <a href="https://en.wikipedia.org/wiki/Wanderlust">wanderlust</a> spirit, basically due opportunities that I received as member of the global Java community, hence I wanna do a little recap of my Java year in my academic and professional journey, so far Java has been the strongest community I've ever participated. This is probably the year where I made most Java-related friends.</p>
<p>As always Java community is awesome and <strong>I wanna start this post saying thank you</strong> to all the people that made this possible, I really hope that my presentations, tutorials and workshops were at least at the same level of your expectations, I'm always trying to improve the quality and any feedback is more than welcome.</p>
<p>Let's start with the highlights recap . . .</p>
<h2>January</h2>
<p>January was an interesting month, <strong>my first MOOC collaboration -<a href="https://www.repelisplus.com/v/la-liga-de-la-justicia-a/">Java Fundamentals for Android Development</a>- was published in partnership with Galileo University</strong>. Hence I became an official <a href="https://www.edx.org/bio/victor-orozco">Edx instructor</a>, with Edx profile and everything.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/W3KU6yuWNqU" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
<p>I really think that course quality could be improved, however feedback was better than I expected. I hope to collaborate in another MOOC in the near future, the simple act to prepare a course in a foreign language for an Edx Micromaster was a truly learning experience that I wanna repeat.</p>
<p>Finally, <a href="https://www.edx.org/course/java-fundamentals-android-development-galileox-caad001x-2">MOOC will run again this year</a>, motivated by good reception . . . I guess/hope :).</p>
<h2>February</h2>
<p>In February <strong>I discovered my second favorite Java conference</strong>. After being accepted I traveled to Atlanta to speak at <a href="http://devnexus.com">DevNexus</a>.</p>
<p>With the same quality of Java One speakers but in a more &quot;friendly&quot; atmosphere, DevNexus has a good balance between, speakers, price and quality, I had the opportunity to do a conference on Functional Programming and Functional Java libraries.</p>
<p>I did an interview with night hacking :).</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wuYNTFx8yIY" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
<p>I also met Coca Cola bear at World of Coca Cola, life achievement unlocked.</p>
<p><a href="/images/posts/2017recap/cocacola.jpg" data-lightbox="image-1" title="Coca Cola" ><br />
<img src="/images/posts/2017recap/cocacola.jpg" style="width: 500px;"><br />
</a></p>
<p>Finally <a href="http://devnexus.com/speakers/771">I'll be speaking again in 2018</a>, hope to see you there.</p>
<h2>March</h2>
<p><a href="http://payara.fish"><br />
<img src="/images/posts/payara/payara.png" style="width: 500px;"><br />
</a></p>
<p>Not a conference but my company -<a href="http://nabenik.com">Nabenik</a>- became a <a href="http://payara.fish">Payara</a> reseller and we helped one unit of &quot;Ministerio Publico&quot; (aka Guatemalan FBI) in the migration process from Glassfish to Payara.</p>
<p>This was a combination between training, analysis and of course partnership. Cheers to everyone involved in the process :).</p>
<p>I also repeated my DevNexus presentation for Peru JUG friends (in spanish).</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/2LQPg2rLGxs" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
<h2>April</h2>
<p>After being invited by <a href="https://twitter.com/edivargas">Jorge Vargas</a>, I joined <a href="http://www.jespanol.org/">JEspañol</a> as speaker and collaborator. In short words, <strong>JEspañol aims to work as the integration point between Java Community in spanish</strong> speaking countries, also as the first spanish Virtual JUG.</p>
<p>This year we created a two-leg conference. Being the first leg the &quot;Primera conferencia virtual JEspañol&quot;. With speakers from Guatemala, Mexico, Peru, Colombia and Panama.</p>
<p><a href="/images/posts/2017recap/confjespanol.jpg" data-lightbox="image-1" title="JEspañol" ><br />
<img src="/images/posts/2017recap/confjespanol.jpg" style="width: 500px;"><br />
</a></p>
<h2>May</h2>
<p>In a collaboration with other company we trained one unit of the &quot;<a href="https://www.dgi.gob.ni/">Nicaraguan Tax administration</a>&quot;, my collaboration was focused on <strong>secure software development for JavaEE and Android</strong>.</p>
<p>A pretty good experience since this was my third visit to Nicaragua.</p>
<h2>June</h2>
<p>Taking advantage from Nicaraguan trip <strong>I did a joint presentation with <a href="https://www.meetup.com/gdgmanagua/">Managua Google Developers Group</a></strong>, talking about Java Community, Duke's Choice Award, Consultancy and many Java related technologies. Sharing pizza, beer and of course code.</p>
<p>I also had the opportunity to say hi to old friends from free software community, remembering the good old times of unix hacktivism.</p>
<div class="fotorama">
<img src="http://www.guate-jug.net/duke-adventures/img/posts/tour-managua/man1.jpg" >
<img src="http://www.guate-jug.net/duke-adventures/img/posts/tour-managua/man2.jpg" >
</div>
<h2>July</h2>
<p>Busy month, not too much hacktivism :).</p>
<h2>August</h2>
<p>The second leg of the &quot;JEspañol conference&quot; was carried-on being named &quot;<a href="https://www.certificatic.org/CloudDay/index.html">Java Cloud Day Mexico</a>&quot;. <strong>One of my favorite trips of the year since it took place on the historical &quot;Universidad Nacional Autonoma de Mexico&quot;</strong>.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z00gKGm3czg" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
<p>With 15 speakers this was my biggest spanish-speaking conference. On the near future we have the intention to take the JEspañol conference to other LATAM countries.</p>
<div class="fotorama">
    <img src="/images/posts/javacloud17/1.jpg">
    <img src="/images/posts/javacloud17/2.jpg">
    <img src="/images/posts/javacloud17/3.jpg">
    <img src="/images/posts/javacloud17/4.jpg">
    <img src="/images/posts/javacloud17/speakers.png">
</div>
<p>In this opportunity I did a presentation on functional microservices with Payara Micro.</p>
<iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2FCertificaTIC%2Fvideos%2F1794751094098879%2F&show_text=1&width=560" width="560" height="401" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allowFullScreen="true"></iframe>
<p>Finally we closed this event with peers from Oracle Developers LA.</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">About last week. After great talks of modern development at Java Cloud Day México, enjoying a deserved dinner with some of speakers. <a href="https://t.co/gWVqEWTHOc">pic.twitter.com/gWVqEWTHOc</a></p>&mdash; Oracle Developer LA (@OracleDevsLA) <a href="https://twitter.com/OracleDevsLA/status/905575697770577922?ref_src=twsrc%5Etfw">September 6, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>I also got a ticket for <a href="https://www.wacken.com/">Wacken Open Air</a>, not Java but still amazing :).</p>
<div class="fotorama">
    <img src="/images/posts/2017recap/wacken1.jpg">
    <img src="/images/posts/2017recap/wacken2.jpg">
</div>
<h2>September</h2>
<p><strong>I did a joint presentation with Edson Yanaga at Java One 2017</strong>, with full room (mostly Yanaga's merit I must say) we discussed the issues of distributed data with microservices and some technology to attain better data distribution, microservices patterns and some tips and tricks.</p>
<div class="fotorama">
<img src="/images/posts/2017recap/j12017.jpg" >
<img src="/images/posts/2017recap/j120172.jpg" >
<img src="/images/posts/2017recap/j220173.jpg" >
</div>
<p>Not my best presentation, but anyways <a href="https://www.phillip-kruger.com/post/live_for_the_code/">feedback is appreciated</a>.</p>
<p>JEspañol got a Duke's Choice Award :).</p>
<p><a href="https://community.oracle.com/servlet/JiveServlet/downloadImage/102-1018302-6-434208/1348-899/DSC00342.JPG" data-lightbox="image-1" title="JEspañol" ><br />
<img src="https://community.oracle.com/servlet/JiveServlet/downloadImage/102-1018302-6-434208/1348-899/DSC00342.JPG" style="width: 500px;"><br />
</a></p>
<h2>October</h2>
<p><strong>I received an invitation from peruvian <a href="http://www.upao.edu.pe/">Universidad Privada Antenor Orrego</a></strong> to participate in their Engineering Congress . . . yup in Latam Software Development is considered Engineering.</p>
<p>This was my first time in South America since 2014, the emotion for the travel was pretty obvious. I had the opportunity to do three presentations, being:</p>
<ul>
<li>Getting started with Java community and development career</li>
<li>The state of the art with JavaEE</li>
<li>Creating functional microservices with Payara Micro</li>
</ul>
<p>I also did a little trip to <a href="https://en.wikipedia.org/wiki/Chan_Chan">Chan Chan ruins</a>, a UNESCO-Protected Site, mochicas where a non-Inca culture dominated by the Incas that I didn't know about.</p>
<div class="fotorama">
<img src="/images/posts/2017recap/peru1.jpg" >
<img src="/images/posts/2017recap/peru2.jpg" >
<img src="/images/posts/2017recap/peru3.jpg" >
<img src="/images/posts/2017recap/peru4.jpg" >
</div>
<p>On trip's last day I had a long layover on Lima, hence I met with <a href="https://twitter.com/jamdiazdiaz">Jose Diaz</a> one of the PeruJUG Leaders to do a joint presentation in &quot;Universidad Nacional Mayor de San Marcos&quot; the oldest University in Latin America. Presenting in their systems engineering congress.</p>
<p>We did a panel about microservices on JavaEE vs Spring Boot.</p>
<p><a href="/images/posts/2017recap/peru5.jpg" data-lightbox="image-1" title="JEspañol" ><br />
<img src="/images/posts/2017recap/peru5.jpg" style="width: 500px;"><br />
</a></p>
<h2>November</h2>
<p>After six years <strong>I returned to my &quot;alma mater&quot; to do a presentation on &quot;Getting started with Java 8 and Java EE&quot;</strong> for the &quot;Guatemalan systems and computer science students congress&quot;. I felt like being at home.</p>
<p><a href="/images/posts/2017recap/coecys.jpg" data-lightbox="image-1" title="Coecys" ><br />
<img src="/images/posts/2017recap/coecys.jpg" style="width: 500px;"><br />
</a></p>
<p>I also took the opportunity to <strong>officially launch the partnership with CertificaTIC to introduce Oracle Workforce Development program at Guatemala</strong>. The program aims to train with official material but with a fraction of the cost the new generation of Java Architects in Guatemala.</p>
<p>Tip: We'll start classes on January, do not miss the opportunity :).</p>
<p><a href="/images/posts/2017recap/certifica.jpg" data-lightbox="image-1" title="CertificaTIC" ><br />
<img src="/images/posts/2017recap/certifica.jpg" style="width: 500px;"><br />
</a></p>
<p>Finally I was an organizer, committee, waterboy, etc. on the <a href="http://www.guate-jug.net/javaday2017/">Java Day Guatemala 2017</a>, surprisingly this has been the best edition in attendance. Being a conference organizer is a huge amount of work. I know the huge space to make this conference better and I'm working on it.</p>
<div class="fotorama">
<img src="/images/posts/2017recap/jday1.jpg" >
<img src="/images/posts/2017recap/jday2.jpg" >
<img src="/images/posts/2017recap/jday3.jpg" >
</div>
<h2>December</h2>
<p>December is probably the busiest month for any software contractor since it's the month when everyone goes on vacations and you have wider &quot;maintenance windows&quot; to update, replace and implement software systems.</p>
<p>However <strong>I took a day to do a presentation with <a href="https://www.youtube.com/user/MitoCode">MitoCode</a></strong>, one of the famous Java youtubers in Latin America. My presentation was focused on the state of the art in JavaEE and Microprofile.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/BNn7yGif56c" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
<p>I also got the opportunity to wrote a JavaEE article for my &quot;alma mater&quot; software magazine, the <a href="http://tuxtor.shekalug.org/el-estado-del-arte-de-java-ee-java-ee-7-java-ee-8-y-ee4j/">pre-print is available on my spanish blog</a>.</p>
<p>Again thanks to God, friends, family and everyone who made this possible.</p>
</p>
        <a href="../blog/2017/2017-09-28-Install-Java-9-Fedora-26.html"><h1>[Quicktip] How to install Oracle Java 9 on Fedora 26</h1></a>
        <p>28 September 2017</p>
        <p><p><a href="/images/posts/java9fedora26/duke9.png" data-lightbox="image-1" title="Java 9" ><br />
<img src="/images/posts/java9fedora26/duke9.png"><br />
</a></p>
<p>Yey! It's time to celebrate the general availability of Java 9.</p>
<p>Since I'm <strong>the guy in charge of breaking the things before everyone else in the company</strong>, I've been experimenting with JDK 9 and Fedora 26 Workstation, hence this quick guide about installing Oracle JDK 9 using the &quot;Fedora Way&quot;.</p>
<h1>Getting the JDK</h1>
<p>As always when a JDK reaches general availability, you could <strong>download a Java Developer Kit from Oracle website</strong>.</p>
<p>Here <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p>
<p>Conveniently <strong>Oracle offers a .rpm package</strong> that it's supposed to work with any &quot;Hat&quot; distribution. This guide is focused on that installer.</p>
<h1>Installing the new JDK</h1>
<p>After downloading the rpm, <strong>you could install it as any other rpm</strong>, at the time of writing this tutorial, the rpm didn't required any other dependency (or any dependency not available in Fedora)</p>
<pre><code>sudo rpm -ivh jdk-9_linux-x64_bin.rpm
</code></pre>
<p>This command was executed as super user.</p>
<h1>Configuring the JDK</h1>
<p>&quot;Hat&quot; distributions come with a handy tool called <a href="https://fedoraproject.org/wiki/Packaging:Alternatives">alternatives</a>, as the name suggests it handles the alternatives for the system, in this case the default JVM and compiler.</p>
<p>First, set the alternative for the <code>java</code> command</p>
<pre><code>sudo alternatives config --java
</code></pre>
<p>It will list the &quot;Red Hat packaged&quot; JVM's installed on the system, <strong>for instance this is the output in my system (Oracle JDK 8, Oracle JDK 9, OpenJDK 8)</strong>:</p>
<p><a href="/images/posts/java9fedora26/alternativesjvm.png" data-lightbox="image-1" title="Java Alternatives" ><br />
<img src="/images/posts/java9fedora26/alternativesjvm.png"><br />
</a></p>
<p>Later, you should also pick a compiler alternative</p>
<pre><code>sudo alternatives config --javac
</code></pre>
<h1>Configuring JShell REPL</h1>
<p>JShell is one of the coolest features in Java 9, <strong>being the first official REPL to be included</strong>. However and since it's the first time that the binary is available in the system, it cannot be selected as alternative unless you create it manually.</p>
<p>First, locate the JDK install directory, Oracle JDK is regularly located at <code>/usr/java</code>, being in my system.</p>
<p><a href="/images/posts/java9fedora26/jdklist.png" data-lightbox="image-1" title="JDK List" ><br />
<img src="/images/posts/java9fedora26/jdklist.png"><br />
</a></p>
<p>As any other JVM binary program, JShell will be located at <code>bin</code> directory, hence to create an alternative (and consequently to be prepared for other Java 9 options . . . and to include the executable in the path):</p>
<pre><code>sudo alternatives --install /usr/bin/jshell jshell /usr/java/jdk-9/bin/jshell
</code></pre>
<p>From now on you could use jshell on any regular shell, just <strong>see my first Java-9 hello world, it looks beautiful :-)</strong>.</p>
<p><a href="/images/posts/java9fedora26/hello9.png" data-lightbox="image-1" title="Java 9 Hello World" ><br />
<img src="/images/posts/java9fedora26/hello9.png"><br />
</a></p>
</p>
        <a href="../blog/2017/2017-09-04-Java-Cloud-Day-M%C3%A9xico-2017.html"><h1>Java Cloud Day México 2017 trip report</h1></a>
        <p>04 September 2017</p>
        <p><p>I'm not accustomed to do &quot;trip reports&quot; of conferences, but I think this conference deserves the report.</p>
<p>Java Cloud Day 2017 was the <strong>result of a dream from the JEspañol community</strong>, a simple one in phrase but very difficult to achieve &quot;unite Java Leaders from Spanish speaking countries in Latin America&quot;, dream that started three years ago. Although I'm not one of the &quot;original members&quot;, last year I joined the effort after some pub-discussions in Java One.</p>
<p>Honor to whom honor is owed, one of the <strong>key sponsors who made this possible was <a href="https://twitter.com/certificatic?lang=en">CertificaTIC</a></strong>, a mexican Java-Oracle certification services provider who believed in the project and put a lot of resources for the event. Adrian, Mirza and the whole team . . . you rock!</p>
<h1>The previous virtual conference</h1>
<p>The event as a whole was carried as two conferences. The first leg called <strong><a href="https://www.facebook.com/pg/EventosJEspanol/">&quot;conferencia virtual JEspañol&quot;</a> with VirtualJUG-Like conferences but in Spanish</strong> with speakers from Guatemala, Mexico, Panama, Peru and Colombia, being the first of its kind.</p>
<h1>Java Cloud Day Mexico 2017</h1>
<p>And the day finally came . . .</p>
<p>Celebrated in conjunction with the 40th anniversary of the computer science program in the mythical <a href="http://computacion.ingenieria.unam.mx/">Universidad Nacional Autonoma de México (UNAM)</a>, <strong>the event was a huge success</strong>.</p>
<p>With talks from Java Champions, Oracle Developer Champions, Oracle ACE, JUG Leaders, Oracle Technology Network and &quot;Javatars&quot;, this is the biggest IT Spanish-speaking event I've ever attended, <strong>raising the bar for all of us in our next events.</strong></p>
<p>Kudos, bitcoins, stamina, japanese ki and whatever is valuable for all participants and speakers. Events like these are my favorite since (and taking a famous phrase from DevNexus) this was an <strong>event from developers, by developers for developers</strong>.</p>
<h1>The pictures</h1>
<p>Some selected pictures from the event, dinner, and Teotihuacan.</p>
<div class="fotorama">
    <img src="https://vorozco.com/images/posts/javacloud17/1.jpg">
    <img src="https://vorozco.com/images/posts/javacloud17/2.jpg">
    <img src="https://vorozco.com/images/posts/javacloud17/3.jpg">
    <img src="https://vorozco.com/images/posts/javacloud17/4.jpg">
    <img src="https://vorozco.com/images/posts/javacloud17/speakers.png">
</div>
<h1>My presentation</h1>
<p>I presented some tip and tricks for the creation of Microservices with Payara Application Server, the presentation starts at minute ~45</p>
<iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2FCertificaTIC%2Fvideos%2F1794751094098879%2F&show_text=1&width=560" width="560" height="401" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allowFullScreen="true"></iframe>
<p>See you in the next conference . . . or tour, who knows :)?</p>
</p>
        <a href="../blog/2017/2017-08-25-Payara41-Quick-Install-CentoOS-7.html"><h1>Payara 4.1 install guide on CentOS 7</h1></a>
        <p>25 August 2017</p>
        <p><p><a href="/images/posts/payara/payara.png" data-lightbox="image-1" title="Payara" ><br />
<img src="/images/posts/payara/payara.png"><br />
</a></p>
<p>In this &quot;back to basics tutorial&quot; I'll try to explain <strong>how to install properly Payara 4.1 on Centos 7</strong> (it should be fine for Red Hat, Oracle Unbreakable Linux and other *hat distributions).</p>
<p>Why not Docker, Ansible, Chef, Puppet, . . .?. Sometimes the best solution is the easiest :).</p>
<h1>Pre-requisites</h1>
<p>The only software requirement to run Payara is to <strong>have a JDK installed</strong>. CentOS offers a custom OpenJDK build called <a href="https://centos.pkgs.org/7/centos-x86_64/java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64.rpm.html">&quot;headless&quot;</a> that doesn't offer support for audio and video, perfect for cli environments.</p>
<p>You can install it with Yum.</p>
<pre><code>yum install java-1.8.0-openjdk-headless
</code></pre>
<h1>Create a Payara user</h1>
<p>As mentioned in the official <a href="https://javaee.github.io/glassfish/documentation">Glassfish documentation</a>, it is convenient to <strong>run your application server in a dedicated user</strong> for security and administrative reasons.</p>
<pre><code>adduser payara
</code></pre>
<p>Although you could be tempted to create a no-login, no-shell user, Payara saves many preferences in user's home directory and <strong>the shell/login is actually needed to execute administrative commands like <code>asadmin</code></strong>.</p>
<h1>Download and unzip Payara</h1>
<p>Payara is hosted at Amazon S3, please double check this link on <a href="https://www.payara.fish/">Payara's website</a>, for this guide I'm installing Payara at server's <code>/opt</code> directory.</p>
<pre><code>cd /opt
wget https://s3-eu-west-1.amazonaws.com/payara.fish/Payara+Downloads/Payara+4.1.2.173/payara-4.1.2.173.zip
unzip payara-4.1.2.173.zip
</code></pre>
<p>You should execute the above commands as super-user, after that <strong>you should change permissions for the Payara directory before any domain start</strong>. Otherwise you won't be able to use the server with <code>payara</code> user</p>
<pre><code>chown -R payara:payara payara41
</code></pre>
<h1>systemd unit</h1>
<p>Centos 7 uses systemd as init system, consequently it is possible and actually quite easy to create a <strong>systemd unit to start, stop and restart Payara default domain</strong><br />
.<br />
First, create a file that represents Payara systemd unit.</p>
<pre><code>/etc/systemd/system/payara.service
</code></pre>
<p>And add the following content:</p>
<pre><code>[Unit]
Description = Payara Server v4.1
After = syslog.target network.target

[Service]
User=payara
ExecStart = /usr/bin/java -jar /opt/payara41/glassfish/lib/client/appserver-cli.jar start-domain
ExecStop = /usr/bin/java -jar /opt/payara41/glassfish/lib/client/appserver-cli.jar stop-domain
ExecReload = /usr/bin/java -jar /opt/payara41/glassfish/lib/client/appserver-cli.jar restart-domain
Type = forking

[Install]
WantedBy = multi-user.target
</code></pre>
<p>Note that Payara administration is achieved with <code>payara</code> user. You could personalize it to fit your needs.</p>
<p>Optionally you could enable the service to start with the server and/or after server reboots.</p>
<pre><code>systemctl enable payara
</code></pre>
<p>Check if all is working properly with the systemd standard commands</p>
<pre><code>systemctl start payara
systemctl restart payara
systemctl stop payara
</code></pre>
<h1>Payara user PATH</h1>
<p>As Payara and Glassfish users already know, <strong>most administrative tasks in Payara application server are achieved by using cli commands</strong> like <code>asadmin</code>. Hence it is convenient to have all tools available in our administrative <code>payara</code> user.</p>
<p>First log-in as Payara user, if you didn't assign a password for the user you could switch to this user using <code>su</code> as root user.</p>
<pre><code>su payara
</code></pre>
<p>Later you shoud create or edit the <code>.bashrc</code> file for the Payara user, the most common location being user's home directory.</p>
<pre><code>cd /home/payara
vim .bashrc
</code></pre>
<p>And add the following line:</p>
<pre><code>export PATH=$PATH:/opt/payara41/glassfish/bin
</code></pre>
<h1>Final result</h1>
<p>If your setup was done properly you should obtain an environment like in the following screenshot:</p>
<p><a href="/images/posts/payara/payarafinish.png" data-lightbox="image-1" title="Payara Centos 7" ><br />
<img src="/images/posts/payara/payarafinish.png"><br />
</a></p>
<p>Note that:</p>
<ul>
<li>I'm able to use systemd commands</li>
<li>It actually restarded since PID changed after <code>systemd restart</code></li>
<li><code>asadmin</code> works and displays properly the running domain</li>
</ul>
</p>
        <a href="../blog/2017/2017-01-28-Update-JBoss-Developer-Studio-JVM.html"><h1>[Quicktip] Move current JVM on JBoss Developer Studio</h1></a>
        <p>28 January 2017</p>
        <p><p><a href="/images/posts/jbossemc/devstudio10.png" target="_blank"><br />
<img src="/images/posts/jbossemc/devstudio10.png" alt="JBoss Developer Studio" style="width: 300px;"/><br />
</a></p>
<p>After a routinary JVM update I had the idea of getting rid of old JVMs by simply removing the install directories. <strong>After that many of my Java tools went dark :(</strong>.</p>
<p>For JBoss Developer Studio, I received the following &quot;welcome message&quot;.</p>
<p><a href="/images/posts/jbossjvm/jvmwarn.png" data-lightbox="image-1" title="devstudio-jvm-error" ><br />
<img src="/images/posts/jbossjvm/jvmwarn.png"><br />
</a></p>
<p>At the time, I deleted the 1.8.111 version from my system, preserving only the 1.8.121 version as the &quot;actual&quot; version.</p>
<h2>Fixing versions</h2>
<p>Different from other tools, Eclipse-based tools tend to &quot;hardcode&quot; the JVM location with the install process inside eclipse.ini file. However and as I stated in a <a href="/blog/2016/2016-02-02-Fix-font-size-JBoss-Developer-OSX.html">previous entry</a>, JBoss Developer Studio converts this file to <strong>jbdevstudio.ini, hence you should fix the JVM location in this file</strong>.</p>
<h2>Finding the file in Mac OS(X?)</h2>
<p>If you got JDevStudio with the vanilla installer, the default location for the IDE would be /Applications/devstudio and the tricky part is that <strong>configuration is inside &quot;Devstudio&quot; OSX Package</strong>.</p>
<p>If you wanna fix this file from terminal the <strong>complete path for the file would be:</strong></p>
<p><code>/Applications/devstudio/studio/devstudio.app/Contents/Eclipse</code></p>
<p>Of course you could always open packages in Finder:</p>
<p><a href="/images/posts/jbossjvm/pcontents.png" data-lightbox="image-1" title="finder-package" ><br />
<img src="/images/posts/jbossjvm/pcontents.png"><br />
</a></p>
<p>After opening the file the only fix that you need to do is to <strong>point to the installed virtual machine</strong>, being in my PC (Hint: You could check the location by executing /usr/libexec/java_home):</p>
<p><code>/Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/</code></p>
<p>And your file should look like this:</p>
<p><a href="/images/posts/jbossjvm/devstudio.png" data-lightbox="image-1" title="jvm-location" ><br />
<img src="/images/posts/jbossjvm/devstudio.png"><br />
</a></p>
</p>
        <a href="../blog/2016/2016-12-19-Join-Devnexus.html"><h1>Join Me at @devnexus</h1></a>
        <p>19 December 2016</p>
        <p><p><a href="https://vorozco.com/images/posts/devnexus/banner.png" target="_blank"><br />
<img src="https://vorozco.com/images/posts/devnexus/banner.png" alt="Devnexus" style="width: 560px;"/><br />
</a></p>
<p><a href="https://devnexus.com/">Devnexus</a> is probably (and according to this video) <strong>the second biggest Java Conference in United States</strong>, hence one of the top ten Java conferences in America.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/J7XpqF8rHS8" frameborder="0" allowfullscreen></iframe>
<p>Organized by the <a href="http://www.ajug.org/">Atlanta Java Users Group</a>, you could choose between 120+ presentations, 14 tracks and 7 workshops, in order to catch-up with recent topics on Java and Enterprise development world, <strong>a must for any Java Developer looking for knowledge</strong>.</p>
<p>Devenexus 2017 will be my first attendance and <strong>I'm honored to share that one of my presentations was accepted :)</strong>.</p>
<p>Reaching the lambda heaven - <a href="https://devnexus.com/s/devnexus2017/presentations/17131">https://devnexus.com/s/devnexus2017/presentations/17131</a></p>
<p>In this presentation i'll give a practical introduction to functional/reactive programing in Java for the &quot;street developer&quot; and we'll be <strong>reviewing a list of useful libraries</strong> to make elegant and functional (as in the paradigm) web applications.</p>
<p>Why this and not other conferences?, in my opinion:<br />
- It's held on a cheaper city compared to California conferences<br />
- It's a conference from developers for developers<br />
- Atlanta Jug guys are awesome<br />
- Java still rocks</p>
<p>I hope to see you there</p>
</p>
        <a href="../blog/2016/2016-10-11-Add-Eclipse-Marketplace-JBoss-Developer-Studio.html"><h1>[Quicktip] Add Eclipse Marketplace Client to JBoss Developer Studio</h1></a>
        <p>11 October 2016</p>
        <p><p><a href="/images/posts/jbossemc/devstudio10.png" target="_blank"><br />
<img src="/images/posts/jbossemc/devstudio10.png" alt="JBoss Developer Studio" style="width: 300px;"/><br />
</a></p>
<p>Recently I'm in the need to do some reporting development. Although I've used iReport in the past I'm pretty <strong>comfortable with having a one stop solution</strong>, being at this time Red Hat JBoss Developer Studio (RHJDS).</p>
<p>Despite the fact that it contains an small marketplace, at this time it lacks a proper reporting solution like JasperSoft Studio, hence <strong>I was in the need of installing it over my current RHJDS install</strong>.</p>
<p>For those in the need of <strong>installing Eclipse Marketplace plugins</strong>, you can get it with two simple steps:</p>
<h2>Add support for Eclipse Update Sites</h2>
<p>Create a <strong>new repository</strong> with the following sequence<br />
Help -&gt; Install New Software -&gt; Add</p>
<p>The update URL for Eclipse Neon is:</p>
<pre><code>http://download.eclipse.org/releases/neon/
</code></pre>
<p>And choose a good name for the repo (&quot;Eclipse Neon&quot; maybe?)</p>
<p><a href="/images/posts/jbossemc/marketplace.png" data-lightbox="image-1" title="marketplace" ><br />
<img src="/images/posts/jbossemc/marketplace.png"><br />
</a></p>
<h2>Search for Eclipse Marketplace Client</h2>
<p>And install it . . .<br />
<a href="/images/posts/jbossemc/emcinstall.png" data-lightbox="image-1" title="emc" ><br />
<img src="/images/posts/jbossemc/emcinstall.png"><br />
</a></p>
<p>So far <strong>I'm not pretty sure about the potential impacts</strong> of this mix of repositories, however you'll be able to install any Eclipse Marketplace plugin, and it looks good.</p>
<p><a href="/images/posts/jbossemc/emc.png" data-lightbox="image-1" title="emc" ><br />
<img src="/images/posts/jbossemc/emc.png"><br />
</a></p>
</p>
        <a href="../blog/2016/2016-09-08-See-you-at-J1-and-WITFOR-2016.html"><h1>See you at Java One and WITFOR 2016</h1></a>
        <p>08 September 2016</p>
        <p><p><a href="https://vorozco.com/images/posts/j1witfor/j1-speaking.jpg" target="_blank"><br />
<img src="https://vorozco.com/images/posts/j1witfor/j1-speaking.jpg" alt="Java Speaker" style="width: 150px;"/><br />
</a></p>
<p>The last quarter of the year is maybe my favorite period of time, since 2012 <strong>I try to attend at least to one &quot;big&quot; conference</strong> and this year won't be an exception.</p>
<p>For me <strong>conferences are an opportunity</strong> to meet new people, have fun, and of course travel to new/favorite places, and this year I'll have the opportunity to attend two big conferences.</p>
<p>From September 12 to 15 I'll be attending  <a href="http://www.witfor2016.org/">WITFOR 2016</a> as a member of the guatemalan academic community. Since my Msc. I've missed the serious academic environment, conferences, CFP, basically because my country(Guatemala) is still creating an academic system. Hence <strong>I have to help (a little bit at least)</strong> in my <a href="http://www.url.edu.gt/">University</a>.</p>
<p>Later jumping from one plane to another (literally) I'll travel to attend J1. As I previously stated, J1 was a &quot;TODO in life&quot; I had the opportunity to attend the past year and collaborate with some community activities, however this year(between other good news) <a href="https://oracle.rainfocus.com/scripts/catalog/oow16.jsp?search=UGF7869&amp;search.event=javaone">one of my proposals was accepted</a>, so <strong>I'm trying to be ready to chill-out with some Java community peers and share the things that we are doing in Guatemala's software industry</strong>.</p>
<p>See you at J1 and WITFOR 2016.</p>
</p>
        <a href="../blog/2016/2016-07-14-Java-Day-Tour-2016-Recap.html"><h1>Java Day Tour 2016 Recap</h1></a>
        <p>14 July 2016</p>
        <p><p><a href="https://vorozco.com/images/posts/guatejugtour2016/duke-futureduke.jpg" target="_blank"><br />
<img src="https://vorozco.com/images/posts/guatejugtour2016/duke-futureduke.jpg" alt="Java Flight" style="width: 150px;"/><br />
</a></p>
<p>A year ago I talked about <a href="/blog/2015/GuateJUG-Tour-2015.html">GuateJUG's Java Day Tour</a> in this blog, one year has passed (time flies!) and it's time to do another recap of <strong>GuateJUG activities</strong>.</p>
<p>As a matter of fact the tour wasn't a tour in first place, we created it as a coincidence of multiple IT conferences where GuateJUG was invited where we promoted our yearly conference, however at this year we formalized the concept opening a &quot;Call for JUG&quot; in our website and social networks with a <strong>clear mission and vision:</strong></p>
<pre><code>&gt;Mision: Help universities, high schools and IT development centers with Java-centered conferences in order to update IT knowledge in the not-so developed regions of Guatemala

&gt;Vision: Travel through Guatemala and have fun while promoting our conference and Java
</code></pre>
<h1>Why is this important?</h1>
<p>Guatemala is one of the Central American countries with less <strong>college graduates</strong>, only 10% of the population could access to college education and only 10% of that population (hence 1%) actually gets a degree, with the addition that <strong>most of the people choose a non-STEM degree</strong>.</p>
<p>Anyways as most of you probably know, you actually don't need a degree to be a rockstar in Software Development, and for this many people in the country is <strong>gaining interest in Computer Science</strong> in order to get better job opportunities and GuateJUG is glad to be a part of that change.</p>
<h1>The tour</h1>
<p>To finance the tour expenses we created an <strong>inverted call for papers</strong>, any group, association, university, high school could choose between a bunch of speakers and a fixed set of talks, being:</p>
<ul>
<li>Maria Castillo (<a href="http://twitter.com/marycoder">@marycoder</a>)</li>
<li>Jorge Cajas (<a href="https://twitter.com/Jac_Mota">@jac_mota</a>)</li>
<li>Mario Batres (<a href="https://twitter.com/mariobatres7">@mariobatres7</a>)</li>
<li>Mercedes Wyss (<a href="https://twitter.com/itrjwyss">@itrjwyss</a>)</li>
<li>Me (<a href="http://twitter.com/tuxtor">@tuxtor</a>)</li>
</ul>
<p>GuateJUG put the time plus experience and they put the venue and accomodation. Contrary what we initially expected (and sadly with most success than our yearly conference), GuateJUG tour was a hit. We successfully participated in many talks in the following cities:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/San_Pedro_Sacatep%C3%A9quez,_San_Marcos">San Pedro Sacatepequez, San Marcos</a> (sponsored by Universidad Mariano Galvez)</li>
<li><a href="https://en.wikipedia.org/wiki/Totonicap%C3%A1n">Totonicapan, Totonicapan</a> (sponsored by Universidad Mariano Galvez)</li>
<li><a href="https://en.wikipedia.org/wiki/Quetzaltenango">Quetzaltenango, Quetzaltenango</a> (sponsored by Universidad Mariano Galvez)</li>
<li><a href="https://en.wikipedia.org/wiki/Cobán">Cobán, Alta Verapaz</a> (sponsored by Universidad Mariano Galvez)</li>
<li><a href="https://en.wikipedia.org/wiki/Salam%C3%A1">Salama, Baja Verapaz</a></li>
<li><a href="https://en.wikipedia.org/wiki/San_Miguel_Petapa">San Miguel Petapa</a> (sponsored by Colegio Valle del Saber)</li>
<li><a href="http://uni.edu.gt/">Universidad InterNaciones</a> (sponsored by itself)</li>
</ul>
<p>Some random photos from the trips</p>
<div class="fotorama">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/a.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/b.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/c.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/d.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/e.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/f.jpg">
    <img src="https://vorozco.com/images/posts/guatejugtour2016/g.jpg">
		<img src="https://vorozco.com/images/posts/guatejugtour2016/h.jpg">
		<img src="https://vorozco.com/images/posts/guatejugtour2016/i.jpg">
		<img src="https://vorozco.com/images/posts/guatejugtour2016/j.jpg">
</div>
<p>With new dates in the following cities:<br />
* <a href="https://en.wikipedia.org/wiki/Huehuetenango">Huehuetenango, Huehuetenango</a> (sponsored by Universidad da Vinci)<br />
* <a href="https://en.wikipedia.org/wiki/Chiquimula">Chiquimula, Chiquimula</a> (sponsored by Universidad de San Carlos)</p>
<p>So far we've promoted Java with more than 800 assistants between all regions, a huge success for guatemalan parameters.</p>
<h1>Lessons that we've learnt</h1>
<p>Although GuateJUG was supposed to be a central part to teach Java, as speakers <strong>we've learnt more than we expected</strong> in the first trip.</p>
<p>Quality comments aside, most of the people that made this tour possible were glad with us, and <strong>they wish that more IT communities could have an impact</strong> for all country regions.</p>
<p>You can't be sure if an informal chit-chat in a IT conference would become a great opportunity, in our case an informal chit-chat in a Java meeting finished with the <strong>first independent technological tour</strong> in our country (AFAIK).</p>
<p>For us the Java Day Tour was an opportunity to rediscover our country, make friends in every country region, and have not only IT but <strong>life experiences that I'm pretty sure I wouldn't have without a proper excuse</strong> to take my backpack, laptop, and share a little bit of knowledge that I've had the opportunity to acquire.</p>
<p>For the students, Java Day Tour was <strong>an opportunity to ask any question</strong> about Software Engineering, Computer Science, Women in STEM, Android, Life outside their regions, IT careers, and or course Java, and I'm glad for being part of that.</p>
<p>Long live to Java!</p>
</p>
        <a href="../blog/2016/2016-02-11-Using-ZuluJDK-OSX.html"><h1>First impressions of Zulu on OSX</h1></a>
        <p>11 February 2016</p>
        <p><p><a href="/images/posts/zulufirst/zulu.jpg" target="_blank"><br />
<img src="/images/posts/zulufirst/zulu.jpg" alt="Zulu" style="width: 300px;"/><br />
</a></p>
<p>Although my first development box at this time is an Apple PC, <strong>I'm pretty comfortable with Open Source</strong> software due <a href="http://opensourceforamerica.org/learn-more/benefits-of-open-source-software/">technical and security benefits</a>.</p>
<p>In this line, I've been a user of <a href="https://www.azul.com/products/zulu/">Zulu JVM</a> on my Windows+Java deployments, basically because <strong>Zulu offers a zero-problems deployment of <a href="http://openjdk.java.net/">OpenJDK</a></strong>, being at this time the only Open Source and production ready JVM available for Windows (in Linux you also have OpenJDK distro builds or IcedTea).</p>
<p>As my previous experiences in Windows and considering that Zulu is at some point a supported compilation of OpenJDK (basis for HotSpot aka OracleJDK), using Zulu <strong>in OSX has been so far a painless solution</strong>.</p>
<p>Compared to HotSpot you have <strong>an additional security &quot;feature&quot;</strong> only available at <a href="http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html">Server JRE</a>, the lack of the infamous web plugin, however you will lose Java Mission Control because is a closed source tool.</p>
<p>If you are interested in <strong>formal benchmarks</strong> this guide (by Zulu creators BTW) could be helpful: <a href="http://www.azulsystems.com/sites/default/files/images/Azul_Zulu_Hotspot_Infographic_d2_v2.pdf">http://www.azulsystems.com/sites/default/files/images/Azul_Zulu_Hotspot_Infographic_d2_v2.pdf</a></p>
<p>In a more &quot;day by day&quot; test, no matter if you are using Eclipse</p>
<p><a href="/images/posts/zulufirst/eclipse.png" data-lightbox="eclipse" title="eclipse" ><br />
<img src="/images/posts/zulufirst/eclipse.png"><br />
</a></p>
<p>Wildfly</p>
<p><a href="/images/posts/zulufirst/wildfly.png" data-lightbox="wildfly" title="wildfly" ><br />
<img src="/images/posts/zulufirst/wildfly.png"><br />
</a></p>
<p>Or maybe Vuze</p>
<p><a href="/images/posts/zulufirst/vuze.png" data-lightbox="vuze" title="vuze" ><br />
<img src="/images/posts/zulufirst/vuze.png"><br />
</a></p>
<p>Zulu simply works.</p>
<h1>¿Why should you consider Zulu?</h1>
<ul>
<li>Is based on OpenJDK Open Source project</li>
<li>You obtain nearly the same performance of HotSpot</li>
<li>You can bundle it on your apps (like <a href="https://azure.microsoft.com/en-us/marketplace/partners/azul/zulu-enterprise-ondemand-ub1404/">Microsoft in Azure</a>)</li>
</ul>
<h1>¿Why avoid Zulu?</h1>
<ul>
<li>If you need Java Mission Control</li>
<li>If you need the Java Browser Plugin, <a href="http://www.theverge.com/2016/1/28/10858250/oracle-java-plugin-deprecation-jdk-9">pretty dead BTW</a></li>
</ul>
</p>
        <a href="../blog/2016/2016-02-02-Fix-font-size-JBoss-Developer-OSX.html"><h1>[Quicktip] Fix font size in JBoss Developer Studio and OSX</h1></a>
        <p>02 February 2016</p>
        <p><p><a href="/images/posts/jbossdeveloper/jbds9.png" target="_blank"><br />
<img src="/images/posts/jbossdeveloper/jbds9.png" alt="JBoss Developer Studio" style="width: 300px;"/><br />
</a></p>
<p>One of the most annoying things of using JBoss Developer Studio on OSX is the <strong>default configuration</strong>, specially the font size.</p>
<p>By default Eclipse (and consequently Jbossdevstudio) has a startup parameter called <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=56558">&quot;-Dorg.eclipse.swt.internal.carbon.smallFonts&quot;</a> and as its name suggests, it enforces the usage of the smallest font at the system.</p>
<p>Although default settings are tolerable on retina displays:<br />
<a href="/images/posts/jbossdeveloper/retinagood.png" data-lightbox="image-1" title="1080p bad fonts" ><br />
<img src="/images/posts/jbossdeveloper/retinagood.png"><br />
</a></p>
<p>The problem gets worse on regular 1080p screens (like external non-mac displays):</p>
<p><a href="/images/posts/jbossdeveloper/1080pbad.png" data-lightbox="image-2" title="1080p bad fonts" ><br />
<img src="/images/posts/jbossdeveloper/1080pbad.png"><br />
</a></p>
<p>As you probably guess the solution of this issue is to delete the parameter, but the tricky part is that <strong>JBoss Developer Studio renames the eclipse.ini file (default Eclipse configuration) to jbdevstudio.ini</strong>, making most of the how-to guides at internet &quot;complicated&quot;.</p>
<p>Anyway the file is located at:</p>
<pre><code>${JBDEVSTUDIO_HOME}/studio/jbdevstudio.app/Contents/Eclipse/jbdevstudio.ini
</code></pre>
<p>Being the default location:</p>
<pre><code>/Applications/studio/jbdevstudio.app/Contents/Eclipse/jbdevstudio.ini
</code></pre>
<p>With this <strong>your eyes will be gratefull</strong> (actual 1080p screenshot):</p>
<p><a href="/images/posts/jbossdeveloper/1080pgood.png" data-lightbox="image-3" title="1080p good fonts" ><br />
<img src="/images/posts/jbossdeveloper/1080pgood.png"><br />
</a></p>
</p>
        <a href="../blog/2015/2015-11-16-20-years-Java-5-years-GuateJUG.html"><h1>20 years of Java in Java One and Java Day Guatemala</h1></a>
        <p>23 November 2015</p>
        <p><p><a href="/images/posts/java20/java20.jpg" target="_blank"><br />
<img src="/images/posts/java20/java20.jpg" alt="Java 20" style="width: 300px;"/><br />
</a></p>
<p>For me <strong>2015 hacktivism is officially closed</strong>, this year I had the opportunity to attend my first Java One and met some of my development heroes, folks from another JUGs, being trapped at Patricia's hurricane (no kidding), and bring a huge amount of Java t-shirts to Guatemala. I must say thanks to the people that made this trip possible, special acknowledgments to Nichole Scott from Oracle, my peers at <a href="http://www.nabenik.com">Nabenik</a> that gratefully sponsored my trip and the Guatemala Java User Group for allowing me to take advantage of the Java One ticket :-D.</p>
<p>I think that every techie has a list of conferences to attend before die, as 2015 my top five is:</p>
<ul>
<li>JavaOne (2015 finally)</li>
<li>Gentoo Miniconf</li>
<li>OSCON</li>
<li>Forum Internacional de Sofware Livre - FISL (2013 as a speaker yey!)</li>
<li>Convención de Informatica Guatemala (2005 - now dead, but it made the list for nostalgia)</li>
</ul>
<p>Although I had some health issues due stress, Java One and San Francisco were lifetime experiences. As each conference I've attended, it has its goods and bads but in general <strong>you can feel a strong sense of community between attendants</strong>, from Pivotal to Red Hat (and Microsoft), from the peer that shares a beer with you and turns out to be a Java Champion to the people that speaks another languages with you, Java One is about community making awesome things in IT. Programming languages aren't eternal but I can state that the differential factor that raised 20-year languages like Java and JavaScript among the others is the community.</p>
<p>Random photos:</p>
<div class="fotorama">
    <img src="/images/posts/java20/IMG_20151023_151334.jpg">
    <img src="/images/posts/java20/IMG_20151023_185726.jpg">
    <img src="/images/posts/java20/IMG_20151024_104546.jpg">
    <img src="/images/posts/java20/IMG_20151024_122253.jpg">
    <img src="/images/posts/java20/IMG_20151025_133147.jpg">
    <img src="/images/posts/java20/IMG_20151025_152920.jpg">
    <img src="/images/posts/java20/IMG_20151026_194945.jpg">
</div>
<p>In a different scale but in the same sense of community, the Guatemala Java User Group held its yearly conference <strong>Java Day Guatemala</strong>.</p>
<p>I've been involved directly in the organization of 2 Java Days and spoken in three. As I said in our keynote, for me <strong>GuateJUG has been the most successful user group</strong> where I've participated. Characterized by pragmatism, openness and community structure since its inception, GuateJUG became one of the strongest user groups in Central America, the integration between industry, academia, Open Source communities, Free Software communities and HR people looking for the next generation of developers is unique.</p>
<p>As a special occasion <strong>we held a traditional birthday celebration</strong>, including birthday cake and mexican piñatas. It was great to share words with some old friends and meet new IT enthusiasts, as a matter of fact we also sang &quot;Happy birthday Java and happy birthday GuateJUG&quot;.</p>
<p>Video and some more random photos:</p>
<iframe width="420" height="315" src="https://www.youtube.com/embed/u7o0XShv79E" frameborder="0" allowfullscreen></iframe>
<p><br/></p>
<div class="fotorama">
    <img src="/images/posts/java20/11226069_1060642347287731_5812305256213579668_o.jpg">
    <img src="/images/posts/java20/12238470_1060643013954331_2349556758532275784_o.jpg">
    <img src="/images/posts/java20/12244626_1060641943954438_3151222273500737324_o.jpg">
    <img src="/images/posts/java20/12265953_1060642613954371_2213430104867139963_o.jpg">
    <img src="/images/posts/java20/_DSC0452.jpg">
</div>
<p>I hope to see you the next year in Java One and Java Day :-).</p>
</p>
        <a href="../blog/2015/2015-11-12-Java-Essentials-Book-Review.html"><h1>[Book Review] Java EE 7 Essentials, O’Reilly</h1></a>
        <p>12 November 2015</p>
        <p><p><a href="/images/posts/gf-essentials.gif" target="_blank"><br />
<img src="/images/posts/gf-essentials.gif" alt="JavaEE 7 Essentials Cover" style="width: 150px;"/><br />
</a></p>
<h1>About the book</h1>
<pre><code>Pages: 362
Publisher: O’Reilly Media
Release: Aug 2013
ISBN-10: 978-1-4493-7016-9
ISBN-13: 1-4493-7016-0
</code></pre>
<h1>Book details</h1>
<p><strong>I received this book as a part of the now dead O'Reilly users group program</strong>. When I asked for this book I was specially interested due comments from my development peers . . . and most importantly because I was in the middle of a Software Architecture definition.</p>
<p>I'm writing this review after 7 months of using it on daily basis, basically because our development stack is composed by AngularJS on the front-end and JavaEE 7 on the back-end (with a huge bias to the Hat company). At the office we have a small books collection (because IT books are pretty dead after five years), and <strong>Aurun's book is our prefered book</strong> for the &quot;Java EE 7 rescue kit&quot;.</p>
<p>If I have to choose <strong>two adjectives for this book I must say &quot;quick and versatile&quot;</strong>, this book deserves all of its fame because it has the balance between a good reference book and a user friendly introductory book, most of the IT books don't achieve it.</p>
<p>I don't wanna copy the index page but I have the following <strong>favorite chapters</strong>:</p>
<ul>
<li>Servlets</li>
<li>RESTFul Web Services</li>
<li>SOAP Web Services</li>
<li>JSON Processing</li>
<li>Enterprise Java Beans</li>
<li>Context and Dependency Injection</li>
<li>Bean Validation</li>
<li>Java Transactions</li>
<li>Java Persistence</li>
</ul>
<p>Most of the book samples are based on Glassfish, and is easy to guess why looking at the publication date. However, talking from my true-heavy-metal-monkey-developer-architect experience, <strong>this book uses only pure JavaEE 7 apis</strong> and I've been able to run/use the samples on Wildfly without issues.</p>
<p>For those that are looking a good book for JavaEE 7 development, on any of the <a href="http://www.oracle.com/technetwork/java/javaee/overview/compatibility-jsp-136984.html">certified Java EE 7 servers</a> <strong>this is a must</strong>.</p>
<h1>Highlights</h1>
<ul>
<li>Good balance between tutorial and reference.</li>
<li>Few content compared to the Java EE Tutorial but still in the point.</li>
<li>The samples should work on any Java EE 7 server.</li>
</ul>
<h1>Could be better</h1>
<ul>
<li>WebSockets section is small in relation to the other chapters, it feels incomplete.</li>
<li>The cover brings to my mind the good old days when Glassfish was that application server that everybody is talking.</li>
</ul>
</p>
        <a href="../blog/2015/GuateJUG-Tour-2015-First-Leg.html"><h1>GuateJUG Tour 2015 First Leg</h1></a>
        <p>22 October 2015</p>
        <p><p>As I described <a href="/blog/2015/GuateJUG-Tour-2015.html">previously</a>, GuateJUG held a conference circuit promoting its yearly conference <strong><a href="http://www.guate-jug.net/javaday2015">Java Day Guatemala 2015</a></strong>.</p>
<p>This activity was motivated by <a href="https://community.oracle.com/community/java/javas-20th-anniversary">Java's 20th anniversary</a> and specially due <strong>GuateJUG's 5th anniversary</strong>.</p>
<p>So... how do you achieve a tour that traverses Guatemala?. Easy, with the right sponsors and contacts :).</p>
<p><strong>An special acknowledgment</strong> for the people that made this first leg possible:<br />
- Jorge Cajas (Universidad de San Carlos de Guatemala)<br />
- Dhaby Xiloj (Universidad Rafael Landivar - Quetzaltenango)<br />
- Rene Alvarado (Universidad de San Carlos de Guatemala - Chiquimula)</p>
<p>In this first leg (not the only one . . . I hope) GuateJUG team went <strong>from the center of the country to the east and later to the west</strong>, like in this ugly map:</p>
<p><a href="/images/posts/guatejugtour2015/map.png" target="_blank"><br />
<img src="/images/posts/guatejugtour2015/map.png" alt="GuateJUG Tour" style="width: 300px;"/><br />
</a></p>
<p>Covering the following topics</p>
<h2>First conference</h2>
<p>Place: Universidad de San Carlos de Guatemala - Guatemala City<br />
* Java 8: Functional programming principles (me)<br />
* 20 years of Java (Wences Arana - DebianGt)</p>
<h2>Second conference</h2>
<p>Place: Universidad Rafael Landivar - Quetzaltenango<br />
* Source code control with Git - (me)</p>
<h2>Third conference</h2>
<p>Place: Universidad de San Carlos de Guatemala - Chiquimula<br />
* HTML5 applications with Java EE 7 and AngularJS - (me)<br />
* Android 101 - (Mercedes Wyss - GuateJUG)</p>
<p>Random photos:</p>
<div class="fotorama">
    <img src="/images/posts/guatejugtour2015/1.jpg">
    <img src="/images/posts/guatejugtour2015/2.jpg">
    <img src="/images/posts/guatejugtour2015/3.jpg">
    <img src="/images/posts/guatejugtour2015/4.jpg">
    <img src="/images/posts/guatejugtour2015/5.jpg">
    <img src="/images/posts/guatejugtour2015/6.jpg">
    <img src="/images/posts/guatejugtour2015/7.jpg">
</div>
<p>Some years ago <strong>I did a similar tour with the FLOSS community in my college years</strong>. The sensation of going back to the same cities, hanging out with good old friends and other new friends is always pleasant.</p>
<p>Every time anyone asks me why I do this, <strong>I have the same answer</strong> &quot;why not? At least each time I know the country a little bit more :)&quot;.</p>
<p>With this I'm in the best mood for Java Day Guatemala and most importantly to attend <a href="https://www.oracle.com/javaone/index.html">Java One 2015</a> willing to collaborate with some User Groups activities, I hope to see many of you in both conferences.</p>
</p>
        <a href="../blog/2015/GuateJUG-Tour-2015.html"><h1>GuateJUG Tour 2015</h1></a>
        <p>26 September 2015</p>
        <p><p>In <a href="http://www.guate-jug.net">GuateJUG</a> <strong>we arrived to our fifth year</strong>, consequently I must start this post with a &quot;thanks to everybody that made this possible (developers, advocates, supporters, sponsors, friends, family, and other-UG)&quot;.</p>
<p><strong>This year has been a special year for GuateJUG</strong> and Java in general, in February we were very excited about being featured at  <a href="http://gtts.ehu.es/WDW/biblio/JavaMagazine/javamagazine20150102-dl.pdf">Java Magazine</a> (a little step for .gt developers, a great step for our user group), and as every inch of the web knows 2015 is the year of the 20 years of Java, another anniversary that came in hand to believe that 2015 is the year of Java reborn.</p>
<p>Hence, at GuateJUG we added to our regular activities a conference circuit called <strong>GuateJUG Tour</strong>.</p>
<p><a href="/images/posts/gtour2015.png" target="_blank"><br />
<img src="/images/posts/gtour2015.png" alt="GuateJUG Tour" style="width: 300px;"/><br />
</a></p>
<p>As many of our activities, this is some kind of spontaneous tour, hence <strong>we'll be adding dates as new cities are confirmed</strong> (Guatemala is a small country so it's possible to confirm in very short notice).</p>
<p>The tour started on September 26 and I'm confirmed as a speaker in three cities, so <strong>I'll be collecting my slides in this post for quick reference</strong> :).</p>
<h1>Java 8: Más funcional que nunca</h1>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/30AXtCu2ARI9hD" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/tuxtor/java-8-ms-funcional-que-nunca" title="Java 8: Más funcional que nunca" target="_blank">Java 8: Más funcional que nunca</a> </strong> from <strong><a href="//www.slideshare.net/tuxtor" target="_blank">Víctor Orozco</a></strong> </div>
<h1>Git 101 (with Java)</h1>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/H4g9lRHrc63bzj" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/tuxtor/introduccin-a-git-git-101" title="Introducción a Git (Git 101)" target="_blank">Introducción a Git (Git 101)</a> </strong> from <strong><a href="//www.slideshare.net/tuxtor" target="_blank">Víctor Orozco</a></strong> </div>
<h1>Aplicaciones HTML5 con AngularJS y JavaEE</h1>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/EVtupsoyepJrX3" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/tuxtor/inciando-con-angularjs-y-javaee-7" title="Inciando con AngularJS y JavaEE 7" target="_blank">Inciando con AngularJS y JavaEE 7</a> </strong> from <strong><a href="//www.slideshare.net/tuxtor" target="_blank">Víctor Orozco</a></strong> </div>
</p>
        <a href="../blog/2015/Welcome.html"><h1>Welcome</h1></a>
        <p>08 August 2015</p>
        <p><p>Hi, If you're reading this probably you are one of my few twitter followers, so thanks for your visit. For those that don't know me I wanna share a little story with you :).</p>
<p>As an IT guy, I started my main website/blog <a href="http://tuxtor.shekalug.org/">El abismo de tux (in spanish)</a> in 2006 during my college years, mostly as an experiment that grew as the blog phenoma exploded, gaining great experiences like:</p>
<ul>
<li>Being featured in a nation-wide newspaper;</li>
<li>Being invited to morning talk shows due my tech/politics rants;</li>
<li>Getting opportunities like my first job using my tech blog as a &quot;certification&quot; of my expertise in Unix and Java.</li>
</ul>
<p>So . . . what's the point of starting a new website in 2015?</p>
<p>I consider my old blog as a chronological reflection of my life experiences, like my stupidity at college, my involvement in FLOSS communities, my musical taste, EVERYTHING that I could talk about technology, politics, society, academia, the life in the countries where I've lived (Guatemala, Brazil),  and in recent years using it as an scratchpad of my day to day coding.</p>
<p>During this year at <a href="http://www.nabenik.com">Nabenik</a>, while I was struggling to improve my coding skills I noticed that most if not all the times I search for tech content exclusively in English, and I've noticed also a debacle on my readers due the change of focus at my old blog. because I simply killed some topics that I don't care anymore (politics, Free Software as a social movement, the country where I live), so I've decided that is time to put the &quot;Tux Abyss&quot; in mantainance mode.</p>
<p>Killing a website is more difficult than it looks, specially a website that has been online since 2006, however at this point of my life/carreer I'd like to share deeper facts and knowlege about fewer topics, specially:</p>
<ul>
<li>Gentoo Linux and Unix in General</li>
<li>JVM Languages (Java, JavaScript)</li>
</ul>
<p>That's why I'm welcoming you to &quot;The J*&quot;, the name is inspired in three facts</p>
<ul>
<li>I write code in JVM Languages (specially Java) and JavaScript on daily basis</li>
<li>I was born in June</li>
<li>The second name of a child that means a lot to me starts with J</li>
</ul>
<p>For this site and considering my past experiences with Wordpress and Jekyll . . . I decided to try <a href="http://jbake.org/">JBake</a>, mainly because I'm familiar with Gradle, and for me is easier to write posts in markdown. Also because I fell in love with the results at <a href="http://vertx.io">Vert.x</a> and <a href="http://www.hawkular.org/">Hawkular</a> to name a few.</p>
<p>At this time this blog is hosted at GitHub pages being built by <a href="https://travis-ci.org/tuxtor/the-j">Travis-CI</a> with gradle, saving me hosting costs.</p>
<p>I think that starting a web site in the <a href="http://jacquesmattheij.com/aol-20">AOL 2.0</a> era is some kind of digital rebellion, so please grab a seat and feel free to drop comments :).</p>
</p>
  
  <hr />
  
  <p>Older posts are available in the <a href="../archive.html">archive</a>.</p>

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2015-2025 | Mixed with <a href="https://bootswatch.com/">Bootswatch</a> | Baked with <a href="http://jbake.org">JBake v2.6.7</a> | Licensed under the <a href="http://www.wtfpl.net/"/>WTFPL 2.0</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <link  href="//cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet"> <!-- 3 KB -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/8.7.1/lazyload.min.js"></script>
    </body>
</html>
